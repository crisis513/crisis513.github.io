---
layout: post
title: "[Project] DevSecOps í”„ë¡œì íŠ¸ - SAST ë¶„ì„ ë° í™œìš©"
date: 2020-10-21
desc: "[Project] DevSecOps í”„ë¡œì íŠ¸ - SAST ë¶„ì„ ë° í™œìš©"
keywords: "project,devsecops,devops,gcp,jenkins,sast"
categories: [Project]
tags: [project,devsecops,devops,gcp,jenkins,sast]
icon: icon-html
---

## ëª©ì°¨

[1. DevSecOps íˆ´ì²´ì¸ ë³´ì•ˆ ì ê²€ ë¦¬ìŠ¤íŠ¸](#list1)

[&nbsp;&nbsp; 1.1. SANS DevSecOps Best Practice](#list1_1)

[&nbsp;&nbsp; 1.2. Pre-Commit ë‹¨ê³„](#list1_2)

[&nbsp;&nbsp; 1.3. Commit ë‹¨ê³„](#list1_3)

[2. SAST(Static Application Security Testing) ì ìš©](#list2)

[&nbsp;&nbsp; 2.1. OWASP Dependency Check](#list2_1)

[&nbsp;&nbsp; 2.2. SpotBugs](#list2_2)

[&nbsp;&nbsp; 2.3. CheckStyle](#list2_3)

[&nbsp;&nbsp; 2.4. PMD(Programing Mistake Detector)](#list2_4)

[&nbsp;&nbsp; 2.5. SonarQube](#list2_5)

[&nbsp;&nbsp; 2.6. Anchore](#list2_6)

---

## **1. DevSecOps íˆ´ì²´ì¸ ë³´ì•ˆ ì ê²€ ë¦¬ìŠ¤íŠ¸**   <a name="list1"></a>

<br>

### **1.1. SANS DevSecOps Best Practice**   <a name="list1_1"></a>

SANS ì—°êµ¬ì†Œ(SANS Institute)ëŠ” êµìœ¡ì—ì„œ ë³´ì•ˆ ì¸ì¦ ì •ë³´ ì†ŒìŠ¤ë¥¼ ë³´ìœ í•˜ê³  ìˆìœ¼ë©° ì‚¬ì´ë²„ ë° ë„¤íŠ¸ì›Œí¬ ë°©ì–´, ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸, ì‚¬ê³  ëŒ€ì‘, ë””ì§€í„¸ í¬ë Œì‹ ë“± ë³´ì•ˆ êµìœ¡ì— ìˆì–´ êµ­ì œì ìœ¼ë¡œ ê°€ì¥ ë†’ì€ ì‹ ë¢°ë¥¼ ë°›ëŠ” ë³´ì•ˆ ê¸°ê´€ì´ë‹¤. 

ì´ëŸ¬í•œ SANS ì—°êµ¬ì†Œì—ì„œ DevSecOps ë„êµ¬ë“¤ì„ ë¶„ë¥˜ ë° ì •ë¦¬í•˜ì—¬ ë°œí‘œí•œ [Secure DevOps Toolchain and SWAT checklist](http://sans.org/u/zAi) ìë£Œë¥¼ í† ëŒ€ë¡œ DevSecOps íŒŒì´í”„ë¼ì¸ì—ì„œ ì •ì  ë¶„ì„í•  ë„êµ¬ë¥¼ ì„ ì •í•  ê²ƒì´ë‹¤. 

ë„êµ¬ ì„ ì •ì€ ì•ì„  í¬ìŠ¤íŒ…ì„ í†µí•´ êµ¬ì¶•ëœ DevOps íŒŒì´í”„ë¼ì¸ì— ì‰½ê²Œ ì—°ê²°í•  ìˆ˜ ìˆê³ , ìë™í™”ë˜ì–´ ì •ì  ë¶„ì„ ë° ë™ì  ë¶„ì„ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ë„êµ¬ë¥¼ ì„ íƒí–ˆë‹¤.

<br>

### **1.2. Pre-Commit ë‹¨ê³„**   <a name="list1_2"></a>

ë¨¼ì € DevSecOps íŒŒì´í”„ë¼ì¸ì˜ ì²« ë²ˆì§¸ ë‹¨ê³„ì¸ Pre-Commit ë‹¨ê³„ì—ì„œëŠ” ê°œë°œìê°€ ì½”ë“œë¥¼ GitLabê³¼ ê°™ì€ SCMì— Commit ë˜ê¸° ì „ì— ì™„ë£Œí•´ì•¼í•˜ëŠ” ë‹¨ê³„ì´ë‹¤.

ë‹¤ìŒ [ê·¸ë¦¼ 1]ì€ SANS ì—°êµ¬ì†Œì—ì„œ ì •ë¦¬í•œ Pre-Commit ë‹¨ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ë„êµ¬ë“¤ì„ ì •ë¦¬í•œ ê²ƒì´ë‹¤.

| ![pre_commit_security_tool](/static/assets/img/landing/project/devsecops_6_1.png){: width="758" height="273"} |
|:--:| 
| [ê·¸ë¦¼ 1] Pre-Commit ë‹¨ê³„ì˜ ë³´ì•ˆ ë„êµ¬ |

<br>

Pre-Commit ë‹¨ê³„ëŠ” VSCodeì™€ ê°™ì€ IDE(Integrated Development Environment)ì— ë³´ì•ˆ ë„êµ¬ë“¤ì„ í”ŒëŸ¬ê·¸ì¸ìœ¼ë¡œ ì¶”ê°€í•˜ì—¬ ê°œë°œìê°€ ì½”ë“œë¥¼ ì‘ì„± ë° ì‹¤í–‰í•˜ë©´ì„œ ë³´ì•ˆì„ ê²€ì‚¬í•œë‹¤.

ì•ì„  í¬ìŠ¤íŒ…ì—ì„œ êµ¬ì„±í•œ DevOps íŒŒì´í”„ë¼ì¸ì€ GitLabì— í‘¸ì‹œí•˜ëŠ” ì´ë²¤íŠ¸ë¡œ ì¸í•´ ì‹¤í–‰ë˜ëŠ”ë°, Pre-Commit ë‹¨ê³„ëŠ” í‘¸ì‹œ ì´ì „ì— ìˆ˜í–‰ë˜ëŠ” ì‘ì—…ì´ê¸° ë•Œë¬¸ì— DevSecOps íŒŒì´í”„ë¼ì¸ì— ì¶”ê°€í•  ë„êµ¬ëŠ” ì—†ë‹¤.

<br>

### **1.3. Commit ë‹¨ê³„**   <a name="list1_3"></a>

ë‹¤ìŒìœ¼ë¡œ ì½”ë“œë¥¼ ì»´íŒŒì¼í•˜ê³  ë¹Œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ ì •ì  ë¶„ì„ì„ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” Commit ë‹¨ê³„ì´ë‹¤.

[ê·¸ë¦¼ 2]ëŠ” SANS ì—°êµ¬ì†Œì—ì„œ ì •ë¦¬í•œ Commit ë‹¨ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ë„êµ¬ë“¤ì„ ì •ë¦¬í•œ ê²ƒì´ë‹¤.

| ![commit_security_tool](/static/assets/img/landing/project/devsecops_6_2.png){: width="714" height="308"} |
|:--:| 
| [ê·¸ë¦¼ 2] Commit ë‹¨ê³„ì˜ ë³´ì•ˆ ë„êµ¬ |

<br>

Commit ë‹¨ê³„ëŠ” ë¹Œë“œí•˜ê³  í…ŒìŠ¤íŠ¸í•˜ëŠ” ê³¼ì •ì—ì„œ íŒŒì´í”„ë¼ì¸ì˜ ë³´ì•ˆ ì·¨ì•½ì ì„ ì°¾ê¸° ìœ„í•´ ì†ŒìŠ¤ ì½”ë“œ íŒŒì¼ë“¤ì„ ìŠ¤ìº”í•œë‹¤.

ê²€ì‚¬í•  ì†ŒìŠ¤ ì½”ë“œì˜ ì–¸ì–´ì— ë”°ë¼ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ë“¤ì€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.

ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” Java ê¸°ë°˜ì˜ ì›¹ ì„œë¹„ìŠ¤ì— ë³´ì•ˆì„ ì ìš©í•´ë³¼ ê²ƒì´ê³ , ì •ì  ë¶„ì„ì— ì‚¬ìš©í•  ë„êµ¬ë“¤ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

<br>

1. OWASP Dependency Check

    **í”„ë¡œì íŠ¸ì˜ ì¢…ì†ì„±ì„ ê²€ì‚¬**í•˜ê³ , ê³µê°œì ìœ¼ë¡œ ê³µê°œ ëœ ì·¨ì•½ì ì„ íƒì§€í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì„± ë¶„ì„ ë„êµ¬ì´ë‹¤.
    
    ì§€ì •ëœ ì¢…ì†ì„±ì— ëŒ€í•œ CPE(Common Platform Enumeration) ì‹ë³„ìê°€ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ê³ , ë°œê²¬ë˜ë©´ ê´€ë ¨ CVE í•­ëª©ì— ì—°ê²°ë˜ëŠ” ë³´ê³ ì„œë¥¼ ìƒì„±í•´ì¤€ë‹¤.

    Jenkinsì™€ Maven í”ŒëŸ¬ê·¸ì¸ì´ ì¡´ì¬í•˜ì—¬ ì—°ë™í•˜ê¸° ì‰½ë‹¤.

    <br>

2. SpotBugs

    ì •ì  ë¶„ì„ ë„êµ¬ë¡œ ì‚¬ìš©ë˜ëŠ” FindBugsê°€ ì´ì œëŠ” **SpotBugs**ë¡œ ë°”ë€Œì–´ ì‚¬ìš©ë˜ê³  ìˆë‹¤.
    
    > ê´€ë ¨ ë‚´ìš©ì€ [FindBugs README](https://github.com/findbugsproject/findbugs/blob/master/README.md)ì—ì„œ í™•ì¸ ê°€ëŠ¥
    
    **ì œí•œëœ ë£° ì…‹(Rule Set)ìœ¼ë¡œ ì •ì  ë¶„ì„ì„ ìˆ˜í–‰í•˜ì—¬ ê²°í•¨ì„ í™•ì¸**í•˜ê³  ìƒì„±ëœ ë³´ê³ ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

    <br>

3. CheckStyle

    **ì½”ë”© ìŠ¤íƒ€ì¼ ê·œì¹™ì„ ì •ì˜í•˜ì—¬ ì²´í¬**í•´ì¤Œìœ¼ë¡œì¨ ì½”ë”© ìŠ¤íƒ€ì¼ í†µì¼í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤. 

    í”„ë¡œì íŠ¸ ì™„ë£Œ í›„ ìœ ì§€ë³´ìˆ˜í•  ë–„ ìƒê²¨ë‚˜ëŠ” ë§ì€ ë¬¸ì œì¤‘ í•˜ë‚˜ê°€ ë§ì€ í”„ë¡œê·¸ë˜ë¨¸ë“¤ì´ ê°ìì˜ ì·¨í–¥ì— ë”°ë¼ ë³€ìˆ˜ëª…, ë©”ì†Œë“œëª…, ì‘ì„±ë²•ë“±ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ”ë° ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤.

    [ê·¸ë¦¼ 2]ì— ë³´ì´ëŠ” SANS ì—°êµ¬ì†Œì˜ ìë£Œì—ëŠ” CheckStyleì´ ì—†ì§€ë§Œ SpotBugsì™€ ë”ë¶ˆì–´ PMDì™€ë„ ê°™ì´ ì •ì  ë¶„ì„ ë„êµ¬ë¡œ ë§ì´ ì“°ì´ê³  ìˆì–´ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.

    <br>

4. PMD(Programing Mistake Detector)

    SpotBugsì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ **Java ì†ŒìŠ¤ë¥¼ ì •ì  ë¶„ì„**í•˜ì—¬ ë°œê²¬ëœ ë¬¸ì œë¥¼ ë³´ê³ í•´ì¤€ë‹¤.
    
    ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” ë£° ì…‹(Rule Set)ì´ í¬í•¨ë˜ì–´ ìˆìœ¼ë©° ì‚¬ìš©ì ì§€ì • ê·œì¹™ì„ ì‘ì„±í•  ìˆ˜ë„ ìˆë‹¤.

    <br>

5. SonarQube

    SonarQubeëŠ” 20ê°œ ì´ìƒì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ `Bugs, Code Smell, ë³´ì•ˆ ì·¨ì•½ì ì„ ë°œê²¬í•  ëª©ì `ìœ¼ë¡œ ì •ì  ì½”ë“œ ë¶„ì„ìœ¼ë¡œ ìë™ ë¦¬ë·°ë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì§€ì†ì ì¸ ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬ìš© ì˜¤í”ˆ ì†ŒìŠ¤ í”Œë«í¼ì´ë‹¤. 

    SonarQubeëŠ” ìì²´ ë¶„ì„ê¸°ë¡œ ëª¨ë“  ê·œì¹™ì„ ë‹¤ë£° ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•˜ì§€ë§Œ SonarQubeì—ì„œ ë‹¤ë£¨ì§€ ì•ŠëŠ” Findbugs, PMD ë˜ëŠ” CheckStyleì˜ ê·œì¹™ì´ ì—¬ì „íˆ ìˆë‹¤. 

    SonarQube ìì²´ë¡œë„ ì¢‹ì§€ë§Œ PMD/Findbugs/Checkstyleì„ ë³„ë„ë¡œ ì‚¬ìš©í•˜ê³  Jenkins CIì—ì„œ ê°€ì‹œì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” Analysis Collector í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤. 
    
    ì´ê²ƒì˜ ì¥ì ì€ PMD/Findbugs/Checkstyle êµ¬ì„±ì„ SCMì— ì²´í¬ì¸í•˜ê³  ë³„ë„ì˜ Sonar ì„œë²„ì— ì˜ì¡´í•˜ì§€ ì•Šê³  Maven ë¹Œë“œì— í†µí•© í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.

    > ì˜¤ë˜ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬(ì˜ˆ: Java 8ì˜ ê²½ìš°)ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì—…ê·¸ë ˆì´ë“œ í˜¹ì€ ëŒ€ê¸°í•˜ëŠ” ë° ì‹œê°„ì„ ì†Œë¹„í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— SonarQubeëŠ” í˜„ì¬ PMD, Checkstyle ë° Findbugë¥¼ íê¸°í•˜ê³  ìì²´ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ì—¬ [SonarJava](https://redirect.sonarsource.com/plugins/java.html)ë¥¼ ë¶„ì„ ë° ê°œë°œí•˜ëŠ” ì¤‘ì´ë¼ê³  í•¨ 
    > ë˜í•œÂ [SonarLint](http://www.sonarlint.org/index.html)Â ë¼ëŠ” ê°œì¸ IDE ìš© ìƒˆ í”ŒëŸ¬ê·¸ì¸ì´ ì¡´ì¬

    SonarQubeì—ëŠ” `í’ˆì§ˆ í”„ë¡œíŒŒì¼(Quality Profiles)`, `í’ˆì§ˆ ê²Œì´íŠ¸(Quality Gates)`ë¼ëŠ” ì •ì±…ì´ ì¡´ì¬í•œë‹¤.

    - **í’ˆì§ˆ í”„ë¡œíŒŒì¼(Quality Profiles)**
    
        ì½”ë“œë¥¼ ë¶„ì„í•˜ê¸° ìœ„í•œ ë£°(Rule)ì˜ ì§‘í•©ì´ë‹¤.

        ê° ì–¸ì–´ë§ˆë‹¤ ë‹¤ë¥¸ í’ˆì§ˆ í”„ë¡œíŒŒì¼ë“¤ì´ ì¡´ì¬í•œë‹¤.

    - **í’ˆì§ˆ ê²Œì´íŠ¸(Quality Gates)**

        í”„ë¡œì íŠ¸ ì§€í‘œë“¤ë¡œ ì„¤ì •ëœ ì„ê³„ ê°’ì„ ì •í•œë‹¤.

        í’ˆì§ˆ ê²Œì´íŠ¸ë¥¼ í†µê³¼í•˜ê¸° ìœ„í•´ì„œëŠ” ëª¨ë“  ì„ê³„ê°’ ì¡°ê±´ì„ í†µê³¼í•´ì•¼ í•œë‹¤.

        <br>

6. Anchore

    AnchoreëŠ” `ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ìŠ¤ìºë‹ ë„êµ¬`ì´ë‹¤.

    ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•  ë•Œë§ˆë‹¤ ì•Œë ¤ì§„ ë³´ì•ˆ ì·¨ì•½ì ì„ ìŠ¤ìº”í•´ì„œ ë³´ì•ˆì ì¸ ë¬¸ì œê°€ ì—†ëŠ”ì§€ ë¶„ì„í•œë‹¤.

    ìƒì—… ë²„ì „ë„ ì¡´ì¬í•˜ì§€ë§Œ ì˜¤í”ˆ ì†ŒìŠ¤ ë²„ì „ì´ ìˆì–´ ì†ì‰½ê²Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤. 
    
    AnchoreëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ë³´ì•ˆ CVE(Common Vulnerabilities and Exposures) ëª©ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ í•´ì„œ ìŠ¤ìº”**í•˜ê³ , NPMê³¼ ë£¨ë¹„ì ¬ì— ëŒ€í•œ ë³´ì•ˆ ì·¨ì•½ì  í”¼ë“œë„ ê°€ì ¸ì˜¨ë‹¤.

    <br>

## **2. SAST(Static Application Security Testing) ì ìš©**   <a name="list2"></a>

<br>

### **2.1. OWASP Dependency Check**   <a name="list2_1"></a>

Jenkins íŒŒì´í”„ë¼ì¸ì—ì„œ OWASP Dependency Checkë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ Jenkins ì¸ìŠ¤í„´ìŠ¤ì— OWASP Dependency Checkë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“¤ì–´ì¤€ë‹¤.

```bash
$ wget https://dl.bintray.com/jeremy-long/owasp/dependency-check-5.2.4-release.zip
$ unzip dependency-check-5.2.4-release.zip
$ mv dependency-check/ /var/lib/jenkins
```

dependency-checkë¥¼ ë‹¤ìš´ ë°›ì•„ unzipí•˜ì—¬ Jenkinsì˜ í™ˆë””ë ‰í† ë¦¬ë¡œ ì‚¬ìš©ë˜ëŠ” `/var/lib/jenkins` ë””ë ‰í† ë¦¬ë¡œ ì˜®ê²¨ì¤€ë‹¤.

```bash
$ /var/lib/jenkins/dependency-check/bin/dependency-check.sh --scan `pwd` --format HTML --out /var/lib/jenkins/reports/dependency-check-report --prettyPrint
```

ìŠ¤ìº”í•  ì†ŒìŠ¤ ì½”ë“œê°€ ë“¤ì–´ìˆëŠ” í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰ dependency-checkë¥¼ ì‹¤í–‰í•œë‹¤.

--scan ì˜µì…˜ì— `pwd` ëª…ë ¹ì„ í†µí•´ ì–»ì€ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ê°€ ë“¤ì–´ê°€ì•¼í•˜ë©°, --out ì˜µì…˜ì˜ ê°’ì— í•´ë‹¹í•˜ëŠ” ë””ë ‰í† ë¦¬ì¸ `/var/lib/jenkins/reports/dependency-check-report`ì•  ìŠ¤ìº”í•˜ì—¬ ì¶œë ¥ë˜ëŠ” ë³´ê³ ì„œ íŒŒì¼ì´ ì €ì¥ëœë‹¤.

--format ì˜µì…˜ì— ë“¤ì–´ê°€ëŠ” ê°’ì€ HTML, XML, JSONì´ ì¡´ì¬í•˜ëŠ”ë°, ì—¬ê¸°ì„œëŠ” dependecy-chcek ê²°ê³¼ë¥¼ SonarQubeì—ì„œë„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ `HTML` íŒŒì¼ë¡œ ë³´ê³ ì„œê°€ ìƒì„±ë˜ë„ë¡ í–ˆë‹¤.

> ì°¸ê³ : ìŠ¤ìº” ì¤‘ì— odc.mv.db ê´€ë ¨ ì—ëŸ¬ê°€ ë°œìƒí•œ ì ì´ ìˆëŠ”ë°, $ /var/lib/jenkins/dependency-check/bin/dependency-check.sh --purge ëª…ë ¹ì„ í†µí•´ í•´ê²°ë¨

<br>

### **2.2. SpotBugs**   <a name="list2_2"></a>

Mavenì—ì„œëŠ” `pom.xml` ì´ë¼ëŠ” ë¹Œë“œ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì •ë³´ë¥¼ ê¸°ìˆ í•œë‹¤.

pom.xml íŒŒì¼ì— SpotBugsë¥¼ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œí•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•  ë•Œ SpotBugsë¥¼ í†µí•´ ì •ì  ë¶„ì„ì„ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```bash
<plugin>
    <groupId>com.github.spotbugs</groupId>
    <artifactId>spotbugs-maven-plugin</artifactId>
    <version>3.1.12.2</version>
    <configuration>
        <effort>Max</effort>
        <threshold>Low</threshold>
        <failOnError>true</failOnError>
        <plugins>
            <plugin>
                <groupId>com.h3xstream.findsecbugs</groupId>
                <artifactId>findsecbugs-plugin</artifactId>
                <version>1.10.1</version>
            </plugin>
        </plugins>
    </configuration>
    <executions>
        <execution>
            <id>scan</id>
            <phase>verify</phase>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

<br>

### **2.3. CheckStyle**   <a name="list2_3"></a>

SpotBugsì™€ ë§ˆì°¬ê°€ì§€ë¡œ pom.xml íŒŒì¼ì— CheckStyleì„ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œí•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•  ë•Œ CheckStyleì„ í†µí•´ ì •ì  ë¶„ì„ì„ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```bash
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-checkstyle-plugin</artifactId>
    <version>2.17</version>
    <executions>
        <execution>
            <id>validate</id>
            <phase>validate</phase>
            <configuration>
                <configLocation>google_checks.xml</configLocation>
                <suppressionsLocation>suppressions.xml
                </suppressionsLocation>
                <encoding>UTF-8</encoding>
                <failsOnError>true</failsOnError>
                <consoleOutput>true</consoleOutput>
                <includeTestSourceDirectory>true
                </includeTestSourceDirectory>
            </configuration>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```
<br>

### **2.4. PMD(Programing Mistake Detector)**   <a name="list2_4"></a>

OMD ë˜í•œ pom.xml íŒŒì¼ì— PMDë¥¼ ì‚¬ìš©í•˜ë„ë¡ ëª…ì‹œí•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•  ë•Œ PMDë¥¼ í†µí•´ ì •ì  ë¶„ì„ì„ ì§„í–‰í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```bash
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-pmd-plugin</artifactId>
    <version>3.13.0</version>
    <executions>
        <execution>
            <id>pmd-scan</id>
            <phase>verify</phase>
            <goals>
                <goal>check</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

<br>

### **2.5. SonarQube**   <a name="list2_5"></a>

SonarQubeë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì„¤ì¹˜í•  ìˆ˜ ìˆì§€ë§Œ ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” Dockerë¥¼ í†µí•´ì„œ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•  ê²ƒì´ë‹¤.

```bash
$ docker run --restart=always -d -p 9000:9000 -p 9092:9092 --name sonarqube sonarqube
```

Jenkins ì¸ìŠ¤í„´ìŠ¤ì—ì„œ Docker ëª…ë ¹ì„ í†µí•´ sonarqube ê³µì‹ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ 9000ë²ˆ í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•œë‹¤.

```bash
$ vim /usr/local/maven/conf/settings.xml
<settings>
    <pluginGroups>
        <pluginGroup>org.sonarsource.scanner.maven</pluginGroup>
    </pluginGroups>
    <profiles>
        <profile>
            <id>sonar</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <properties>
                <!-- Optional URL to server. Default value is http://localhost:9000 -->
                <sonar.host.url>
                http://JENKINS_SERVER_IP:9000
                </sonar.host.url>
            </properties>
        </profile>
    </profiles>
</settings>

$ mvn clean verify sonar:sonar
```

ê·¸ë¦¬ê³  ìœ„ì™€ ê°™ì´ maven ì„¤ì • íŒŒì¼ì—ì„œ SonarQube í”ŒëŸ¬ê·¸ì¸ì— ëŒ€í•´ ì„¤ì •í•˜ê³  `mvn clean verify` ëª…ë ¹ì„ í†µí•´ ë¹Œë“œí•  ë•Œ SonarQubeê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤.

<br>

ì •ìƒì ìœ¼ë¡œ SonarQubeê°€ ì‹¤í–‰ë˜ë©´ `Create New Project` ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë‹¤ìŒ [ê·¸ë¦¼ 3]ê³¼ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.

| ![create_sonarqube](/static/assets/img/landing/project/devsecops_6_3.png){: width="658" height="388"} |
|:--:| 
| [ê·¸ë¦¼ 3] SonarQube í”„ë¡œì íŠ¸ ìƒì„± |

<br>

Project keyì™€ Display nameì„ ì…ë ¥í•œ í›„ Set Up ë²„íŠ¼ì„ ëˆŒëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.

í”„ë¡œì íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆë‹¤ë©´ í† í°ì„ ìƒì„±í•œë‹¤. 

Provide a tokenì— ì„ì˜ì˜ í‚¤ë¥¼ ì…ë ¥í•œ í›„ì— Generateë¥¼ í´ë¦­í•˜ë©´ ë‹¤ìŒ [ê·¸ë¦¼ 4]ì™€ ê°™ì´ í† í° í‚¤ê°€ ìƒì„±ëœë‹¤.

| ![create_sonarqube_token](/static/assets/img/landing/project/devsecops_6_4.png){: width="516" height="353"} |
|:--:| 
| [ê·¸ë¦¼ 4] SonarQube í”„ë¡œì íŠ¸ì˜ í† í° ìƒì„± |

<br>

ìƒì„±ëœ í† í°ì€ Jenkinsì™€ SonarQubeë¥¼ ì—°ë™í•˜ì—¬ íŒŒì´í”„ë¼ì¸ì—ì„œ í™œìš©í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

ì•„ë˜ì—ëŠ” ë‹¤ìŒ [ê·¸ë¦¼ 5]ì™€ ê°™ì´ Run analysis on your project í•­ëª©ì´ ìˆëŠ”ë°, í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œ ë¶„ì„í•  ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì–¸ì–´ì™€ ë¹Œë“œ ë„êµ¬ë¥¼ ì„ íƒí•˜ë©´ SonarQube ë¶„ì„ì„ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” ëª…ë ¹ì–´ê°€ ë‚˜ì˜¨ë‹¤.

| ![sonarqube_project_configuration](/static/assets/img/landing/project/devsecops_6_5.png){: width="870" height="432"} |
|:--:| 
| [ê·¸ë¦¼ 5] SonarQube í”„ë¡œì íŠ¸ ì„¤ì • ë° ì‹¤í–‰ ë°©ë²• |

<br>

ë‹¤ìŒìœ¼ë¡œ [ê·¸ë¦¼ 6]ê³¼ ê°™ì´ Jenkinsì—ì„œ SonarQube credentialsì„ ìƒì„±í•œë‹¤.

| ![jenkins_sonarqube_credentials](/static/assets/img/landing/project/devsecops_6_6.png){: width="497" height="286"} |
|:--:| 
| [ê·¸ë¦¼ 6] Jenkinsì—ì„œ SonarQube credentials ìƒì„± |

<br>

ê·¸ë¦¬ê³  ë‹¤ìŒ [ê·¸ë¦¼ 7]ê³¼ ê°™ì´ Jenkinsì™€ ì—°ë™í•˜ê¸° ìœ„í•´ SonarQubeì—ì„œ ì›¹í›…ì„ ìƒì„±í•˜ê³  ì„¤ì •í•œë‹¤.

| ![create_sonarqube_webhook](/static/assets/img/landing/project/devsecops_6_7.png){: width="408" height="462"} |
|:--:| 
| [ê·¸ë¦¼ 7] SonarQube ì›¹í›… ìƒì„± |

<br>

ì´ë ‡ê²Œ ì„¤ì •ëœ ì›¹í›…ì€ Jenkinsì—ì„œ ìš”ì²­ì´ ì˜¤ë©´ ì •ì  ë¶„ì„ì— ëŒ€í•œ ê²°ê³¼ë¥¼ Jenkins QualifyGateì— ì‘ë‹µí•˜ê²Œ ëœë‹¤.

ë‹¤ìŒìœ¼ë¡œ [ê·¸ë¦¼ 8]ê³¼ ê°™ì´ Jenkinsì—ì„œ SonarQube ì„œë²„ë¥¼ ì—°ë™í•˜ê¸° ìœ„í•œ ì„¤ì •ì„ ì§„í–‰í•œë‹¤.

> `Jenkins ê´€ë¦¬ > ì‹œìŠ¤í…œ ì„¤ì •ì—ì„œ SonarQube Servers`ê°€ ì—†ìœ¼ë©´ Sonar Quality Gates í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•´ì•¼ í•¨

<br>

| ![jenkins_sonarqube_server_configuration](/static/assets/img/landing/project/devsecops_6_8.png){: width="914" height="353"} |
|:--:| 
| [ê·¸ë¦¼ 8] Jenkinsì—ì„œ SonarQube ì„œë²„ ì„¤ì • |

<br>

[ê·¸ë¦¼ 6]ì—ì„œ ìƒì„±í–ˆì—ˆë˜ Tokenì„ ì„ íƒí•˜ê³  SonarQube Server URLì„ ì„¤ì •í•œë‹¤.

ê·¸ë¦¬ê³  `Jenkins ê´€ë¦¬ > Global Tool Configurationì—ì„œ SonarQube Scanner`ì—ì„œ ë‹¤ìŒ [ê·¸ë¦¼ 9]ì™€ ê°™ì´ êµ¬ì„±í•œë‹¤.

> Install automaticallyë¥¼ ì²´í¬í•˜ë©´ SonarQube Scannerê°€ ìë™ìœ¼ë¡œ ì„¤ì¹˜í•˜ë„ë¡ êµ¬ì„±

<br>

| ![jenkins_sonarqube_scanner_configuration](/static/assets/img/landing/project/devsecops_6_9.png){: width="909" height="425"} |
|:--:| 
| [ê·¸ë¦¼ 9] Jenkinsì—ì„œ SonarQube ìŠ¤ìºë„ˆ ì„¤ì • |

<br>

ì—¬ê¸°ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆë‹¤ë©´ Jenkins Pipelineì— SonarQubeë¥¼ í™œìš©í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì´ ëª¨ë‘ ê°–ì¶°ì§„ ê²ƒì´ë‹¤.

ì¶”ê°€ì ìœ¼ë¡œ Jenkinsì—ì„œ SonarQubeë¡œ ë¶„ì„í•œ ê²°ê³¼ íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ CheckStyle, PMD, SpotBugsì™€ Dependency-Check ê°ê°ì˜ ë¶„ì„ ê²°ê³¼ íŒŒì¼ì˜ ê²½ë¡œë¥¼ ì„¤ì •í•´ë³´ê² ë‹¤.

ë¨¼ì € Dependency-CheckëŠ” `í™˜ê²½ì„¤ì • > í”„ë¡œì íŠ¸ ì„¤ì • > Dependency-Check` íƒ­ì— ë“¤ì–´ê°€ì„œ ì„¤ì •í•œë‹¤.

| ![sonarqube_dependency_check_configuration](/static/assets/img/landing/project/devsecops_6_10.png){: width="918" height="667"} |
|:--:| 
| [ê·¸ë¦¼ 10] SonarQubeì—ì„œ Dependency-Check ì„¤ì • |

<br>

Dependency-CheckëŠ” HTML, JSON, XML ì„¸ ê°€ì§€ íŒŒì¼ í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ë¥¼ ë„ì¶œí•  ìˆ˜ ìˆëŠ”ë°, ê° íŒŒì¼ì— ëŒ€í•œ ì €ì¥í•˜ê³  ì‹¶ì€ Pathë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤.

ë‹¤ìŒìœ¼ë¡œ CheckStyle, PMD, SpotBugëŠ” Dependency-Check íƒ­ ë°”ë¡œ ì•„ë˜ì˜ `External Analyzers` íƒ­ì—ì„œ ì„¤ì •í•œë‹¤.

| ![sonarqube_external_analyzers_configuration](/static/assets/img/landing/project/devsecops_6_11.png){: width="930" height="714"} |
|:--:| 
| [ê·¸ë¦¼ 11] SonarQubeì—ì„œ External Analyzers ì„¤ì • |

<br>

CheckStyle, PMD, SpotBugë„ ë§ˆì°¬ê°€ì§€ë¡œ ê° íˆ´ì—ì„œ ë„ì¶œëœ ê²°ê³¼ ë ˆí¬íŠ¸ íŒŒì¼ì„ ì–´ëŠ ê²½ë¡œì— ì €ì¥í•  ê²ƒì¸ì§€ë¥¼ ëª…ì‹œí•´ì¤€ë‹¤.

ê° íˆ´ì— ëŒ€í•œ ê²½ë¡œ ì„¤ì •ì´ ì •ìƒì ìœ¼ë¡œ ëë‚¬ë‹¤ë©´ Quality Profilesë¥¼ ì„¤ì •í•´ë³´ì.

| ![sonarqube_quality_profile](/static/assets/img/landing/project/devsecops_6_12.png){: width="886" height="638"} |
|:--:| 
| [ê·¸ë¦¼ 12] SonarQube í’ˆì§ˆ í”„ë¡œíŒŒì¼ êµ¬ì„± |

<br>

Quality Profilesì€ SonarQubeì—ì„œ ë¶„ì„í•  ë•Œ ì ìš©í•  Ruleì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œëŠ” `DEFAULT`ë¼ê³  ë˜ì–´ìˆëŠ” **Sonar way** Profileë¡œ ë¶„ì„ì„ í•˜ì§€ë§Œ, `BUILT-IN` ë˜ì–´ ìˆëŠ” Ruleì„ ëª¨ë‘ ë¶„ì„í•´ë³´ê¸° ìœ„í•´ **My way**ë¼ëŠ” Profileì„ ë§Œë“¤ì–´ í•˜ìœ„ Profileë¡œ ë‹¤ë¥¸ Profileì„ ë°°ì¹˜(?)í•œ í›„ì— My way Profileì˜ ì˜¤ë¥¸ìª½ í†±ë‹ˆë°”í€´ë¥¼ ëˆŒëŸ¬ Set as Defaultë¥¼ ì„¤ì •í•´ì£¼ì—ˆë‹¤.

> ì  ì¥.. Jenkinsì— SonarQube ì—°ë™í•˜ì—¬ Pipeline ì‹¤í–‰ì‹œí‚¨ ìŠ¤í¬ë¦°ìƒ·ì´ ì–´ë””ê°”ì§€ -_-;

<br>

### **2.6. Anchore**   <a name="list2_6"></a>

ë‹¤ìŒ Jenkinsì— ì—°ë™í•³ ì •ì  ë¶„ì„ ë„êµ¬ì¸ Anchoreë¥¼ ì‚´í´ë³´ê² ë‹¤. 

AnchoreëŠ” ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ì˜ ê²€ì‚¬, ë¶„ì„ ë° ì¸ì¦ì„ ìœ„í•œ ì¤‘ì•™ ì§‘ì¤‘ì‹ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ í”„ë¡œì íŠ¸ì´ë‹¤.

GEM, Java Archive (jar, war, ear), NPM, Python íŒ¨í‚¤ì§€ê°€ ì œê³µë˜ë©°, íŠ¹íˆ Jenkins í”ŒëŸ¬ê·¸ì¸ì„ í†µí•´ ì—°ë™ì´ ê°€ëŠ¥í•˜ë‹¤.

ìš°ì„  Kubernetes ë° Helmì„ í™œìš©í•˜ì—¬ Anchore ì„œë²„ë¥¼ êµ¬ì„±í•´ë³´ì.

```bash
crisis51526@cloudshell:~ (cccr-nov2)$ kubectl create namespace anchore
nameanchore created

crisis51526@cloudshell:~ (cccr-nov2)$ helm repo add anchore https://charts.anchore.io
"anchore" has been added to your repositories
crisis51526@cloudshell:~ (cccr-nov2)$ helm install anchore anchore/anchore-engine -n anchore
NAME: anchore
LAST DEPLOYED: Sat Oct 20 18:06:18 2020
NAMESPACE: anchore
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
To use Anchore Engine you need the URL, username, and password to access the API.

Anchore Engine can be accessed via port 8228 on the following DNS name from within the cluster:
anchore-anchore-engine-api.anchore.svc.cluster.local

Here are the steps to configure the anchore-cli (`pip install anchorecli`). Use these same values for direct API access as well.

To configure your anchore-cli run:

    ANCHORE_CLI_USER=admin
    ANCHORE_CLI_PASS=$(kubectl get secret --namespace anchore anchore-anchore-engine -o jsonpath="{.data.ANCHORE_ADMIN_PASSWORD}" | base64 --decode; echo)

Using the service endpoint from within the cluster you can use:
    ANCHORE_CLI_URL=http://anchore-anchore-engine-api.anchore.svc.cluster.local:8228/v1/


To verify the service is up and running, you can run container for the Anchore Engine CLI:

    kubectl run -i --tty anchore-cli --restart=Always --image anchore/engine-cli  --env ANCHORE_CLI_USER=admin --env ANCHORE_CLI_PASS=${ANCHORE_CLI_PASS} --env ANCHORE_CLI_URL=http://anchore-anchore-engine-api.anchore.svc.cluster.local:8228/v1/

from within the container you can use 'anchore-cli' commands.

* NOTE: On first startup of anchore-engine, it performs a CVE data sync which may take several minutes to complete. During this time the system status will report 'partially_down' and any images added for analysis will stay in the 'not_analyzed' state.
Once the sync is complete, any queued images will be analyzed and the system status will change to 'all_up'.

Initial setup time can be >120sec for postgresql setup and readiness checks to pass for the services as indicated by pod state. You can check with:
    kubectl get pods -l app=anchore-anchore-engine,component=api

A quick primer on using the Anchore Engine CLI follows. For more info see: https://github.com/anchore/anchore-engine/wiki/Getting-Started

View system status:

    anchore-cli system status

Add an image to be analyzed:

    anchore-cli image add <imageref>

List images and see the analysis status (not_analyzed initially):

    anchore-cli image list

Once the image is analyzed you'll see status change to 'analyzed'. This may take some time on first execution with a new database because
the system must first do a CVE data sync which can take several minutes. Once complete, the image will transition to 'analyzing' state.

When the image reaches 'analyzed' state, you can view policy evaluation output with:

    anchore-cli evaluate check <imageref>

List CVEs found in the image with:

    anchore-cli image vuln <imageref> os

List OS packages found in the image with:
    anchore-cli image content <imageref> os

List files found in the image with:
    anchore-cli image content <imageref> files
```

<br>

Anchore Engineì´ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆë‹¤ë©´ pipë¥¼ í†µí•´ anchore-cli íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê³ , anchore ì»¨í…Œì´ë„ˆì— ì „ë‹¬ ëœ secretì— ì•¡ì„¸ìŠ¤í•˜ì—¬ kubernetesì—ì„œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê²€ìƒ‰í•œë‹¤.

<br>

```bash
$ yum install -y epel-release
$ yum install -y python-pip
$ pip install anchorecli
$ export ANCHORE_CLI_USER=admin
$ export ANCHORE_CLI_PASS=foobar
$ export ANCHORE_CLI_URL=http://ANCHORE_IP:30228/v1

crisis51526@cloudshell:~/anchore-engine (cccr-nov2)$ export ANCHORE_CLI_PASS=$(kubectl get secret --namespace anchore anchore-anchore-engine -o jsonpath="{.data.ANCHORE_ADMIN_PASSWORD}" | base64 --decode; echo)
crisis51526@cloudshell:~/anchore-engine (cccr-nov2)$ echo $ANCHORE_CLI_PASS
foobar
```

<br>

ë‹¤ìŒìœ¼ë¡œ Jenkins Pipelineì—ì„œ ì‹¤í–‰í•´ë³´ê¸° ì „ì— anchore-cli ëª…ë ¹ì„ í†µí•´ ì•ì„œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ê²€ì‚¬ê°€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë³´ê² ë‹¤.

<br>

```bash
crisis51526@cloudshell:~/anchore-engine (cccr-nov2)$ vim anchore-nodeport.yaml
apiVersion: v1
kind: Service
metadata:
name: anchore-api
spec:
type: NodePort
selector:
    app: anchore-anchore-engine
    component: api
ports:
    - protocol: TCP
    port: 8228
    targetPort: 8228
    nodePort: 30228

crisis51526@cloudshell:~/anchore-engine (cccr-nov2)$ kubectl create -f anchore-nodeport.yaml -n anchore
service/anchore-api created

[root@jenkins cccr-dvwa]# anchore-cli image add jisunpark/cccr-dvwa-java-web --dockerfile=Dockerfile --force
Image Digest: sha256:fec038ff428898223fc9fb516caedbf52c4572f2e491590d8f5647e8e5d787c9
Parent Digest: sha256:fec038ff428898223fc9fb516caedbf52c4572f2e491590d8f5647e8e5d787c9
Analysis Status: not_analyzed
Image Type: docker
Analyzed At: 2020-10-20T18:43:29Z
Image ID: 85a4a0ea97867479bcb328c7a6c75691434d36ea0a0b75e6e453b22ff0f6fc7d
Dockerfile Mode: Actual
Distro: debian
Distro Version: 10
Size: 920176640
Architecture: amd64
Layer Count: 16

Full Tag: docker.io/jisunpark/cccr-dvwa-java-web:latest
Tag Detected At: 2020-10-20T18:40:33Z
```

<br>

**jisunpark/cccr-dvwa-java-web**ë¼ëŠ” í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ëŠ” DVJA(Damn Vulnerable Java Application)ë¥¼ ì‚¬ìš©í–ˆë‹¤.

DVWA(Damn Vulnerable Web Application)ëŠ” ì·¨ì•½ì ì´ ë§ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ëª¨ì˜í•´í‚¹ ë° ì‹¤ìŠµ ìš©ë„ë¡œ PHPì™€ MySQLì„ ì‚¬ìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ ê²ƒì´ê³ , DVJAëŠ” Javaë¡œ ë§Œë“¤ì–´ì§„ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤.

https://github.com/appsecco/dvja

ìœ„ì˜ gitì„ í´ë¡ í•˜ì—¬ DVJA ë„ì»¤ ì´ë¯¸ì§€ë¥¼ helmìœ¼ë¡œ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ê°œë°œí•˜ì—¬ ì‹¤ìŠµì„ ì§„í–‰í–ˆë‹¤.

ìµœì¢…ì ìœ¼ë¡œ ì •ì  ë¶„ì„ ë„êµ¬ë“¤ì„ Jenkinsì— ì—°ë™í•˜ì—¬ Pipeline ì½”ë“œë¥¼ ì‘ì„±í•œ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

<br>

```bash
properties([
    parameters([
        string(name: 'sonar.projectKey', defaultValue: 'cccr-dvwa'),
        string(name: 'sonar.host.url', defaultValue: 'http://JENKINS_SERVER_IP:9000'),
        string(name: 'sonar.login', defaultValue: '265c24760ec4f5cf1f28b87981c7bbe55c3bdffc'),
    ]) 
])
pipeline {
    environment {
        SLACK_CHANNEL = '#send-slack-message-from-jenkins'
        REGISTRY = 'crisis513/cccr-dvwa-java-web' 
        REGISTRYCREDENTIAL = 'dockerhub' 
        DOCKER_IMAGE = ''
    }
    agent any
    tools { 
        maven 'mvn' 
    }
    stages {
        stage('Git clone') {
            steps {
                git 'https://github.com/JisunParkRea/cccr-dvwa.git'
            }
        }
        stage('Docker image build and push to Dockerhub') { 
            steps{
                script {
                    DOCKER_IMAGE = docker.build registry
                    docker.withRegistry('', REGISTRYCREDENTIAL) {
                        DOCKER_IMAGE.push("latest")
                    }
                }
            }
        } 
        stage('Anchore Analysis') {
            steps {
                sh 'echo "$REGISTRY:latest `pwd`/Dockerfile" > anchore_images'
                anchore name: 'anchore_images'
            }
        }
        stage('Clean local docker image') {
            agent any
                steps { 
                sh 'docker rmi $REGISTRY:latest'
            } 
        }
        stage ('Static Analysis(PMD, SpotBugs, CheckStyle)') {
            steps {
                sh 'mvn pmd:pmd spotbugs:spotbugs checkstyle:checkstyle'
            }
        }
        stage ('Dependency-Check Analysis') {
            steps {
                sh '/var/lib/jenkins/dependency-check/bin/dependency-check.sh --scan `pwd` --format HTML --out /var/lib/jenkins/reports/dependency-check-report --prettyPrint'
            }
        }
        stage('Sonarqube and Quality gate') {
            options {
                timeout(time: 5, unit: 'MINUTES')
                retry(2)
            }
            steps {
                withSonarQubeEnv('SonarQube Server') {
                    sh "mvn sonar:sonar"
                }
                script {
                    qualitygate = waitForQualityGate()
                    if (qualitygate.status != "OK") {
                        currentBuild.result = "FAILURE"
                        slackSend (channel: $SLACK_CHANNEL, color: '#F01717', message: "*$JOB_NAME*, <$BUILD_URL|Build #$BUILD_NUMBER>")
                    }
                }
            }
        }
    }
    post { 
        success { 
            slackSend (channel: $SLACK_CHANNEL, color: '#00FF00', message: "SUCCESSFUL: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})") 
        }
        failure {
            slackSend (channel: $SLACK_CHANNEL, color: '#F01717', message: "FAILURE: '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
        }
    }
}
```

<br>

ì¼ë ¨ì˜ ê³¼ì •ì„ ì •ë¦¬í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. ì½”ë“œë¥¼ Gitì— Pushí•˜ë©´ Jenkinsì—ì„œ ì›¹í›…ì„ ë°›ì•„ íŒŒì´í”„ë¼ì¸ì´ ìë™ìœ¼ë¡œ ì‹¤í–‰

2. ì›¹í›…ì„ ë°›ì€ Git ë ˆí¬ì§€í† ë¦¬ë¥¼ Clone

3. í•´ë‹¹ Gitì— ì—…ë°ì´íŠ¸ëœ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³  ì§€ì •ëœ Docker hubë¡œ Push

4. ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ Anchoreë¡œ ë¶„ì„

5. ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì œê±° í›„ SpotBugs, PMD, CheckStyle, Dependency-Check ë„êµ¬ë¥¼ í†µí•´ ì½”ë“œ ì •ì  ë¶„ì„

6. ê·¸ë¦¬ê³  SonarQubeì—ì„œ ì„¤ì •í•œ Quality Profilesì˜ Ruleì„ ë°”íƒ•ìœ¼ë¡œ ì •ì  ë¶„ì„

7. í•´ë‹¹ íŒŒì´í”„ë¼ì¸ì˜ ì„±ê³µ ì—¬ë¶€ë¥¼ Slack ë©”ì‹œì§€ë¡œ ì „ë‹¬

<br>

í•´ë‹¹ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ë‹¤ìŒ [ê·¸ë¦¼ 13]ê³¼ ê°™ì´ ì •ìƒì ìœ¼ë¡œ íŒŒì´í”„ë¼ì¸ì´ ì‹¤í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<br>

| ![anchore_test](/static/assets/img/landing/project/devsecops_6_13.png){: width="819" height="342"} |
|:--:| 
| [ê·¸ë¦¼ 13] Jenkins ì •ì  ë¶„ì„ë„êµ¬ íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ |

<br>

> ì™œ [ê·¸ë¦¼ 13]ì— SonarQube stageëŠ” ì—†ëŠ” ê²ƒì¸ê°€... ë¶„ëª… ì„±ê³µí–ˆì—ˆëŠ”ë° ìŠ¤ìƒ·ì„ ëª»ë‚¨ê¸´ ë“¯ í•˜ë‹¤ ã… ã… ã… 

ì•„ë¬´íŠ¼ ì—¬ê¸°ê¹Œì§€ DevOps íŒŒì´í”„ë¼ì¸ì—ì„œ ë°°í¬í•  ë•Œ ì •ì  í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì³ ë°°í¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤.

Acceptance, Production ë‹¨ê³„ì¸ CD íŒŒì´í”„ë¼ì¸ì— OWASP ZAP, Hashicorp Vault, kube-monkey ë“± ë™ì  í…ŒìŠ¤íŠ¸ ìë™í™”ë„ ì ìš©ì‹œì¼œë³´ê³  ì‹¶ì—ˆì§€ë§Œ ê°‘ì‘ìŠ¤ëŸ½ê²Œ êµ°ëŒ€ë¥¼ ê°€ê²Œë˜ì–´ í•„ìëŠ” ì—¬ê¸°ê¹Œì§€ë§Œ í”„ë¡œì íŠ¸ë¥¼ ì°¸ì—¬í•˜ê²Œ ë˜ì—ˆë‹¤.ğŸ˜­ğŸ˜­
    