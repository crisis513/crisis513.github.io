<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta content="[Project] GCP를 활용한 웹사이트 구축과 모너터링 및 부하 테스트" name="description"> <meta name="keywords" content="son,blog,project,gcp"> <meta name="author" content="son"> <meta name="baseurl" content=""> <title> son | [Project] GCP를 활용한 웹사이트 구축과 모너터링 및 부하 테스트 </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20200311.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20200311.min.js"></script> <script src="/static/assets/blog-20200311.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184620200311", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">son</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href="blog/"></a></li> <li> <a class="page-scroll" href="/blog/">All</a></li> <li> <a class="page-scroll" href="/project/">Project</a></li> <li> <a class="page-scroll" href="/thesis/">Thesis</a></li> <li> <a class="page-scroll" href="/patent/">Patent</a></li> <li> <a class="page-scroll" href="/error-report/">Error-Report</a></li> <li> <a class="page-scroll" href="/idle-talk/">Idle-Talk</a></li> </ul> </div> </div> </nav> </div> <div id="inSlider" class="carousel carousel-fade" data-ride="carousel"> <ol class="carousel-indicators"> <li data-target="#inSlider" data-slide-to="0" class="active"></li> <li data-target="#inSlider" data-slide-to="1"></li> <li data-target="#inSlider" data-slide-to="2"></li> </ol> <div class="carousel-inner" role="listbox"> <div class="item active"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_one.jpg);" title="han-gi's blog"> </div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_two.jpg);" title="han-gi's blog"></div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_three.jpg);" title="han-gi's blog"></div> </div> </div> <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#inSlider" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/project">Project</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 16 Aug 2020</span> <h1> [Project] GCP를 활용한 웹사이트 구축과 모너터링 및 부하 테스트 </h1> </div> <p>구현 과정 및 설정까지 작성하여 포스팅이 다소 길지만, 프로젝트성으로 진행되어 포스팅을 따로 나누지 않았습니다.</p> <hr /> <h2 id="목차">목차</h2> <p><a href="#list1">1. 프로젝트 개요</a></p> <p><a href="#list1_2">   1.1. 프로젝트 목적</a></p> <p><a href="#list1_2">   1.2. 프로젝트 아키텍처</a></p> <p><a href="#list2">2. 프로젝트 구현</a></p> <p><a href="#list2_1">   2.1. Cloud SQL 구성</a></p> <p><a href="#list2_2">   2.2. VM 인스턴스 생성 및 워드프레스 구축</a></p> <p><a href="#list2_3">   2.3. VM 인스턴스와 Cloud SQL 연동</a></p> <p><a href="#list2_4">   2.4. 관리형 로드 밸런싱 구성</a></p> <p><a href="#list2_5">   2.5. Bucket 생성 및 백업 설정</a></p> <p><a href="#list2_6">   2.6. Stack Driver를 활용한 모니터링 및 로깅 시스템 구축</a></p> <p><a href="#list3">3. 프로젝트 테스트</a></p> <p><a href="#list3_1">   3.1. Cloud SQL 로깅 테스트</a></p> <p><a href="#list3_2">   3.2. 오토 스케일링 및 부하 테스트</a></p> <p><br /></p> <hr /> <h2 id="1-프로젝트-개요---"><span style="color:purple"><strong>1. 프로젝트 개요</strong></span> <a name="list1"></a></h2> <p><br /></p> <ul> <li> <p><strong>프로젝트 목적</strong> <a name="list1_1"></a></p> <p>본 프로젝트는 GCP의 전반적인 환경을 이해하고 흔하게 사용할 수 있는 기능들을 사용하여 GCP 환경에서 워드프레스(Wordpress)를 구축합니다.</p> <p>구축된 워드프레스 서버를 Google Cloud Console을 사용해 서비스와 상호작용하는 방법 등 GCP의 기본적인 기능들을 사용해보는 것을 목표로 진행된 프로젝트입니다.</p> <p><br /></p> <p>프로젝트 진행 당시에 notion을 통해 정리했었던 프로젝트 진행 순서는 다음 [그림 1]과 같습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_1.png" alt="What_we_did" width="560" height="310" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 1] 프로젝트 진행 순서</td> </tr> </tbody> </table> <p><br /></p> </li> <li> <p><strong>프로젝트 아키텍처</strong> <a name="list1_2"></a></p> <p>웹서비스는 CentOS 인스턴스를 생성하여 워드프레스를 구축하였고, 구축한 웹서비스에 GCP의 기능을 최대한 활용하는 형태로 프로젝트를 진행했습니다.</p> <p>다음 [그림 2]는 본 프로젝트의 구조를 쉽게 나타낼 수 있도록 아키텍처를 그린 것입니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_2.png" alt="project_architecture" width="850" height="470" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 2] 프로젝트 아키텍처</td> </tr> </tbody> </table> <p><br /></p> <p>위와 같이 Compute Engine을 통한 인스턴스 생성, 로드 밸런싱, Cloud SQL 및 Bucket 연동, Stack Driver를 통한 로깅과 모니터링하는 부분까지 진행하였습니다.</p> <p>Cloud DNS를 이용하여 도메인을 설정해보고 싶었지만, 도메인을 구입하고 등록하는 과정이 필요하여 생략하였습니다.</p> <p><br /></p> </li> </ul> <hr /> <h2 id="2-프로젝트-구현---"><span style="color:purple"><strong>2. 프로젝트 구현</strong></span> <a name="list2"></a></h2> <p><br /></p> <ul> <li> <p><strong>Cloud SQL 구성</strong> <a name="list2_1"></a></p> <p>GCP 콘솔 페이지에 접속하면 상단 바에 제품 및 리소스를 검색할 수 있는 텍스트 박스가 있습니다.</p> <p>해당 검색창에서 <code class="highlighter-rouge">Cloud SQL Admin API</code>를 입력하여 다음 [그림 3]에 보이는 <strong>사용</strong> 버튼을 눌러 <strong>Cloud SQL를 활성화</strong> 시켜줍니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_3.png" alt="enable_cloudsql" width="320" height="132" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 3] Cloud SQL Admin API 활성화</td> </tr> </tbody> </table> <p><br /></p> <p>Cloud SQL Admin API를 활성화 했다면 GCP 콘솔 페이지의 왼쪽 상단에 있는 탐색 메뉴에서 <strong>[SQL] 탭</strong>을 눌러 다음 [그림 4]와 같이 <strong>Cloud SQL 인스턴스를 생성</strong>했습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_4.png" alt="create_cloudsql_instance" width="450" height="552" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 4] Cloud SQL 인스턴스 생성</td> </tr> </tbody> </table> <p><br /></p> <p>본 프로젝트에서는 MySQL 5.7을 선택하여 데이터베이스를 생성하였고, 리전은 성능 향상을 위해 비교적 가까운 <strong>서울 리전</strong>을 선택하였습니다.</p> <p>다음으로 GCP 콘솔 기능인 Cloud Shell 화면에서 웹서버에서 사용할 데이터베이스의 설정을 진행합니다.</p><pre><code class="language-mysql">  crisis51526@cloudshell:~ (cccr-gcp-project)$ gcloud sql connect mysql-wordpress --user=root --quiet
  Allowlisting your IP for incoming connection for 5 minutes...done.
  Connecting to database with SQL user [root].Enter password: Input Your Password

  Your MySQL connection id is 187
  Server version: 5.7.25-google-log (Google)

  Copyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.

  Oracle is a registered trademark of Oracle Corporation and/or its
  affiliates. Other names may be trademarks of their respective
  owners.

  Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.

  mysql&gt; GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY 'Input Your Password' WITH GRANT OPTION;
  Query OK, 0 rows affected, 1 warning (0.05 sec)

  mysql&gt; CREATE DATABASE wordpress CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
  Query OK, 1 row affected (0.05 sec)

  mysql&gt; GRANT ALL ON wordpress.* TO 'wordpressuser'@'%' IDENTIFIED BY 'Input Your Password';
  Query OK, 0 rows affected, 1 warning (0.06 sec)

  mysql&gt; FLUSH PRIVILEGES;
  Query OK, 0 rows affected (0.06 sec)
</code></pre><p><br /></p> </li> <li> <p><strong>VM 인스턴스 생성 및 워드프레스 구축</strong> <a name="list2_2"></a></p> <p>웹서버에 연동할 Cloud SQL의 구성이 모두 끝난 후에 워드프레스를 설치할 VM 인스턴스를 생성합니다.</p> <p>탐색 메뉴에서 <strong>[Compute Engine] - [VM 인스턴스]</strong> 탭을 눌러 <strong>만들기</strong> 버튼을 클릭하여 다음 [그림 5]와 같이 인스턴스를 생성합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_5.png" alt="create_instance" width="450" height="1040" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 5] VM 인스턴스 생성</td> </tr> </tbody> </table> <p><br /></p> <p>먼저, 인스턴스를 생성할 때 앞서 생성한 Cloud SQL 인스턴스와 같은 리전(서울 - <code class="highlighter-rouge">asia-northeast3-a</code>)을 선택하도록 합니다.</p> <p>flavor는 실제 서비스를 운영할 목적이 아니기에 VM 사양이 낮은 <code class="highlighter-rouge">n1-standard-1</code>을 선택하였고,</p> <p>OS는 <code class="highlighter-rouge">CentOS 7</code>, 웹서버의 <code class="highlighter-rouge">HTTP 트래픽을 허용</code>해주도록 체크하였습니다.</p> <p><br /></p> <p>생성한 인스턴스에 워드프레스를 설치하기 위해 터미널에 입력한 명령어는 다음과 같습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>crisis51526@instance-wordpress ~]<span class="nv">$ </span><span class="nb">sudo </span>su -

  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> update
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>https://rpms.remirepo.net/enterprise/remi-release-7.rpm 
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>epel-release yum-utils

  <span class="o">[</span>root@instance-wordpress ~]# setenforce 0

  <span class="o">[</span>root@instance-wordpress ~]# yum-config-manager <span class="nt">--disable</span> remi-php54
  <span class="o">[</span>root@instance-wordpress ~]# yum-config-manager <span class="nt">--enable</span> remi-php74
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>php php-fpm
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>php-cli php-redis php-brotli php-intl php-gd php-gmp php-imap php-bcmath <span class="se">\</span>
      php-interbase php-json php-mbstring php-mysqlnd php-odbc php-opcache php-memcached php-tidy php-pdo php-pdo-dblib <span class="se">\</span>
      php-pear php-pgsql php-process php-pecl-apcu php-pecl-geoip php-pecl-imagick php-pecl-hrtime php-pecl-json <span class="se">\</span>
      php-pecl-memcache php-pecl-rar php-pecl-pq php-pecl-redis4 php-pecl-yaml php-pecl-zip
  <span class="o">[</span>root@instance-wordpress ~]# systemctl <span class="nb">enable </span>httpd
  <span class="o">[</span>root@instance-wordpress ~]# systemctl restart httpd
  <span class="o">[</span>root@instance-wordpress ~]# systemctl <span class="nb">enable </span>php-fpm <span class="o">&amp;&amp;</span> systemctl start php-fpm
    
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>redis memcached
  <span class="o">[</span>root@instance-wordpress ~]# systemctl <span class="nb">enable </span>redis <span class="o">&amp;&amp;</span> systemctl <span class="nb">enable </span>memcached 
  <span class="o">[</span>root@instance-wordpress ~]# systemctl start redis <span class="o">&amp;&amp;</span> systemctl start memcached
  <span class="o">[</span>root@instance-wordpress ~]# vim /etc/sysconfig/memcached
  <span class="nv">OPTIONS</span><span class="o">=</span><span class="s2">"-l 127.0.0.1"</span>

  <span class="o">[</span>root@instance-wordpress ~]# systemctl restart memcached
    
  <span class="o">[</span>root@instance-wordpress ~]# yum <span class="nt">-y</span> <span class="nb">install </span>wget
  <span class="o">[</span>root@instance-wordpress ~]# wget http://wordpress.org/latest.tar.gz
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">tar</span> <span class="nt">-xvzf</span> latest.tar.gz <span class="nt">-C</span> /var/www/html
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">chown</span> <span class="nt">-R</span> apache: /var/www/html/wordpress
  <span class="o">[</span>root@instance-wordpress ~]# vim /etc/httpd/conf.d/wordpress.conf
  &lt;VirtualHost <span class="k">*</span>:80&gt;
      DocumentRoot /var/www/html/wordpress
      ServerName lls.wordpress.com
      ServerAlias www.lls.wordpress.com
    
      &lt;Directory /var/www/html/wordpress/&gt;
          Options +FollowSymlinks
          AllowOverride All
      &lt;/Directory&gt;
    
      ErrorLog /var/log/httpd/tecminttest-error-log
      CustomLog /var/log/httpd/tecminttest-acces-log common
  &lt;/VirtualHost&gt;
    
  <span class="o">[</span>root@instance-wordpress ~]# systemctl restart httpd.service
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">cd</span> /var/www/html/wordpress/
  <span class="o">[</span>root@instance-wordpress wordpress]# <span class="nb">cp </span>wp-config-sample.php wp-config.php 
  <span class="o">[</span>root@instance-wordpress wordpress]# vim wp-config.php
  define<span class="o">(</span> <span class="s1">'DB_NAME'</span>, <span class="s1">'wordpress'</span> <span class="o">)</span><span class="p">;</span>
  define<span class="o">(</span> <span class="s1">'DB_USER'</span>, <span class="s1">'wordpressuser'</span> <span class="o">)</span><span class="p">;</span>
  define<span class="o">(</span> <span class="s1">'DB_PASSWORD'</span>, <span class="s1">'Input Your Password.'</span> <span class="o">)</span><span class="p">;</span>
  define<span class="o">(</span> <span class="s1">'DB_HOST'</span>, <span class="s1">'localhost'</span> <span class="o">)</span><span class="p">;</span>
</code></pre></div> </div> <p><br /></p> </li> <li> <p><strong>VM 인스턴스와 Cloud SQL 연동</strong> <a name="list2_3"></a></p> <p>워드프레스를 설치한 인스턴스에서 Cloud SQL Proxy를 통해 Cloud SQL에 연결하기 위해서는 권한이 필요하다.</p> <p>탐색 메뉴에서 <strong>[IAM 및 관리자] - [IAM]</strong> 탭을 눌러 다음 [그림 6]와 같이 새로운 구성원을 추가합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_6.png" alt="iam_create" width="800" height="627" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 6] 서비스 계정 생성</td> </tr> </tbody> </table> <p><br /></p> <p>역할에서 <strong>Cloud SQL -&gt; Cloud SQL 편집자</strong>를 선택하고 서비스 키도 생성해줍니다.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">{</span>
      <span class="s">"type"</span><span class="p">:</span> <span class="s">"service_account"</span><span class="p">,</span>
      <span class="s">"project_id"</span><span class="p">:</span> <span class="s">"cccr-gcp-project"</span><span class="p">,</span>
      <span class="s">"private_key_id"</span><span class="p">:</span> <span class="s">"3ef41c7827f3524bc358d489313f6084c229cf2f"</span><span class="p">,</span>
      <span class="s">"private_key"</span><span class="p">:</span> <span class="s">"-----BEGIN PRIVATE KEY-----</span><span class="se">\\</span><span class="s">nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCVnSNgrX4B+Vi1</span><span class="se">\\</span><span class="s">nYoTpCMXSl/p/tSjfhGaIUprWzCSfl3mVVQJlnN9mDQ8GTvg4l5UpGxvuaftV3MDN</span><span class="se">\\</span><span class="s">npwBkZ/tCKE7h/DTRx1cay28paXGV/vKZt8OwwWCCmm5Uk5ZvIvmel/oGho9TC886</span><span class="se">\\</span><span class="s">nJ1DvWSqjZL+aRwFxWJqGwpF4zxXOFjStcqhCdnT9UipCfOgqx2xBoN4N0mhkUEby</span><span class="se">\\</span><span class="s">nfqLqo7AqEYh/5/zXWR9PTm7bESbqtz2i+VUOGwDDt5U0PVatGpFahNL8qUj4lJlO</span><span class="se">\\</span><span class="s">nOzltgNICedHdUMa9B+GuSi5NOKHkuR5lOJZGcqziZFQLw3UpUyGMPVdsupcn6ZQm</span><span class="se">\\</span><span class="s">nLwdl/lpfAgMBAAECgf8TSS5GSBb2Ki5FM23unDLj8rNXwwKBzY9qAzvydF5ENEJ3</span><span class="se">\\</span><span class="s">n/X1Rm+cwQH6vUX6tzNxtcBEpqn+7kblIyT5DsyOwY4HHn7svT4Lq8U5jCDScIUEk</span><span class="se">\\</span><span class="s">nj4uqPUMzkrSmMmAx81A6IV0Zej7/dYZA+NB2Cgh1B4erW3vUIJfKx0n5SLiG2CN9</span><span class="se">\\</span><span class="s">nSRC2L3YlwKPrmGiKXSvt6p2qezDjwycooph5s8EWjZ4Wyy5lP2bjaIGqs+QzIN3s</span><span class="se">\\</span><span class="s">nYAMf3KTNF8EHNs4jJYmFiwIuz8q4zscnt3z7TF5vsgcBSgKqnE5rSa2UiyXx/8um</span><span class="se">\\</span><span class="s">nw7gU5taZh32o0Xk8AYTrVW7vYx9PkAz7g77yVFkCgYEAxQSTYZmkPxXKYs9aGeyi</span><span class="se">\\</span><span class="s">nYCRnBNgNr1WjvQ5DQGBAUQS4OiZEb6JoWDqlOvcMqvF1Vu2CPv5MTgEWrs2+mAmj</span><span class="se">\\</span><span class="s">n8xWvySm97oJ2FfnYX2rl/SmGmxbWq2CKzsU56jJNDUGBiC4/3Ot8hsy/cnzEec54</span><span class="se">\\</span><span class="s">nhU1yW+mEwq0Ew50Ab5IldcsCgYEAwmeFo8XoI86Y8MakIoW6rL9zredwf+B9qYjI</span><span class="se">\\</span><span class="s">n7VHGcEnAcCfnRevLj7kK/QFswox/cfGmIbOxd1BPBH4D6nVKmRWqIzkpnCPkVRJ8</span><span class="se">\\</span><span class="s">n5BuImNhzfurPUgJWf0lNkrRaSwbsBYf12ZQ01J5t4Bg8ArQ5nNNT4ieC9dptpYTL</span><span class="se">\\</span><span class="s">n2hFSuz0CgYAMkzEw/pR8LlDfo6p1kyP+DPTCW2PsOAQecgWa20nfofR8Sar+kRgl</span><span class="se">\\</span><span class="s">n4YBgVhpp4sWBieFRUfve0rT27Uzn+V2Mi2rP5SkpSwxsdKj51iHd2cOsrHWBNMVH</span><span class="se">\\</span><span class="s">nU1FSAGnombDB12neGO220OS7UvlbaPFKWNoewbXmkxKFxcScWnCnpwKBgQCIiwub</span><span class="se">\\</span><span class="s">nhzLQi5hybSL1uHXwRZxrhgZHWxcID7IItgop7jNC01QmkUJt1St5nxmT3/jXwEHO</span><span class="se">\\</span><span class="s">npBa+1eJaJmR7thxKP6Q7jzfBmpgShKTB1vDvYgBlIWmykT/NsV/R7ekJj3gRPniY</span><span class="se">\\</span><span class="s">ndPdSa2CDKKJlx847b1cYnmXmZp/ixM4lgUtZhQKBgQC7GBZxRh4dx6JWqQ8J2Vaq</span><span class="se">\\</span><span class="s">n1sE83o0/K0i4i2MqEw70CG4nFs5831fnV6DSVWpyvxlN9M8Ce19ZcpVLP4UD0pE6</span><span class="se">\\</span><span class="s">ndTKGhvdIkQeat9yWBr4J/+d9jz3uleXGZCmVYrR/f2Ge8Vb/DWEUf2Ps9s0QZkoO</span><span class="se">\\</span><span class="s">nN6xZ+UJBHIwBp+i3pLqXOw==</span><span class="se">\\</span><span class="s">n-----END PRIVATE KEY-----</span><span class="se">\\</span><span class="s">n"</span><span class="p">,</span>
      <span class="s">"client_email"</span><span class="p">:</span> <span class="s">"wpmanager@cccr-gcp-project.iam.gserviceaccount.com"</span><span class="p">,</span>
      <span class="s">"client_id"</span><span class="p">:</span> <span class="s">"116608554003641610764"</span><span class="p">,</span>
      <span class="s">"auth_uri"</span><span class="p">:</span> <span class="s">"&lt;https://accounts.google.com/o/oauth2/auth&gt;"</span><span class="p">,</span>
      <span class="s">"token_uri"</span><span class="p">:</span> <span class="s">"&lt;https://oauth2.googleapis.com/token&gt;"</span><span class="p">,</span>
      <span class="s">"auth_provider_x509_cert_url"</span><span class="p">:</span> <span class="s">"&lt;https://www.googleapis.com/oauth2/v1/certs&gt;"</span><span class="p">,</span>
      <span class="s">"client_x509_cert_url"</span><span class="p">:</span> <span class="s">"&lt;https://www.googleapis.com/robot/v1/metadata/x509/wpmanager</span><span class="si">%40</span><span class="s">cccr-gcp-project.iam.gserviceaccount.com&gt;"</span>
  <span class="p">}</span>
</code></pre></div> </div> <p>생성된 서비스 키의 샘플입니다. Cloud SQL Proxy를 통해 Cloud SQL에 접속할 때 필요합니다.</p> <p><br /></p> <p>그리고 다음 [그림 7]과 같이 Cloud SQL 인스턴스에서 접근을 허용할 네트워크를 추가해주어야 합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_7.png" alt="cloudsql_configuration" width="650" height="442" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 7] Cloud SQL 인스턴스 설정</td> </tr> </tbody> </table> <p><br /></p> <p>연결 방식을 <strong>공개 IP</strong>에 체크하여 프록시를 통해 Cloud SQL에 접근할 수 있도록 설정하고,</p> <p>아래쪽의 네트워크 추가 버튼을 눌러 워드프레스 <strong>웹서버의 공개 IP 주소를 등록</strong>합니다.</p> <p><br /></p> <p>다음은 워드프레스 웹서버에서 Cloud SQL에 접속하는 과정을 정리한 명령어입니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>root@instance-wordpress wordpress]# yum <span class="nt">-y</span> <span class="nb">install </span>mysql
  <span class="o">[</span>root@instance-wordpress wordpress]# mysql <span class="nt">-u</span> root <span class="nt">-p</span> <span class="nt">-h</span> 34.64.148.237
  Enter password: 
  Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\\</span>g.
  Your MySQL connection <span class="nb">id </span>is 343
  Server version: 5.7.25-google-log <span class="o">(</span>Google<span class="o">)</span>

  Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

  Type <span class="s1">'help;'</span> or <span class="s1">'\\h'</span> <span class="k">for </span>help. Type <span class="s1">'\\c'</span> to clear the current input statement.

  MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
  +--------------------+
  | Database           |
  +--------------------+
  | information_schema |
  | mysql              |
  | performance_schema |
  | sys                |
  | wordpress          |
  +--------------------+
  5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>

  MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> <span class="nb">exit
  </span>Bye

  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">mkdir</span> /cloudsql
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">chmod </span>777 /cloudsql
  <span class="o">[</span>root@instance-wordpress ~]# wget https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 <span class="nt">-O</span> cloud_sql_proxy
  <span class="nt">--2020-08-02</span> 10:39:20--  https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64
  Resolving dl.google.com <span class="o">(</span>dl.google.com<span class="o">)</span>... 172.217.161.238, 2404:6800:400a:80c::200e
  Connecting to dl.google.com <span class="o">(</span>dl.google.com<span class="o">)</span>|172.217.161.238|:443... connected.
  HTTP request sent, awaiting response... 200 OK
  Length: 14492253 <span class="o">(</span>14M<span class="o">)</span> <span class="o">[</span>application/octet-stream]
  Saving to: ‘cloud_sql_proxy’

  100%[<span class="o">=========================================================================&gt;]</span> 14,492,253  22.0MB/s   <span class="k">in </span>0.6s   

  2020-08-02 10:39:21 <span class="o">(</span>22.0 MB/s<span class="o">)</span> - ‘cloud_sql_proxy’ saved <span class="o">[</span>14492253/14492253]

  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">chmod</span> +x cloud_sql_proxy
  <span class="o">[</span>root@instance-wordpress ~]# vim wordpress-key.json
  <span class="c"># wpmanager 서비스 계정에서 키를 만들 때 생성된 json 내용 입력</span>

  <span class="o">[</span>root@instance-wordpress ~]# ./cloud_sql_proxy <span class="nt">-dir</span><span class="o">=</span>/cloudsql <span class="nt">-instances</span><span class="o">=</span>cccr-gcp-project:asia-northeast3:mysql-wordpress <span class="nt">-credential_file</span><span class="o">=</span>/root/wordpress-key.json &amp;
  <span class="o">[</span>1] 15932
  <span class="o">[</span>root@instance-wordpress ~]# 2020/08/02 15:23:07 Rlimits <span class="k">for </span>file descriptors <span class="nb">set </span>to <span class="o">{</span>&amp;<span class="o">{</span>8500 8500<span class="o">}}</span>
  2020/08/02 15:23:07 using credential file <span class="k">for </span>authentication<span class="p">;</span> <span class="nv">email</span><span class="o">=</span>wpmanager@cccr-gcp-project.iam.gserviceaccount.com
  2020/08/02 15:23:07 Listening on /cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress <span class="k">for </span>cccr-gcp-project:asia-northeast3:mysql-wordpress
  2020/08/02 15:23:07 Ready <span class="k">for </span>new connections<span class="k">*</span>

  <span class="o">[</span>root@instance-wordpress ~]# mysql <span class="nt">-u</span> root <span class="nt">-p</span> <span class="nt">-S</span> /cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress 
  Enter password: 
  2020/08/02 10:52:05 New connection <span class="k">for</span> <span class="s2">"cccr-gcp-project:asia-northeast3:mysql-wordpress"</span>
  Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\\</span>g.
  Your MySQL connection <span class="nb">id </span>is 429
  Server version: 5.7.25-google-log <span class="o">(</span>Google<span class="o">)</span>

  Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

  Type <span class="s1">'help;'</span> or <span class="s1">'\\h'</span> <span class="k">for </span>help. Type <span class="s1">'\\c'</span> to clear the current input statement.

  MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> <span class="nb">exit
  </span>Bye
  2020/08/02 10:52:24 Client closed <span class="nb">local </span>connection on /cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress

  <span class="o">[</span>root@instance-wordpress ~]# ps
  PID TTY          TIME CMD
  1467 pts/0    00:00:00 <span class="nb">sudo
  </span>1469 pts/0    00:00:00 su
  1470 pts/0    00:00:00 bash
  16476 pts/0    00:00:00 cloud_sql_proxy
  16517 pts/0    00:00:00 ps
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">kill</span> <span class="nt">-9</span> 16476
  <span class="o">[</span>1]+  Killed                  ./cloud_sql_proxy <span class="nt">-dir</span><span class="o">=</span>/cloudsql <span class="nt">-instances</span><span class="o">=</span>cccr-gcp-project:asia-northeast3:mysql-wordpress <span class="nt">-credential_file</span><span class="o">=</span>wordpress-key.json
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">mkdir</span> <span class="nt">-p</span> /opt/cloudsqlproxy/
  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">cp </span>cloud_sql_proxy /opt/cloudsqlproxy/
  <span class="o">[</span>root@instance-wordpress ~]# vim ~/cloudsqlproxy.service
  <span class="o">[</span>Unit]
  <span class="nv">Description</span><span class="o">=</span>Google Cloud SQL Proxy
  <span class="nv">After</span><span class="o">=</span>syslog.target network.target auditd.service

  <span class="o">[</span>Service]
  <span class="nv">ExecStart</span><span class="o">=</span>/opt/cloudsqlproxy/cloud_sql_proxy <span class="nt">-dir</span><span class="o">=</span>/cloudsql <span class="nt">-instances</span><span class="o">=</span>cccr-gcp-project:asia-northeast3:mysql-wordpress <span class="nt">-credential_file</span><span class="o">=</span>/root/wordpress-key.json
  <span class="nv">ExecStop</span><span class="o">=</span>/bin/kill <span class="nt">-TERM</span> <span class="nv">$MAINPID</span>

  <span class="o">[</span>Install]
  <span class="nv">WantedBy</span><span class="o">=</span>multi-user.target

  <span class="o">[</span>root@instance-wordpress ~]# <span class="nb">cp</span> ~/cloudsqlproxy.service /etc/systemd/system/
  <span class="o">[</span>root@instance-wordpress ~]# systemctl daemon-reload
  <span class="o">[</span>root@instance-wordpress ~]# systemctl start cloudsqlproxy
  <span class="o">[</span>root@instance-wordpress ~]# systemctl <span class="nb">enable </span>cloudsqlproxy
  Created symlink from /etc/systemd/system/multi-user.target.wants/cloudsqlproxy.service to /etc/systemd/system/cloudsqlproxy.service.
  <span class="o">[</span>root@instance-wordpress ~]# systemctl status cloudsqlproxy
  ● cloudsqlproxy.service - Google Cloud SQL Proxy
      Loaded: loaded <span class="o">(</span>/etc/systemd/system/cloudsqlproxy.service<span class="p">;</span> disabled<span class="p">;</span> vendor preset: disabled<span class="o">)</span>
      Active: active <span class="o">(</span>running<span class="o">)</span> since Sun 2020-08-02 10:55:53 UTC<span class="p">;</span> 13s ago
  Main PID: 16524 <span class="o">(</span>cloud_sql_proxy<span class="o">)</span>
      CGroup: /system.slice/cloudsqlproxy.service
              └─16524 /opt/cloudsqlproxy/cloud_sql_proxy <span class="nt">-dir</span><span class="o">=</span>/cloudsql <span class="nt">-instances</span><span class="o">=</span>cccr-gcp-project:asia-northeast3...

  Aug 02 10:55:53 instance-wordpress systemd[1]: Started Google Cloud SQL Proxy.
  Aug 02 10:55:53 instance-wordpress cloud_sql_proxy[16524]: 2020/08/02 10:55:53 Rlimits <span class="k">for </span>file descriptors s...0<span class="o">}}</span>
  Aug 02 10:55:53 instance-wordpress cloud_sql_proxy[16524]: 2020/08/02 10:55:53 using credential file <span class="k">for </span>auth...com
  Aug 02 10:55:53 instance-wordpress cloud_sql_proxy[16524]: 2020/08/02 10:55:53 Listening on /cloudsql/cccr-gc...ess
  Aug 02 10:55:53 instance-wordpress cloud_sql_proxy[16524]: 2020/08/02 10:55:53 Ready <span class="k">for </span>new connections
  Hint: Some lines were ellipsized, use <span class="nt">-l</span> to show <span class="k">in </span>full.

  <span class="o">[</span>root@instance-wordpress wordpress]# vim /var/www/html/wordpress/wp-config.php
  define<span class="o">(</span> <span class="s1">'DB_HOST'</span>, <span class="s1">'localhost:/cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress'</span> <span class="o">)</span><span class="p">;</span>
</code></pre></div> </div> <p>Cloud SQL Proxy가 정상적으로 동작하는지 테스트 한 후에 데몬을 생성하여 cloudsqlproxy 서비스가 실행되도록 했습니다.</p> <p>wordpress-key.json 파일의 내용에는 위에서 wpmanager 서비스 계정의 키를 만들 때 생성된 json 내용을 입력하면 됩니다.</p> <p>워드프레스의 설정파일에서 데이터베이스 설정 값에 cloudsqlproxy 서비스로 생겨난 소켓 파일의 경로를 적어주고 정상적으로 연결되는지 확인합니다.</p> <p><br /></p> <p>Cloud SQL에 정상적으로 연결되었다면 워드프레스를 설치하고 워드프레스 데이터베이스와 테이블이 정상적으로 생성되었는지 확인하도록 합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_8.png" alt="wordpress_installation" width="750" height="554" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 8] 워드프레스 설치</td> </tr> </tbody> </table> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_9.png" alt="wordpress_theme" width="1000" height="541" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 9] 워드프레스 테마 적용</td> </tr> </tbody> </table> <p><br /></p> <p>워드프레스 설치 및 테마 적용이 정상적으로 이루어진 후에 Cloud SQL에서 워드프레스 데이터베이스의 테이블이 정상적으로 생성되었는지 확인합니다.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">[</span><span class="n">root</span><span class="o">@</span><span class="n">instance</span><span class="o">-</span><span class="n">wordpress</span> <span class="o">~</span><span class="p">]</span><span class="c1"># mysql -u root -p -S /cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress
</span>  <span class="n">Enter</span> <span class="n">password</span><span class="p">:</span> 
  <span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">MariaDB</span> <span class="n">monitor</span><span class="o">.</span>  <span class="n">Commands</span> <span class="n">end</span> <span class="k">with</span> <span class="p">;</span> <span class="ow">or</span> \\<span class="n">g</span><span class="o">.</span>
  <span class="n">Your</span> <span class="n">MySQL</span> <span class="n">connection</span> <span class="nb">id</span> <span class="ow">is</span> <span class="mi">1478</span>
  <span class="n">Server</span> <span class="n">version</span><span class="p">:</span> <span class="mf">5.7.25</span><span class="o">-</span><span class="n">google</span><span class="o">-</span><span class="n">log</span> <span class="p">(</span><span class="n">Google</span><span class="p">)</span>

  <span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="n">Oracle</span><span class="p">,</span> <span class="n">MariaDB</span> <span class="n">Corporation</span> <span class="n">Ab</span> <span class="ow">and</span> <span class="n">others</span><span class="o">.</span>

  <span class="n">Type</span> <span class="s">'help;'</span> <span class="ow">or</span> <span class="s">'</span><span class="se">\\</span><span class="s">h'</span> <span class="k">for</span> <span class="n">help</span><span class="o">.</span> <span class="n">Type</span> <span class="s">'</span><span class="se">\\</span><span class="s">c'</span> <span class="n">to</span> <span class="n">clear</span> <span class="n">the</span> <span class="n">current</span> <span class="nb">input</span> <span class="n">statement</span><span class="o">.</span>

  <span class="n">MySQL</span> <span class="p">[(</span><span class="n">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="n">use</span> <span class="n">wordpress</span>
  <span class="n">Reading</span> <span class="n">table</span> <span class="n">information</span> <span class="k">for</span> <span class="n">completion</span> <span class="n">of</span> <span class="n">table</span> <span class="ow">and</span> <span class="n">column</span> <span class="n">names</span>
  <span class="n">You</span> <span class="n">can</span> <span class="n">turn</span> <span class="n">off</span> <span class="n">this</span> <span class="n">feature</span> <span class="n">to</span> <span class="n">get</span> <span class="n">a</span> <span class="n">quicker</span> <span class="n">startup</span> <span class="k">with</span> <span class="o">-</span><span class="n">A</span>

  <span class="n">Database</span> <span class="n">changed</span>
  <span class="n">MySQL</span> <span class="p">[</span><span class="n">wordpress</span><span class="p">]</span><span class="o">&gt;</span> <span class="n">show</span> <span class="n">tables</span><span class="p">;</span>
  <span class="o">+-----------------------+</span>
  <span class="o">|</span> <span class="n">Tables_in_wordpress</span>   <span class="o">|</span>
  <span class="o">+-----------------------+</span>
  <span class="o">|</span> <span class="n">wp_commentmeta</span>        <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_comments</span>           <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_links</span>              <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_options</span>            <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_postmeta</span>           <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_posts</span>              <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_term_relationships</span> <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_term_taxonomy</span>      <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_termmeta</span>           <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_terms</span>              <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_usermeta</span>           <span class="o">|</span>
  <span class="o">|</span> <span class="n">wp_users</span>              <span class="o">|</span>
  <span class="o">+-----------------------+</span>
  <span class="mi">12</span> <span class="n">rows</span> <span class="ow">in</span> <span class="nb">set</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</code></pre></div> </div> <p><br /></p> </li> <li> <p><strong>관리형 로드 밸런싱 구성</strong> <a name="list2_4"></a></p> <p>GCLB(Google Cloud Load Balancing)을 구성하기 위해서는 기본적으로 대상으로 할 인스턴스 그룹이 존재해야 합니다. 인스턴스 그룹은 <strong>오토 스케일링(Auto-scaling)을 위한</strong> <code class="highlighter-rouge">관리형 인스턴스 그룹</code>과 <strong>템플릿을 사용하지 않고 직접 VM 인스턴스를 추가할 수 있는</strong> <code class="highlighter-rouge">비관리형 인스턴스 그룹</code>으로 나뉩니다.</p> <p><br /></p> <p>본 프로젝트에서는 관리형 인스턴스 그룹을 구성하고 부하 분산기를 생성하여 로스 밸런싱 환경을 구축합니다.</p> <p>먼저 VM 인스턴스에 대한 <code class="highlighter-rouge">스냅샷을 생성</code>하고, 생성한 스냅샷으로 <code class="highlighter-rouge">이미지를 생성</code>합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_10.png" alt="create_snapshot" width="400" height="566" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 10] 스냅샷 생성</td> </tr> </tbody> </table> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_11.png" alt="create_image" width="400" height="689" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 11] 이미지 생성</td> </tr> </tbody> </table> <p><br /></p> <p>이미지까지 정상적으로 생성되었다면 다음으로 관리형 인스턴스 그룹을 만들기 전에 다음 [그림 12]과 같이 <code class="highlighter-rouge">인스턴스 템플릿을 생성</code>합니다.</p> <p>그룹에 속한 VM의 종류가 여러 개라면 모든 VM의 운영체제의 이미지를 지정해야 합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_12.png" alt="create_instance_template" width="400" height="881" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 12] 인스턴스 템플릿 생성</td> </tr> </tbody> </table> <p><br /></p> <p>인스턴스 템플릿을 정상적으로 생성한 후에 다음 [그림 13]과 같이 <code class="highlighter-rouge">관리형 인스턴스 그룹을 생성</code>합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_13.png" alt="create_instance_group" width="700" height="1114" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 13] 인스턴스 그룹 생성</td> </tr> </tbody> </table> <p><br /></p> <p>인스턴스 그룹까지 정상적으로 생성되었다면 부하 분산기를 생성할 준비가 끝났습니다.</p> <p>탐색 메뉴에서 <strong>[네트워크 서비스] - [부하 분산]</strong> 탭에 들어와서 <code class="highlighter-rouge">부하 분산기 만들기</code>를 눌러줍니다.</p> <p>HTTP(S), TCP, UDP에 대한 부하 분산기를 만들 수 있으며 본 프로젝트에서는 워드프레스를 통한 웹서버 인스턴스를 부하 분산 시켜주기 위해 <code class="highlighter-rouge">HTTP(S) 부하 분산기</code>를 선택하고 <code class="highlighter-rouge">인터넷 트래픽을 VM으로 분산</code>을 눌러줍니다.</p> <p><br /></p> <p>다음 단계로 넘어오면 백엔드 서비스와 프런트엔드 서비스를 생성하는 화면으로 넘어오게 됩니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_14.png" alt="create_lb_backend" width="400" height="589" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 14] 백엔드 서비스 생성</td> </tr> </tbody> </table> <p><br /></p> <p>기존에 만들어둔 백엔드 서비스가 없기 때문에 새로운 서비스 생성을 선택하고 백앤드 서비스의 이름과 앞에서 생성한 인스턴스 그룹을 선택하면 됩니다. 다음으로는 로드밸런서에서 들어온 트래픽을 인스턴스 그룹의 인스턴스들의 어느 포트로 전달할 것인지를 포트 번호에 정의하는데, 여기서는 HTTP 트래픽을 전달하는 것이기 때문에 80을 선택합니다.</p> <p><br /></p> <p>백엔드 서비스를 생성할 때 상태 확인(Health check)을 선택하는 항목이 있는데 마찬가지로 기존에 만들어둔 상태 확인이 없기 때문에 새로 생성합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_15.png" alt="create_lb_check" width="400" height="465" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 15] 상태 확인 생성</td> </tr> </tbody> </table> <p><br /></p> <p>상태 확인은 인스턴스 그룹 내의 인스턴스가 양호한지를 체크하고 만약에 정상적이지 않으면 비정상 노드는 부하 분산에서 빼버리는 기능을 수행합니다. 프로토콜은 HTTP를 입력하고, 포트에는 HTTP 포트인 80포트, 그리고 서비스가 정상인지를 확인하는 확인 간격은 체크 주기이고, 제한 시간은 이 시간(초)내에 응답이 없으면 장애라고 판단을 합니다.</p> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_16.png" alt="create_lb_frontend" width="400" height="493" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 16] 프런트엔드 서비스 생성</td> </tr> </tbody> </table> <p><br /></p> <p>마지막으로 프런트엔드 서비스를 설정하는데, 여기서는 어떤 프로토콜을 어떤 IP와 포트로 받을 것인지, HTTPS의 경우에는 SSL 인증서를 설정하는 작업을 합니다. 본 프로젝트에서는 HTTP 프로토콜을 80 포트로 설정하기 때문에 [그림 16]과 같이 설정하고, 부하 분산 이름을 입력하여 생성을 완료합니다.</p> <p><br /></p> <p>정상적으로 부하 분산기가 생성이 되면 다음 [그림 17]과 같이 백엔드 서비스에 지정된 인스턴스 그룹에 해당하는 인스턴스가 모두 정상 동작하는 화면을 볼 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_17.png" alt="lb_detail" width="800" height="404" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 17] 부하 분산기 세부 정보</td> </tr> </tbody> </table> <p><br /></p> </li> <li> <p><strong>Bucket 생성 및 백업 설정</strong> <a name="list2_5"></a></p> <p>탐색 메뉴에서 <strong>[Storage] - [브라우저]</strong> 탭을 눌러 <strong>버킷 생성</strong> 버튼을 클릭하여 버킷을 생성합니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_18.png" alt="create_bucket" width="900" height="145" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 18] 버킷 생성</td> </tr> </tbody> </table> <p><br /></p> <p>버킷 이름을 입력하고 리전을 아시아로 설정한 후에 나머지는 기본 값으로 생성하게 되면 위의 [그림 18]과 같이 버킷이 생성된 모습을 확인할 수 있습니다.</p> <p><br /></p> <p>생성한 버킷의 권한 탭에 들어오면 버킷에 접근 가능한 구성원들과 역할을 확인할 수 있습니다.</p> <p>다음 [그림 19]에서 보이는 <strong>추가</strong> 버튼을 클릭하여 새로운 구성원을 추가해줍니다.</p> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_19.png" alt="bucket_allUsers" width="500" height="223" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 19] 버킷 allUsers 구성원 추가</td> </tr> </tbody> </table> <p><br /></p> <p><code class="highlighter-rouge">allUsers</code> 구성원에 <code class="highlighter-rouge">저장소 개체 관리자</code> 역할을 주어 모든 사용자들이 저장소에 접근할 수 있도록 설정했습니다.</p> <p><br /></p> <p>다음은 Cloud SQL에 저장된 wordpress 데이터베이스를 <code class="highlighter-rouge">mysqldump</code>하여 <code class="highlighter-rouge">crontab</code>을 통해 주기적으로 백업하기 위한 명령어입니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>root@instance-wordpress ~]# vim /etc/my.cnf
  <span class="o">[</span>mysqldump]
  <span class="nv">user</span><span class="o">=</span>root
  <span class="nv">password</span><span class="o">=</span>Input Your Password

  <span class="o">[</span>root@instance-wordpress ~]# vim cloudsql_backup.sh
  <span class="c">#!/bin/bash</span>
  <span class="nv">db_instance</span><span class="o">=</span>mysql-wordpress
  <span class="nv">db_name</span><span class="o">=</span>wordpress
  <span class="nv">db_user</span><span class="o">=</span>root
  <span class="nv">bucket_name</span><span class="o">=</span>gs://bucket-mysql-wordpress
  <span class="nv">socket_path</span><span class="o">=</span>/cloudsql/cccr-gcp-project:asia-northeast3:mysql-wordpress
  <span class="nv">date_YYYYMMDDHHMMSS</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> <span class="s1">'+%Y%m%d%H%M%S'</span><span class="sb">`</span>
  <span class="nv">backupfile_name</span><span class="o">=</span>wordpress_<span class="k">${</span><span class="nv">date_YYYYMMDDHHMMSS</span><span class="k">}</span>.sql

  <span class="nb">echo</span> <span class="s2">"Cloud SQLl daily backup start.."</span>

  <span class="c">#gcloud sql export csv $db_instance $bucket_name/test.csv --database=$db_name --query=$sql_query</span>
  mysqldump <span class="nt">-u</span> <span class="nv">$db_user</span> <span class="nt">-S</span> <span class="nv">$socket_path</span> <span class="nt">--databases</span> <span class="nv">$db_name</span> <span class="nt">--hex-blob</span> <span class="nt">--single-transaction</span> <span class="nt">--default-character-set</span><span class="o">=</span>utf8mb4 <span class="o">&gt;</span> <span class="nv">$backupfile_name</span>

  gsutil <span class="nb">mv</span> <span class="nv">$backupfile_name</span> <span class="nv">$bucket_name</span>

  <span class="nb">echo</span> <span class="s2">"Cloud SQL daily backup stop.."</span>

  <span class="o">[</span>root@instance-wordpress ~]# crontab <span class="nt">-e</span>
  0 <span class="k">*</span>/3 <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /root/cloudsql_backup.sh
</code></pre></div> </div> <p><br /></p> <p>Cloud SQL을 백업하는 쉘 스크립트를 작성하여 crontab에 등록하여 3시간 주기로 mysqldump가 실행되도록 설정해두고 일정 시간이 지난 후에 버킷에 정상적으로 백업되어 저장됐는지 확인하였습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_20.png" alt="cloudsql_bucket_backup1" width="800" height="323" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 20] crontab을 사용한 Cloud SQL의 주기적인 백업</td> </tr> </tbody> </table> <p><br /></p> <p>위의 [그림 20]에서 최종 수정 날짜를 확인해보면 3시간 주기로 저장되어 있는 것을 확인할 수 있습니다.</p> <p><br /></p> <p>같은 형태로 이번에는 syslog를 백업하는 쉘 스크립트를 작성하여 crontab에 등록합니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">[</span>root@instance-wordpress ~]# vim apache_log_backup.sh
  <span class="c">#!/bin/bash</span>

  <span class="nb">echo</span> <span class="s2">"syslog daily backup start.."</span>

  <span class="nb">cat</span> /var/log/messages | <span class="nb">grep</span> <span class="nt">-iE</span> <span class="s2">"apache|wordpress"</span> <span class="o">&gt;&gt;</span> /root/apache_log_backup_<span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%y-%m-%d'</span><span class="si">)</span>.log
  gsutil <span class="nb">cp</span> /root/apache_log_backup_<span class="k">*</span>.log gs://bucket-mysql-wordpress/apache_log_backup/
  <span class="nb">rm</span> <span class="nt">-rf</span> /root/<span class="k">*</span>.log

  <span class="nb">echo</span> <span class="s2">"syslog daily backup stop.."</span>

  <span class="o">[</span>root@instance-wordpress ~]# crontab <span class="nt">-e</span>
  <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> /root/apache_log_backup.sh
</code></pre></div> </div> <p><br /></p> <p>이번에는 매 분마다 쉘 스크립트를 실행하도록 crontab에 등록하고 버킷을 확인해보았습니다.</p> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_21.png" alt="syslog_bucket_backup" width="800" height="383" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 21] crontab을 사용한 syslog의 주기적인 백업</td> </tr> </tbody> </table> <p><br /></p> </li> <li> <p><strong>Stack Driver를 활용한 모니터링 및 로깅 시스템 구축</strong> <a name="list2_6"></a></p> <ul> <li> <p>VM 인스턴스에 monitoring-agent 설치</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>curl <span class="nt">-sSO</span> https://dl.google.com/cloudagents/add-monitoring-agent-repo.sh
  <span class="nv">$ </span><span class="nb">sudo </span>bash add-monitoring-agent-repo.sh
  <span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> update
  <span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>stackdriver-agent

  <span class="nv">$ </span><span class="nb">sudo </span>systemctl start stackdriver-agent
  <span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>stackdriver-agent
</code></pre></div> </div> </li> <li> <p>VM 인스턴스에 logging-agent 설치</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>curl <span class="nt">-sSO</span> https://dl.google.com/cloudagents/add-logging-agent-repo.sh
  <span class="nv">$ </span><span class="nb">sudo </span>bash add-logging-agent-repo.sh
  <span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> update
  <span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>google-fluentd
  <span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nt">-y</span> <span class="nb">install </span>google-fluentd-catch-all-config-structured

  <span class="nv">$ </span><span class="nb">sudo </span>systemctl start google-fluentd
  <span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>google-fluentd
</code></pre></div> </div> </li> </ul> <p><br /></p> <p>모니터링과 로깅을 할 VM 인스턴스에 에이전트를 설치하고 <strong>[모니터링] - [대시보드]</strong> 탭을 눌러 들어갑니다.</p> <p>대시보드 페이지에 들어오면 <code class="highlighter-rouge">Create Dashboard</code> 버튼을 통해 새로운 대시보드를 생성할 수 있습니다.</p> <p>원하는 대시보드의 이름을 입력하고 대시보드를 생성하면 우측 상단에 <code class="highlighter-rouge">Add Chart</code> 버튼을 눌러 원하는 차트들을 추가하여 대시보드를 커스터마이징할 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_22.png" alt="add_chart" width="800" height="402" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 22] 대시보드 차트 추가</td> </tr> </tbody> </table> <p><br /></p> <p>위의 [그림 22]와 같이 차트에 나타낼 CPU, Memory, I/O 등 모니터링할 항목들의 <code class="highlighter-rouge">Metric</code>과 Instance, Group 등 <code class="highlighter-rouge">Resource 타입</code>을 지정하고 차트를 생성할 수 있습니다. 원하는 차트를 추가하고 대시보드를 확인하면 다음 [그림 23]과 같이 monitoring-agent을 통해 VM 인스턴스의 Metric들을 모니터링할 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_23.png" alt="monitoring_dashboard" width="1000" height="744" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 23] 모니터링 대시보드 완성</td> </tr> </tbody> </table> <p><br /></p> <p>다음으로 로깅 시스템은 <strong>[로그 기록] - [로그 뷰어]</strong> 탭에 들어오면 다음 [그림 24]와 같이 logging-agent를 통해 수집된 로그들을 확인할 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_24.png" alt="log_viewer" width="900" height="294" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 24] 로그 뷰어 확인</td> </tr> </tbody> </table> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_25.png" alt="log_query" width="900" height="316" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 25] 로그 뷰어 쿼리 빌더</td> </tr> </tbody> </table> <p><br /></p> </li> </ul> <hr /> <h2 id="3-프로젝트-테스트---"><span style="color:purple"><strong>3. 프로젝트 테스트</strong></span> <a name="list3"></a></h2> <p><br /></p> <ul> <li> <p><strong>Cloud SQL 로깅 테스트</strong> <a name="list3_1"></a></p> <p>서비스 중인 워드프레스 서버에서 Cloud SQL에 대한 접속을 시도하는데 다음 [그림 26]과 같이 패스워드를 잘못 입력한 상황입니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_26.png" alt="cloudsql_connection_failure" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 26] Cloud SQL 접속 실패</td> </tr> </tbody> </table> <p><br /></p> <p>패스워드를 잘못 입력하여 접속을 실패하여 쉘에 나타나는 로그를 다음 [그림 27]처럼 GCP의 로그 뷰어에서도 확인할 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_27.png" alt="cloudsql_log_viewer" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 27] Cloud SQL 접속 실패 로그 뷰어</td> </tr> </tbody> </table> <p><br /></p> </li> <li> <p><strong>오토 스케일링 및 부하 테스트</strong> <a name="list3_2"></a></p> <p>다음으로 아파치(Apache)의 <code class="highlighter-rouge">JMeter</code>라는 툴을 사용하여 부하 테스트를 진행합니다.</p> <p>JMeter에서 핵심 기능은 웹 HTTP/HTTPS 프로토콜을 통해 클라이언트의 요청을 수행하여 부하를 발생시키는 것입니다.</p> <p>요청에 대한 성공/실패, 소요 시간 등의 정보를 기록하여 제공해줍니다.</p> <p>다음 [그림 28]은 테스트할 사용자 수 및 반복 횟수 등을 설정해 웹 사이트 서버의 성능을 테스트한 내용입니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_28.png" alt="jmeter" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 28] JMeter로 부하 테스트</td> </tr> </tbody> </table> <p><br /></p> <p>여기서 <strong>스레드를 300개와 1000개 두 번의 부하 테스트를 진행</strong>하였고, 300개의 스레드로 요청을 보냈을 때 오토 스케일링 기능으로 인해 인스턴스의 갯수가 2개에서 3개로 늘어났고, 1000개의 스레드로 부하를 주었을 때 3개에서 4개로 인스턴스가 자동 확장되는 것을 확인할 수 있었습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_29.png" alt="instance_upscale" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 29] 인스턴스 자동 확장</td> </tr> </tbody> </table> <p><br /></p> <p>위의 [그림 29]는 인스턴스가 3개에서 4개로 확장되는 장면을 캡처한 것입니다.</p> <p>다음으로 부하 테스트를 진행하면서 인스턴스가 자동 생성되는 부분을 모니터링을 통해 확인하였습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_30.png" alt="instance_upscale_monitoring" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 30] 인스턴스 확장 모니터링</td> </tr> </tbody> </table> <p><br /></p> <p>위의 [그림 30]에서 볼 수 있듯이 부하 테스트를 수행한 시점에 <strong>CPU, Memory, Network traffic이 확 늘어난 것을 확인</strong>할 수 있고, 그와 동시에 인스턴스가 각각 하나씩 생겨난 것을 확인할 수 있습니다. 메모리 사용량을 확인하는 부분에서 측정 항목(인스턴스)가 새로 생겨난 것을 쉽게 확인할 수 있습니다.</p> <p>그 후 <strong>마지막 10분</strong>을 <code class="highlighter-rouge">안정화 기간</code>이라고 하는데, 안정화 기간동안 관찰된 최대 부하를 기준으로 관리형 인스턴스 그룹이 유지되면 자동으로 인스턴스가 축소 되는 것을 확인할 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/project/gcp_toyproject_31.png" alt="instance_downscale" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 31] 인스턴스 자동 축소</td> </tr> </tbody> </table> <p><br /></p> <p>물론 안정화 기간에 대한 설정은 로드밸런싱을 구성할 때 따로 설정이 가능하고, 인스턴스는 생성된지 가장 오래된 인스턴스를 우선으로 삭제되는 것 같았습니다.</p> <p>이로써 GCP의 기능을 활용한 서버 구성과 로깅 및 테스트까지 정상적으로 끝났습니다!</p> <p><br /></p> </li> </ul> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">son</button> <button class="btn btn-white btn-xs" type="button">blog</button> <button class="btn btn-white btn-xs" type="button">project</button> <button class="btn btn-white btn-xs" type="button">gcp</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> <i class="fa fa-comments-o"> </i> <span class="disqus-comment-count" data-disqus-url="http://localhost:4000/project/2020/08/16/gcp_project.html">0</span> comments </div> </div> </div> </div> <div class="PageNavigation"> <a class="prev" href="/project/2020/04/30/ssustack_installer.html">&laquo; [Project] ssustack_installer</a> <a class="next" href="/project/2020/08/30/linux_vulnerability_diagnosis_project.html">[Project] Linux 취약점 진단 및 평가와 로깅 &raquo;</a> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ /* var disqus_config = function () { this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { var d = document, s = d.createElement('script'); s.src = '//son.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93473370-3', 'auto'); ga('require', ''); ga('send', 'pageview'); </script> <!-- GrowingIO --> <script id="dsq-count-scr" src="https://son.disqus.com/count.js" async></script> </body> </html>
