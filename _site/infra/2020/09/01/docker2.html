<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta content="[Docker] 도커 이미지와 컨테이너 및 볼륨 기초" name="description"> <meta name="keywords" content="son,blog,infra,docker,image,container,volume"> <meta name="author" content="s6i"> <meta name="baseurl" content=""> <title> s6i | [Docker] 도커 이미지와 컨테이너 및 볼륨 기초 </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20200311.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20200311.min.js"></script> <script src="/static/assets/blog-20200311.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184620200311", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">s6i</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href="blog/"></a></li> <li> <a class="page-scroll" href="/blog/">All</a></li> <li> <a class="page-scroll" href="/project/">Project</a></li> <li> <a class="page-scroll" href="/thesis/">Thesis</a></li> <li> <a class="page-scroll" href="/patent/">Patent</a></li> <li> <a class="page-scroll" href="/infra/">Infra</a></li> <li> <a class="page-scroll" href="/sample/">Sample</a></li> </ul> </div> </div> </nav> </div> <div id="inSlider" class="carousel carousel-fade" data-ride="carousel"> <ol class="carousel-indicators"> <li data-target="#inSlider" data-slide-to="0" class="active"></li> <li data-target="#inSlider" data-slide-to="1"></li> <li data-target="#inSlider" data-slide-to="2"></li> </ol> <div class="carousel-inner" role="listbox"> <div class="item active"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_one.jpg);" title="first banner image"> </div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_two.jpg);" title="second banner image"></div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_three.jpg);" title="third banner image"></div> </div> </div> <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#inSlider" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/infra">Infra</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 1 Sep 2020</span> <h1> [Docker] 도커 이미지와 컨테이너 및 볼륨 기초 </h1> </div> <hr /> <h3 id="목차">목차</h3> <p><a href="#list1">1. 도커 이미지(Docker Image)</a></p> <p><a href="#list1_1">   1.1. 도커 허브(Docker Hub)</a></p> <p><a href="#list1_2">   1.2. 도커 이미지 관련 명령어 실습</a></p> <p><a href="#list2">2. 도커 컨테이너(Docker Container)</a></p> <p><a href="#list2_1">   2.1. 컨테이너 관련 명령어 실습</a></p> <p><a href="#list3">3. 도커 볼륨(Docker Volume)</a></p> <p><a href="#list3_1">   3.1. 도커에서 데이터 관리</a></p> <p><a href="#list3_2">   3.2. Bind Mount 사용</a></p> <p><a href="#list3_3">   3.3. 볼륨 사용 실습</a></p> <hr /> <h2 id="1-도커-이미지---"><span style="color:purple"><strong>1. 도커 이미지</strong></span> <a name="list1"></a></h2> <p><br /></p> <ul> <li> <p><strong>도커 허브(Docker Hub)</strong> <a name="list1_1"></a></p> <p>자신의 계정이 있다면 프로젝트를 Push/Pull 할 수 있는 Github와 같이 도커에서도 도커 허브라는 컨테이너 이미지 저장소를 제공하고 있습니다.</p> <p>Github와 마찬가지로 도커 계정이 있다면 누구나 Push/Pull 할 수 있다는 점에서 비슷합니다.</p> <p><a href="https://hub.docker.com/">Docker Hub</a> 사이트에서 회원가입하여 사용하실 수 있습니다.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/docker_image.png" alt="docker_image" width="760" height="330" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 1] 깃허브와 도커 허브</td> </tr> </tbody> </table> <p><br /></p> <ul> <li> <p>도커에서 운영하고 있는 컨테이너 이미지 저장소</p> </li> <li> <p>도커 허브에 저장된 이미지의 이름은 <strong>저장소 이름:태그</strong> 형태</p> </li> <li> <p>Inactive 이미지(6개월간 Push나 Pull이 한 번도 일어나지 않은 이미지)는 삭제 대상이 됨</p> </li> </ul> <p><br /></p> <p>이 외의 자세한 정보는 아래의 도커의 FAQ 문서를 참고해주세요.</p> <p><a href="https://www.docker.com/pricing/resource-consumption-updates">Resource Consumption Updates FAQ</a></p> <p><a href="https://www.docker.com/legal/docker-terms-service">Docker Terms of Service</a></p> <p><br /></p> </li> <li> <p><strong>도커 이미지 관련 명령어 실습</strong> <a name="list1_2"></a></p> <ol> <li> <p><strong>docker search</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker search centos
</code></pre></div> </div> <p>도커 이미지를 검색하기 위해 <code class="highlighter-rouge">docker search</code> 명령어를 사용합니다. 해당 명령어는 centos 공식 이미지가 있는지를 검색하게 됩니다.</p> </li> <li> <p><strong>docker pull</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker pull httpd
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker pull centos:7
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker pull mysql:5.7
</code></pre></div> </div> <p>이미지를 다운로드하기 위해 <code class="highlighter-rouge">docker pull 이미지명:태그명</code> 명령어를 사용합니다.</p> <p>태그를 생략하면 가장 최신 버전(latest)를 자동으로 받게 되고, 태그를 지정하면 해당 태그의 이미지를 다운로드 하게 됩니다.</p> <p>위의 명령어를 수행하면 최신버전의 httpd 이미지, 7 태그(버전)에 해당하는 centos 이미지와 5.7 태그(버전)에 해당하는 mysql 이미지를 다운로드 받을 수 있습니다.</p> </li> <li> <p><strong>docker image</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker images
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker image <span class="nb">ls</span>
</code></pre></div> </div> <p>이미지 목록을 보기 위한 명령어로 <code class="highlighter-rouge">docker images</code>를 사용합니다.</p> </li> <li> <p><strong>docker rmi</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker rmi hello-world:latest
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker rmi mysql:5.7
</code></pre></div> </div> <p>이미지를 삭제하기 위해<code class="highlighter-rouge">docker rmi</code> 명령어를 사용합니다.</p> <p>기본적으로 컨테이너가 실행되고 있으면 삭제되지 않지만 <code class="highlighter-rouge">-f</code> 옵션을 사용하여 이미지를 강제로 삭제시킬 수 있습니다.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker rmi <span class="sb">`</span>docker images <span class="nt">-aq</span><span class="sb">`</span>
</code></pre></div> </div> <p>나아가 모든 이미지를 한번에 삭제하고자 한다면 다음과 같이 docker images 명령의 -a, -q 옵션을 사용하여 이미지 ID를 구한 뒤 docker rmi 명령에 넘겨주는 방법이 있습니다.</p> </li> <li> <p><strong>docker inspect</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker inspect httpd:latest
 <span class="o">[</span>
     <span class="o">{</span>
         <span class="s2">"Id"</span>: <span class="s2">"8aadfb1607e5065070b96cbe5e3259312038cc0e51b2ba62e4ea9da802691574"</span>,
         <span class="s2">"Created"</span>: <span class="s2">"2020-08-18T07:16:27.598216826Z"</span>,
         <span class="s2">"Path"</span>: <span class="s2">"httpd-foreground"</span>,
         <span class="s2">"Args"</span>: <span class="o">[]</span>,
         <span class="s2">"State"</span>: <span class="o">{</span>
             <span class="s2">"Status"</span>: <span class="s2">"running"</span>,
             <span class="s2">"Running"</span>: <span class="nb">true</span>,
             <span class="s2">"Paused"</span>: <span class="nb">false</span>,
             <span class="s2">"Restarting"</span>: <span class="nb">false</span>,
             <span class="s2">"OOMKilled"</span>: <span class="nb">false</span>,
             <span class="s2">"Dead"</span>: <span class="nb">false</span>,
             <span class="s2">"Pid"</span>: 4925,
             <span class="s2">"ExitCode"</span>: 0,
             <span class="s2">"Error"</span>: <span class="s2">""</span>,
             <span class="s2">"StartedAt"</span>: <span class="s2">"2020-08-18T07:20:00.233063636Z"</span>,
             <span class="s2">"FinishedAt"</span>: <span class="s2">"2020-08-18T07:19:49.732866179Z"</span>
         <span class="o">}</span>,
     ...<span class="o">(</span>중략<span class="o">)</span>
</code></pre></div> </div> <p>도커 오브젝트의 정보를 자세하게 확인하고싶을 때 <code class="highlighter-rouge">docker inspect</code> 명령을 사용합니다. 컨테이너 혹은 이미지의 low level 정보를 확인할 수 있고, 기본적인 출력 포맷은 <code class="highlighter-rouge">json</code> 형태입니다.</p> </li> <li> <p><strong>docker save</strong> / <strong>docker load</strong></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker save <span class="nt">-o</span> img.tar centos:7 httpd:latest
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span><span class="nb">tar </span>tf img.tar
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> img.tar 
 <span class="nt">-rw-------</span><span class="nb">.</span> 1 user user 393334272  8월 10 13:56 img.tar
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker rmi centos:7 httpd:latest

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker load <span class="nt">-i</span> img.tar
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker images
 REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
 centos              7                   831691599b88        4 days ago          215MB
 httpd               latest              a6ea92c35c43        4 days ago          166MB
</code></pre></div> </div> <p>호스트에 저장된 이미지를 아카이브로 복사하기 위해 <code class="highlighter-rouge">docker save</code> 명령어를 사용하고, 아카이브 파일을 미이지로 불러오기 위해 <code class="highlighter-rouge">docker load</code> 명령어를 사용합니다.</p> <p>2번에서 생성한 centos:7 이미지와 httpd:latest 이미지를 img.tar라는 이름으로 저장하고나서 두 이미지를 삭제한 후에 img.tar 파일으로 이미지를 불러오는 것을 확인할 수 있습니다.</p> </li> </ol> </li> </ul> <p><br /></p> <h2 id="2-도커-컨테이너docker-container---"><span style="color:purple"><strong>2. 도커 컨테이너(Docker Container)</strong></span> <a name="list2"></a></h2> <p><br /></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker version
Client: Docker Engine - Community
    Version:           19.03.12
    API version:       1.40
    Go version:        go1.13.10
    Git commit:        48a66213fe
    Built:             Mon Jun 22 15:46:54 2020
    OS/Arch:           linux/amd64
    Experimental:      <span class="nb">false

</span>Server: Docker Engine - Community
    Version:           19.03.12
    API version:       1.40
    Go version:        go1.13.10
    Git commit:        48a66213fe
    Built:             Mon Jun 22 15:46:54 2020
    OS/Arch:           linux/amd64
    Experimental:      <span class="nb">false</span>

</code></pre></div></div> <p>도커 버전을 확인하기 위해 <code class="highlighter-rouge">docker version</code> 명령어를 입력하면 도커의 버전 정보가 클라이언트와 서버로 나뉘어져 있습니다. 도커는 하나의 명령어로 실행되지만 실제로는 클라이언트와 서버 역할을 각각 할 수 있습니다.</p> <p><br /></p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/docker_client_host.png" alt="docker_client_host" width="523" height="228" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[그림 2] 도커 클라이언트와 호스트</td> </tr> </tbody> </table> <p><br /></p> <p>도커 명령어를 입력하면 도커 클라이언트가 도커 서버로 명령을 전송하고 결과를 받아 터미널에 출력해줍니다. 기본값이 도커 서버의 소켓을 바라보고 있기 때문에 사용자는 의식하지 않고 마치 바로 명령을 내리는 것 같은 느낌을 받습니다.</p> <p><br /></p> <ul> <li> <p><strong>컨테이너 관련 명령어 실습</strong> <a name="list2_1"></a></p> <ul> <li> <p><strong>컨테이너 생성 및 확인</strong></p> <ol> <li> <p>docker ps</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker ps
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker ps <span class="nt">-a</span>
</code></pre></div> </div> <p>컨테이너 목록을 확인하기 위해 <code class="highlighter-rouge">docker ps</code> 명령어를 사용합니다.</p> <p>현재 호스트에 존재하는 모든 컨테이너를 출력하고 싶다면 <code class="highlighter-rouge">-a</code> 옵션을 추가하면 됩니다.</p> </li> <li> <p>web1 컨테이너 생성</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker create <span class="nt">--name</span> web1 httpd:latest
</code></pre></div> </div> <p>컨테이너를 생성하기 위해 <code class="highlighter-rouge">docker create</code> 명령어를 사용합니다.</p> <p>생성할 컨테이너의 이름은 web1 이고 httpd:latest 이미지를 사용하여 컨테이너를 생성합니다.</p> </li> <li> <p>os1 컨테이너 생성</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker create <span class="nt">-it</span> <span class="nt">--name</span> os1 centos:latest 
 1457915352d8967c6a910d102481120b731329219d258144637302b321da2c3e
</code></pre></div> </div> <p><code class="highlighter-rouge">-it</code> 옵션은 <code class="highlighter-rouge">-i</code>와 <code class="highlighter-rouge">-t</code>를 동시에 사용한 것으로 터미널 입력을 위해 자주 사용되는 옵션입니다.</p> <p>-i, –interactive=false: <strong>표준 입력(stdin)을 활성화</strong>하며 컨테이너와 연결(attach)되어 있지 않더라도 표준 입력을 유지합니다. 보통 이 옵션을 사용하여 Bash에 명령을 입력합니다.</p> <p>-t, –tty=false: <strong>TTY 모드(pseudo-TTY)를 사용</strong>합니다. <strong>Bash를 사용하려면 이 옵션을 설정</strong>해야 합니다. 이 옵션을 설정하지 않으면 명령을 입력할 수는 있지만 셸이 표시되지 않습니다.</p> </li> <li> <p>web1 컨테이너 시작</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker start web1
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker inspect web1 | <span class="nb">grep </span>IPAddress
         <span class="s2">"SecondaryIPAddresses"</span>: null,
         <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.2"</span>,
                 <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.2"</span>,

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>curl 172.17.0.2
 &lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;
</code></pre></div> </div> <p><code class="highlighter-rouge">docker create</code> 명령으로 생성한 컨테이너를 사용하려면 다음과 같이 <code class="highlighter-rouge">docker start</code> 명령으로 컨테이너를 시작해주어야 합니다.</p> <p>web1 이름의 컨테이너를 시작하고 <code class="highlighter-rouge">docker inspect</code> 명령을 통해 web1 컨테이너의 ip 주소를 확인하여 <code class="highlighter-rouge">curl</code> 명령을 통해 해당 ip 주소의 웹서버가 정상적으로 동작하는지 확인합니다.</p> </li> <li> <p>os1 컨테이너 시작</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker start <span class="nt">-ai</span> os1
 <span class="o">[</span>root@1457915352d8 /]#
 <span class="o">[</span>root@1457915352d8 /]# <span class="nb">exit
 exit</span>
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker ps
 CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES
 4a0638e6bea2        httpd:latest        <span class="s2">"httpd-foreground"</span>   10 minutes ago      Up 4 minutes        80/tcp              web1
</code></pre></div> </div> <p>컨테이너를 시작할 때 <code class="highlighter-rouge">-a</code>, <code class="highlighter-rouge">-i</code> 옵션을 추가하면 컨테이너를 시작시킨 후에 Bash 화면을 연결해줍니다. -a 옵션의 설명은 다음과 같습니다.</p> <p>-a, –attach=[]: 컨테이너에 표준 입력(stdin), 표준 출력(stdout), 표준 에러(stderr)를 연결합니다.</p> </li> <li> <p>docker run 명령으로 web2 컨테이너 실행</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> web2 httpd:latest
</code></pre></div> </div> <p>이미지로 컨테이너를 생성할 때는 <code class="highlighter-rouge">docker run</code> 명령어를 사용합니다. <code class="highlighter-rouge">-d</code> 옵션의 설명은 다음과 같습니다.</p> <p>-d, –detach=false: <strong>Detached 모드</strong>입니다. 보통 데몬 모드라고 부르며 컨테이너가 백그라운드로 실행됩니다.</p> </li> <li> <p>os2 컨테이너 실행</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--name</span> os2 centos:latest 
 <span class="o">[</span>root@f20ddba876c2 /]#
</code></pre></div> </div> </li> <li> <p>os3 컨테이너 실행하면서 hostname 명령 실행</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">--name</span> os3 centos:latest <span class="nb">hostname</span>
</code></pre></div> </div> <p>위 명령어는 os3 컨테이너의 hostname을 한 번 출력하고 프로세스가 종료됩니다.</p> </li> <li> <p>os4 컨테이너 실행 후 삭제</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">--name</span> os4 <span class="nt">--rm</span> centos:latest <span class="nb">hostname</span>
</code></pre></div> </div> <p>위 명령어는 os4 컨테이너의 hostname을 한 번 출력하고 프로세스가 종료된 후에 컨테이너가 삭제됩니다.</p> </li> <li> <p>컨테이너 삭제</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">rm </span>os3
</code></pre></div> </div> <p>컨테이너를 삭제하기 위해 <code class="highlighter-rouge">docker rm</code> 명령어를 사용합니다.</p> </li> <li> <p>실행되는 컨테이너 외 전부 삭제</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker container prune
<span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker ps <span class="nt">-a</span>
CONTAINER ID        IMAGE               COMMAND              CREATED             STATUS              PORTS               NAMES
f20ddba876c2        centos:latest       <span class="s2">"/bin/bash"</span>          6 minutes ago       Up 6 minutes                            os2
60c84d29c6dc        httpd:latest        <span class="s2">"httpd-foreground"</span>   6 minutes ago       Up 6 minutes        80/tcp              web2
1457915352d8        centos:latest       <span class="s2">"/bin/bash"</span>          44 minutes ago      Up 30 minutes                           os1
4a0638e6bea2        httpd:latest        <span class="s2">"httpd-foreground"</span>   47 minutes ago      Up 41 minutes       80/tcp              web1
</code></pre></div> </div> <p>실행되는 컨테이너 외의 모든 컨테이너를 삭제하기 위해 <code class="highlighter-rouge">docker container prune</code> 명령어를 사용합니다.</p> </li> <li> <p>docker stats</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker stats 
</code></pre></div> </div> <p>컨테이너의 실시간 상태를 확인하기 위해서는 <code class="highlighter-rouge">docker stats</code> 명령어를 사용합니다.</p> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>컨테이너 중지 및 제거</strong></p> <ol> <li> <p>os2 컨테이너 중지</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker stop os2
</code></pre></div> </div> </li> <li> <p>os2 컨테이너 삭제</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">rm </span>os2
</code></pre></div> </div> </li> <li> <p>실행중인 컨테이너 삭제</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">rm </span>os1 <span class="nt">-f</span>
</code></pre></div> </div> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>컨테이너 실행 시 유용한 설정</strong></p> <ol> <li> <p>환경변수</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--name</span> os3 <span class="nt">-e</span> <span class="s2">"LAB=docker"</span> centos:latest
 <span class="o">[</span>root@38b6ed0b4cdb /]# <span class="nb">echo</span> <span class="nv">$LAB</span>
 docker
 <span class="o">[</span>root@38b6ed0b4cdb /]# <span class="nb">exit</span>
</code></pre></div> </div> </li> <li> <p>cpu 제한</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-it</span> <span class="nt">--name</span> os3 <span class="nt">--cpus</span> 0.3 centos:latest
 <span class="o">[</span>root@c2df3a13921e /]# <span class="nb">dd </span><span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/null &amp;
</code></pre></div> </div> <p><code class="highlighter-rouge">--cpus 0.3</code> 명령을 통해 컨테이너의 cpu 사용을 30%로 제한할 수 있습니다.</p> </li> <li> <p>메모리 제한</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-itd</span> <span class="nt">--name</span> os5 <span class="nt">--memory</span> 1024m centos:latest
</code></pre></div> </div> <p><code class="highlighter-rouge">--memory 1024m</code> 명령을 통해 메모리 사용을 1GB로 제한할 수 있습니다.</p> </li> <li> <p>자원 제한 변경</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker update <span class="nt">--memory</span> 2048m os5

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker update <span class="nt">--cpus</span> 0.05 os5
 os5
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker attach os5
 <span class="o">[</span>root@50c259122bc9 /]# <span class="nb">dd </span><span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/dev/null &amp;
</code></pre></div> </div> <p><code class="highlighter-rouge">docker update</code> 명령을 통해 cpu 혹은 메모리의 제한을 변경할 수 있습니다.</p> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>컨테이너 접근 및 실행</strong></p> <ol> <li> <p>docker attach</p> <p>표준 입력, 표준 출력/에러를 포함하는 컨테이너에 연결이 가능합니다.</p> </li> <li> <p>docker exec</p> <p>실행중인 컨테이너에서 명령을 실행이 가능합니다.</p> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>컨테이너 프로세스 및 로그 확인</strong></p> <p>컨테이너에서 실행 중인 프로세스와 로그를 확인할 수 있습니다.</p> <ol> <li> <p>docker top</p> <ul> <li> <p>컨테이너에서 실행되는 프로세스의 정보를 확인 가능</p> </li> <li> <p>리눅스의 ps 옵션을 그대로 사용 가능함</p> </li> </ul> </li> <li> <p>docker logs</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> db1 mysql:5.7
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker logs db1
 2020-08-10 06:54:13+00:00 <span class="o">[</span>ERROR] <span class="o">[</span>Entrypoint]: Database is uninitialized and password option is not specified
     You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">--name</span> db2 <span class="nt">-e</span> <span class="s2">"MYSQL_ROOT_PASSWORD=1234"</span> <span class="nt">-d</span> mysql:5.7
</code></pre></div> </div> <p><code class="highlighter-rouge">docker logs</code> 명령어를 통해 컨테이너의 로그를 확인할 수 있습니다.</p> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>컨테이너에 파일 복사 및 확인</strong></p> <ol> <li> <p>docker cp</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">cp</span> /etc/passwd os5:/tmp
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">exec </span>os5 <span class="nb">ls</span> <span class="nt">-l</span> /tmp/passwd
 <span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 root root 2304 Aug 10 02:15 /tmp/passwd
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">cp </span>os5:/tmp/passwd /home/user/
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> passwd
 <span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 user user 2304  8월 10 11:15 passwd
</code></pre></div> </div> <p><code class="highlighter-rouge">docker cp</code> 명령어를 통해 호스트 파일을 컨테이너로 복사하거나 컨테이너의 파일을 호스트에 복사할 수 있습니다.</p> </li> <li> <p>docker diff</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker diff os5
 C /tmp
 A /tmp/passwd
</code></pre></div> </div> <p>컨테이너에서의 파일의 변경 상태를 체크하기 위해 <code class="highlighter-rouge">docker diff</code> 명령어를 사용합니다.</p> <ul> <li> <p>docker diff 명령으로 출력되는 파일의 상태</p> <ul> <li> <p>A : 파일이 추가됨</p> </li> <li> <p>C : 파일이 변경됨</p> </li> <li> <p>D : 파일이 삭제됨</p> </li> </ul> </li> </ul> </li> </ol> </li> </ul> </li> </ul> <hr /> <h2 id="3-도커-볼륨docker-volume---"><span style="color:purple"><strong>3. 도커 볼륨(Docker Volume)</strong></span> <a name="list3"></a></h2> <p><br /></p> <ul> <li> <p><strong>도커에서 데이터 관리</strong> <a name="list3_1"></a></p> <ul> <li> <p>기본적으로 컨테이너에 생성되는 모든 파일은 컨테이너 레이어에 저장됨</p> <ul> <li> <p>컨테이너와 함께 삭제되는 런타임 데이터</p> </li> <li> <p>이 데이터를 영구적으로 저장하려면 반드시 볼륨을 사용해야 함</p> </li> </ul> </li> </ul> <p><br /></p> <ol> <li> <p>Bind Mount</p> <ul> <li> <p>초기 도커부터 사용했던 방식</p> </li> <li> <p>호스트의 특정 디렉토리와 컨테이너의 디렉토리를 연결하는 방식</p> </li> <li> <p>따로 기록하지 않으면 관리하기 쉽지 않음</p> </li> <li> <p>성능이 뛰어나지만 호스트의 파일 시스템에 대한 의존도가 높음</p> </li> <li> <p>호스트의 민감한 파일까지 접근할 수 있음으로 보안 측면인 문제가 발생 가능함</p> </li> </ul> </li> <li> <p>볼륨</p> <ul> <li> <p>도커에 의해 관리되는 스토리지</p> </li> <li> <p>docker 명령을 사용하여 생성 가능, 사용되지 않으면 한꺼번에 삭제 가능</p> </li> <li> <p>이미지의 Volumes 부분에 어떤 값이 지정되어 있는 경우, 컨테이너로 실행할 때 볼륨을 지정해야 함</p> </li> <li> <p>다양한 드라이버를 지원</p> </li> </ul> </li> </ol> </li> </ul> <p><br /></p> <ul> <li> <p><strong>Bind Mount 사용</strong> <a name="list3_2"></a></p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ```bash
  [user@docker ~]$ mkdir ~/bm1
  [user@docker ~]$ touch ~/bm1/fileA.txt

  [user@docker ~]$ docker run -dit --name os3 -v ~/bm1:/tmp/mount centos:latest

  [user@docker ~]$ docker exec os3 ls -l /tmp/mount
  total 0
  -rw-rw-r--. 1 1000 1000 0 Aug 10 07:23 fileA.txt

  [user@docker ~]$ sudo -i
  [sudo] user의 암호: 
  [root@docker ~]# cd /var/lib/docker/volumes/
  [root@docker volumes]# ls -l
  ```
</code></pre></div> </div> </li> </ul> <p><br /></p> <ul> <li> <p><strong>볼륨 사용 실습</strong> <a name="list3_3"></a></p> <ol> <li> <p>vol1 볼륨 생성</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker volume create vol1
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker inspect vol1 
 <span class="o">[</span>
     <span class="o">{</span>
         <span class="s2">"CreatedAt"</span>: <span class="s2">"2020-08-18T16:28:04+09:00"</span>,
         <span class="s2">"Driver"</span>: <span class="s2">"local"</span>,
         <span class="s2">"Labels"</span>: <span class="o">{}</span>,
         <span class="s2">"Mountpoint"</span>: <span class="s2">"/var/lib/docker/volumes/vol1/_data"</span>,
         <span class="s2">"Name"</span>: <span class="s2">"vol1"</span>,
         <span class="s2">"Options"</span>: <span class="o">{}</span>,
         <span class="s2">"Scope"</span>: <span class="s2">"local"</span>
     <span class="o">}</span>
 <span class="o">]</span>

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
 <span class="o">[</span>root@docker ~]# <span class="nb">cd</span> /var/lib/docker/volumes/
 <span class="o">[</span>root@docker volumes]# <span class="nb">ls</span>
</code></pre></div> </div> </li> <li> <p>vol1 볼륨을 os4의 /tmp/volume에 연결</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-itd</span> <span class="nt">--name</span> os4 <span class="nt">-v</span> vol1:/tmp/volume centos:latest

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">exec </span>os4 <span class="nb">ls</span> <span class="nt">-l</span> /tmp/volume
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker <span class="nb">exec </span>os4 <span class="nb">touch</span> /tmp/volume/fileB.txt

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-i</span>
 <span class="o">[</span>root@docker ~]# <span class="nb">cd</span> /var/lib/docker/volumes/vol1/_data/
 <span class="o">[</span>root@docker _data]# <span class="nb">ls
 </span>fileB.txt

 <span class="o">[</span>root@docker _data]# <span class="nb">exit
 logout</span>
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker attach os4
 <span class="o">[</span>root@f083223357e9 /]# <span class="nb">cd</span> /tmp/volume/
 <span class="o">[</span>root@f083223357e9 volume]# <span class="nb">ls</span> <span class="nt">-l</span>
 total 0
 <span class="nt">-rw-r--r--</span><span class="nb">.</span> 1 root root 0 Aug 10 07:31 fileB.txt
 <span class="o">[</span>root@f083223357e9 volume]# <span class="nb">cat</span> <span class="o">&gt;</span> index.html
 Hello World!

 <span class="o">[</span>root@f083223357e9 volume]# <span class="nb">read </span>escape sequence <span class="o">(</span>Ctrl + p + q<span class="o">)</span>
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> web3 <span class="nt">-v</span> vol1:/usr/local/apache2/htdocs

 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> web3 <span class="nt">-v</span> vol1:/usr/local/apache2/htdocs:ro httpd:latest
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>docker inspect web3 | <span class="nb">grep</span> <span class="nt">-i</span> ipaddress
             <span class="s2">"SecondaryIPAddresses"</span>: null,
             <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.7"</span>,
                     <span class="s2">"IPAddress"</span>: <span class="s2">"172.17.0.7"</span>,
 <span class="o">[</span>user@docker ~]<span class="nv">$ </span>curl 172.17.0.7
 Hello World! 
</code></pre></div> </div> <p><br /></p> </li> </ol> </li> </ul> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">son</button> <button class="btn btn-white btn-xs" type="button">blog</button> <button class="btn btn-white btn-xs" type="button">infra</button> <button class="btn btn-white btn-xs" type="button">docker</button> <button class="btn btn-white btn-xs" type="button">image</button> <button class="btn btn-white btn-xs" type="button">container</button> <button class="btn btn-white btn-xs" type="button">volume</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> <i class="fa fa-comments-o"> </i> <span class="disqus-comment-count" data-disqus-url="http://localhost:4000/infra/2020/09/01/docker2.html">0</span> comments </div> </div> </div> </div> <div class="PageNavigation"> <a class="prev" href="/infra/2020/09/01/docker1.html">&laquo; [Docker] 도커 개요 및 설치 - CentOS 7</a> <a class="next" href="/infra/2020/09/02/docker3.html">[Docker] 도커 네트워크 &raquo;</a> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ /* var disqus_config = function () { this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { var d = document, s = d.createElement('script'); s.src = '//Son.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93473370-3', 'auto'); ga('require', ''); ga('send', 'pageview'); </script> <!-- GrowingIO --> <script id="dsq-count-scr" src="https://Son.disqus.com/count.js" async></script> </body> </html>
