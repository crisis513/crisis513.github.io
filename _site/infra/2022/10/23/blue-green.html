<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta content="[Infra] Kubernetes Blue/Green ë°°í¬ ì „ëµ ì‹¤ìŠµ" name="description"> <meta name="keywords" content="son,blog,infra,docker,minikube,kubernetes,grafana,blue/green"> <meta name="author" content="son"> <meta name="baseurl" content=""> <title> son | [Infra] Kubernetes Blue/Green ë°°í¬ ì „ëµ ì‹¤ìŠµ </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20200311.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20200311.min.js"></script> <script src="/static/assets/blog-20200311.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184620200311", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">son</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href="blog/"></a></li> <li> <a class="page-scroll" href="/blog/">All</a></li> <li> <a class="page-scroll" href="/project/">Project</a></li> <li> <a class="page-scroll" href="/research/">Research</a></li> <li> <a class="page-scroll" href="/troubleshooting/">Troubleshooting</a></li> <li> <a class="page-scroll" href="/infra/">Infra</a></li> <li> <a class="page-scroll" href="/data/">Data</a></li> <li> <a class="page-scroll" href="/anything/">Anything</a></li> </ul> </div> </div> </nav> </div> <div id="inSlider" class="carousel carousel-fade" data-ride="carousel"> <ol class="carousel-indicators"> <li data-target="#inSlider" data-slide-to="0" class="active"></li> <li data-target="#inSlider" data-slide-to="1"></li> <li data-target="#inSlider" data-slide-to="2"></li> </ol> <div class="carousel-inner" role="listbox"> <div class="item active"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_one.jpg);" title="han-gi's blog"> </div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_two.jpg);" title="han-gi's blog"></div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_three.jpg);" title="han-gi's blog"></div> </div> </div> <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#inSlider" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/infra">Infra</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 23 Oct 2022</span> <h1> [Infra] Kubernetes Blue/Green ë°°í¬ ì „ëµ ì‹¤ìŠµ </h1> </div> <div class="ksJIXb"> <div class="ikVqUi"> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#ê°œìš”">ê°œìš”</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#1-ë‚´-ì§ˆë¬¸ì—ëŠ”-ì™œ-ë‹µë³€ì—-ë‹¬ë¦¬ì§€-ì•Šì„ê¹Œ---ê°œë°œìê°€-ì§ˆë¬¸í•˜ëŠ”-ë²•">1. ë‚´ ì§ˆë¬¸ì—ëŠ” ì™œ ë‹µë³€ì— ë‹¬ë¦¬ì§€ ì•Šì„ê¹Œ? - ê°œë°œìê°€ ì§ˆë¬¸í•˜ëŠ” ë²•</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#1-ì§ˆë¬¸ì„-í•˜ê¸°-ì „ì—-í•´ì•¼-í• -ê²ƒë“¤">1) ì§ˆë¬¸ì„ í•˜ê¸° ì „ì— í•´ì•¼ í•  ê²ƒë“¤</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#2-ì´ì œ-ê²€ìƒ‰í•´ë³´ì">2) ì´ì œ ê²€ìƒ‰í•´ë³´ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#3-ê·¸ë˜ë„-í•´ê²°ì´-ì•ˆ-ë˜ì—ˆìœ¼ë©´-ì§ˆë¬¸ì„-í•˜ì">3) ê·¸ë˜ë„ í•´ê²°ì´ ì•ˆ ë˜ì—ˆìœ¼ë©´ ì§ˆë¬¸ì„ í•˜ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#2-ì§ˆë¬¸ì„-ì˜í•˜ëŠ”-ê°œë°œì">2. ì§ˆë¬¸ì„ ì˜í•˜ëŠ” ê°œë°œì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#1-ì¶©ë¶„í•œ-êµ¬ê¸€ë§ì„-ìš°ì„ -ì„ í–‰í•˜ì">1) ì¶©ë¶„í•œ êµ¬ê¸€ë§ì„ ìš°ì„  ì„ í–‰í•˜ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#2-ë™ë£Œì˜-ì‹œê°„ì„-ë‚­ë¹„í•˜ì§€-ë§ìì§ˆë¬¸-ì •ë¦¬í•´ì•¼-í•˜ëŠ”-ì´ìœ ">2) ë™ë£Œì˜ ì‹œê°„ì„ ë‚­ë¹„í•˜ì§€ ë§ì(ì§ˆë¬¸ ì •ë¦¬í•´ì•¼ í•˜ëŠ” ì´ìœ )</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#3-ì§ˆë¬¸-ì •ë¦¬í•˜ê¸°">3) ì§ˆë¬¸ ì •ë¦¬í•˜ê¸°</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#4-í•œ-ê±¸ìŒ-ë”-ë‚˜ì•„ê°€ì„œ">4) í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ì„œ!</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#-íšŒê³ ">ğŸ¹ íšŒê³ </a></div> </div> </div> <p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” Kubernetesì˜ ì—¬ëŸ¬ ë°°í¬ ì „ëµ ì¤‘ Blue/Greenì— ëŒ€í•´ ì•Œì•„ë³´ê³  ì‹¤ìŠµí•´ë³¼ ê²ƒì´ë‹¤. ì‹¤ìŠµ ì§„í–‰ì€ <a href="&quot;https://github.com/ContainerSolutions/k8s-deployment-strategies&quot;">í•´ë‹¹ ê¹ƒí—ˆë¸Œ ë‚´ìš©</a>ì„ ì°¸ê³ í•˜ì˜€ë‹¤.</p> <hr /> <h2 id="ëª©ì°¨">ëª©ì°¨</h2> <p><a href="#list1">1. Blue/Green ë°°í¬</a></p> <p><a href="#list1_1">Â Â  1.1. Blue/Greenì´ë€?</a></p> <p><a href="#list1_2">Â Â  1.2. Blue/Green ì‹¤ìŠµ</a></p> <p><a href="#list1_3">Â Â  1.3. Grafana dashboard í™•ì¸</a></p> <hr /> <h2 id="1-bluegreen-ë°°í¬-"><span style="color:purple"><strong>1. Blue/Green ë°°í¬</strong></span> <a name="list1"></a></h2> <p><br /></p> <h3 id="11-bluegreenì´ë€-">1.1. Blue/Greenì´ë€? <a name="list1_1"></a></h3> <p>ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ì‚´í´ë³¸ Rolling UpdateëŠ” ê¸°ì¡´ ë²„ì „ê³¼ ìƒˆë¡œìš´ ë²„ì „ì´ ê°™ì´ ë°°í¬ë˜ëŠ” ì‹œê°„ì´ ì–´ëŠì •ë„ ìˆë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë°©ë²•ì´ Blue/Green ë°°í¬ì´ë‹¤. Blue/Green ë°°í¬ëŠ” ì„œë²„ë¥¼ ê¸°ì¡´ ë²„ì „ê³¼ ìƒˆë¡œìš´ ë²„ì „ì„ ë™ì‹œì— ë°°í¬í•˜ì—¬ í•œêº¼ë²ˆì— êµì²´í•˜ëŠ” ë°©ë²•ì´ë‹¤. ê·¸ë¦¼ìœ¼ë¡œ ì‚´í´ë³´ìë©´ ë‹¤ìŒ [ê·¸ë¦¼ 1]ê³¼ ê°™ë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/bluegreen1.png" alt="blue_green" width="100%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 1] Blue/Green ë°°í¬ ê³¼ì •</td> </tr> </tbody> </table> <p><br /></p> <p>ìƒˆë¡œìš´ ë²„ì „ì´ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œ í›„ selector í•„ë“œì˜ version ë ˆì´ë¸”ì„ êµì²´í•˜ì—¬ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ íŠ¸ë˜í”½ì„ ë³´ë‚´ë„ë¡ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì¦‰ê°ì ì¸ ë¡¤ì•„ì›ƒ/ë¡¤ë°±ì´ ê°€ëŠ¥í•˜ê³  ë²„ì „ ê´€ë¦¬ ë¬¸ì œë¥¼ í”¼í•˜ê³  ì „ì²´ í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ í•œ ë²ˆì— ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ë‘ ë²„ì „ì´ ë™ì‹œì— ì˜¬ë¼ê°€ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë‘ ë°°ì˜ ìì›ì´ í•„ìš”í•˜ê³ , í”„ë¡œë•ì…˜ì— ì¶œì‹œí•˜ê¸° ì „ì— ì „ì²´ í”Œë«í¼ì— ëŒ€í•œ ì ì ˆí•œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.</p> <p><br /></p> <h3 id="12-bluegreen-ì‹¤ìŠµ-">1.2. Blue/Green ì‹¤ìŠµ <a name="list1_2"></a></h3> <p>ì‹¤ìŠµì€ ì´ì „ í¬ìŠ¤íŒ…ì˜ Rolling Updateë¥¼ ì§„í–‰í–ˆë˜ ramped í´ë”ì—ì„œ blue-green/single-service í´ë”ë¡œ ì´ë™í•˜ì—¬ ì§„í–‰í•œë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span><span class="nb">cd</span> ../blue-green/single-service
  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span><span class="nb">ls
  </span>app-v1.yaml  app-v2.yaml  README.md
  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span><span class="nb">cat </span>app-v1.yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-app
    labels:
      app: my-app
  spec:
    <span class="nb">type</span>: NodePort
    ports:
    - name: http
      port: 80
      targetPort: http
    selector:
      app: my-app
      version: v1.0.0
  <span class="nt">---</span>
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: my-app-v1
    labels:
      app: my-app
  spec:
    replicas: 3
    selector:
      matchLabels:
        app: my-app
        version: v1.0.0
    template:
      metadata:
        labels:
          app: my-app
          version: v1.0.0
        annotations:
          prometheus.io/scrape: <span class="s2">"true"</span>
          prometheus.io/port: <span class="s2">"9101"</span>
      spec:
        containers:
        - name: my-app
          image: crisis513/strategies-test
          ports:
          - name: http
            containerPort: 8080
          - name: probe
            containerPort: 8086
          <span class="nb">env</span>:
          - name: VERSION
            value: v1.0.0
          livenessProbe:
            httpGet:
              path: /live
              port: probe
            initialDelaySeconds: 5
            periodSeconds: 5
          readinessProbe:
            httpGet:
              path: /ready
              port: probe
            periodSeconds: 5
  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span><span class="nb">cat </span>app-v2.yaml
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: my-app-v2
    labels:
      app: my-app
  spec:
    replicas: 3
    selector:
      matchLabels:
        app: my-app
        version: v2.0.0
    template:
      metadata:
        labels:
          app: my-app
          version: v2.0.0
        annotations:
          prometheus.io/scrape: <span class="s2">"true"</span>
          prometheus.io/port: <span class="s2">"9101"</span>
      spec:
        containers:
        - name: my-app
          image: crisis513/strategies-test
          ports:
          - name: http
            containerPort: 8080
          - name: probe
            containerPort: 8086
          <span class="nb">env</span>:
          - name: VERSION
            value: v2.0.0
          livenessProbe:
            httpGet:
              path: /live
              port: probe
            initialDelaySeconds: 5
            periodSeconds: 5
          readinessProbe:
            httpGet:
              path: /ready
              port: probe
            periodSeconds: 5
</code></pre></div></div> <p>Blue/Greenë„ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¶€ë¶„ì„ ì´ì „ì— ë¯¸ë¦¬ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œ ë° Docker Hubì— í‘¸ì‹œí–ˆë˜ <strong>crisis513/strategies-test</strong>ë¡œ ë°”ê¾¸ì—ˆë‹¤. ë§¤ë‹ˆí˜ìŠ¤íŠ¸ê°€ Rolling Updateì™€ ë‹¤ë¥¸ ì ì€ strategy ë¶€ë¶„ì´ ì—†ê³ , selector &gt; matchLabels &gt; versionì´ ì¶”ê°€ëœ ì ì´ë‹¤. ì‚¬ì‹¤ <code class="language-plaintext highlighter-rouge">kubectl patch service</code> ëª…ë ¹ì–´ë¡œ ì–´ë–¤ selectorì˜ ìš”ì†Œë¥¼ ë°”ë¼ë³´ê²Œ í•  ê²ƒì¸ì§€ë¥¼ ë°”ê¿”ì£¼ë©´ ë˜ëŠ” ê²ƒì´ê³ , ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” selector &gt; matchLabels &gt; version ë¶€ë¶„ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ í•˜ëŠ” ê²ƒ ë¿ì´ë‹¤.</p> <p>ë¨¼ì € app-v1.yamlì„ ë°°í¬í•´ë³´ì.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k apply <span class="nt">-f</span> app-v1.yaml
  service/my-app created
  deployment.apps/my-app-v1 created
  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k get all
  NAME                             READY   STATUS    RESTARTS   AGE
  pod/my-app-v1-69b978c757-9wtgt   1/1     Running   0          69s
  pod/my-app-v1-69b978c757-g2bfr   1/1     Running   0          69s
  pod/my-app-v1-69b978c757-kcwn7   1/1     Running   0          69s

  NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
  service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        15d
  service/my-app       NodePort    10.104.28.204   &lt;none&gt;        80:32448/TCP   69s

  NAME                        READY   UP-TO-DATE   AVAILABLE   AGE
  deployment.apps/my-app-v1   3/3     3            3           69s

  NAME                                   DESIRED   CURRENT   READY   AGE
  replicaset.apps/my-app-v1-69b978c757   3         3         3       69s
</code></pre></div></div> <p>ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì˜¬ë¼ê°”ë‹¤ë©´ Rolling Update ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì§€ì†ì ì¸ ìš”ì²­ì„ ë³´ë‚´ë³´ë„ë¡ í•˜ê² ë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">-o</span> /dev/null <span class="s2">"http://192.168.49.2:32448"</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div> <p>ìš”ì²­ì€ ê³„ì† ë³´ë‚´ë„ë¡ ê·¸ëŒ€ë¡œ ë‘ê³  ì–´ëŠ ì •ë„ ì‹œê°„ì´ ì§€ë‚˜ê³ ë‚˜ì„œ ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ app-v2.yamlì„ ë°°í¬í•˜ê² ë‹¤.</p> <p>ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ podê°€ ë¡¤ì•„ì›ƒ ë˜ëŠ” ê³¼ì •ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p> <p>$ watch kubectl get po</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k apply <span class="nt">-f</span> app-v2.yaml
  deployment.apps/my-app-v2 created
</code></pre></div></div> <p>ë‹¤ìŒ ê·¸ë¦¼ì€ app-v1.yamlê³¼ app-v2.yamlì„ í•¨ê»˜ ë°°í¬í•œ ê²ƒì„ í™•ì¸í•´ë³¸ ê²ƒìœ¼ë¡œ, í•¨ê»˜ ë°°í¬ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/bluegreen2.png" alt="watch_pod" width="70%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 2] watch kubectl get po í™•ì¸</td> </tr> </tbody> </table> <p><br /></p> <p>ì—¬ê¸°ì„œ kubectl patch service ëª…ë ¹ìœ¼ë¡œ ì–´ëŠ ë²„ì „ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°€ë¦¬í‚¤ëŠëƒì— ë”°ë¼ íŠ¸ë˜í”½ì˜ ì´ë™ ë°©í–¥ì´ ì •í•´ì§€ëŠ” ê²ƒì´ê³ , ìƒˆë¡œìš´ ë²„ì „ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°€ë¦¬í‚¨ í›„ì— ì´ì „ ë²„ì „ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚­ì œí•´ì£¼ë©´ Blue/Green ë°°í¬ê°€ ì™„ë£Œë˜ëŠ” ê²ƒì´ë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k patch service my-app <span class="nt">-p</span> <span class="s1">'{"spec":{"selector":{"version":"v2.0.0"}}}'</span>
  service/my-app patched
  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k delete deploy my-app-v1
  deployment.apps <span class="s2">"my-app-v1"</span> deleted

  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k get pod
  NAME                             READY   STATUS    RESTARTS   AGE
  pod/my-app-v2-69b978c757-jf9dn   1/1     Running   0          10m
  pod/my-app-v2-69b978c757-2mdfj   1/1     Running   0          10m
  pod/my-app-v2-69b978c757-ms9dn   1/1     Running   0          10m

  son@son-localhost ~/k8s-deployment-strategies/blue-green/single-service <span class="nv">$ </span>k describe service/my-app
  Name:                     my-app
  Namespace:                default
  Labels:                   <span class="nv">app</span><span class="o">=</span>my-app
  Annotations:              &lt;none&gt;
  Selector:                 <span class="nv">app</span><span class="o">=</span>my-app,version<span class="o">=</span>v2.0.0
  Type:                     NodePort
  IP Family Policy:         SingleStack
  IP Families:              IPv4
  IP:                       10.109.224.206
  IPs:                      10.109.224.206
  Port:                     http  80/TCP
  TargetPort:               http/TCP
  NodePort:                 http  30427/TCP
  Endpoints:                172.17.0.10:8080,172.17.0.11:8080,172.17.0.7:8080
  Session Affinity:         None
  External Traffic Policy:  Cluster
  Events:                   &lt;none&gt;
</code></pre></div></div> <p>app-v2.yamlì„ ë°°í¬í•˜ê³  kubectl patch service ëª…ë ¹ì–´ë¥¼ í†µí•´ ìƒˆë¡œ ë°°í¬ëœ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ íŠ¸ë˜í”½ì„ ë³´ë‚´ë„ë¡ ì„¤ì •í•œ í›„ì— ê¸°ì¡´ ë²„ì „ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚­ì œí•´ ì£¼ì—ˆë‹¤. v2ì— í•´ë‹¹í•˜ëŠ” podë“¤ì´ Runningë˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³ , ì„œë¹„ìŠ¤ ì •ë³´ë¥¼ ì‚´í´ë³´ë‹ˆ Selectorì˜ versionë„ 2.0.0ìœ¼ë¡œ ë°”ë€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p> <blockquote> <p>ë°˜ëŒ€ë¡œ ë¡¤ë°±í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.</p> <p>$ kubectl patch service my-app -p â€˜{â€œspecâ€:{â€œselectorâ€:{â€œversionâ€:â€v1.0.0â€}}}â€™</p> </blockquote> <p><br /></p> <h3 id="13-grafana-dashboard-í™•ì¸-">1.3. Grafana dashboard í™•ì¸ <a name="list1_3"></a></h3> <p>ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œì˜ ë°°í¬ê°€ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆë‹¤ë©´ Grafanaë¥¼ í†µí•´ Blue/Green ë°°í¬ ê³¼ì •ì— ëŒ€í•œ ì§€ì†ì ì¸ ìš”ì²­ ë©”íŠ¸ë¦­ì„ í™•ì¸í•˜ê² ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ ë°°í¬í•´ ë‘ì—ˆë˜ Grafanaì— ì ‘ì†í•˜ê¸° ìœ„í•´ localhost:3000ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ ë§Œë“¤ì–´ ë‘” íŒ¨ë„ì„ <strong>refresh</strong>í•´ë³´ì. ë‹¤ìŒ [ê·¸ë¦¼ 3]ê³¼ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/bluegreen3.png" alt="request_total_panel" width="100%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 3] Request Total íŒ¨ë„ í™•ì¸</td> </tr> </tbody> </table> <p><br /></p> <p>ì‹œê°í™”ëœ ë°ì´í„°ë¥¼ ë³´ë©´ ê¸°ì¡´ ë²„ì „ì—ì„œ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ í•œ ë²ˆì— êµì²´í•˜ê¸° ë•Œë¬¸ì— ì ì§„ì ìœ¼ë¡œ ë¡¤ì•„ì›ƒí•˜ë˜ Rolling Update ë•Œì™€ëŠ” ë‹¤ë¥´ê²Œ ë‹¨ë²ˆì— ë¡¤ì•„ì›ƒ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">son</button> <button class="btn btn-white btn-xs" type="button">blog</button> <button class="btn btn-white btn-xs" type="button">infra</button> <button class="btn btn-white btn-xs" type="button">docker</button> <button class="btn btn-white btn-xs" type="button">minikube</button> <button class="btn btn-white btn-xs" type="button">kubernetes</button> <button class="btn btn-white btn-xs" type="button">grafana</button> <button class="btn btn-white btn-xs" type="button">blue/green</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> <i class="fa fa-comments-o"> </i> <span class="disqus-comment-count" data-disqus-url="http://192.168.116.128:4000/infra/2022/10/23/blue-green.html">0</span> comments </div> </div> </div> </div> <div class="PageNavigation"> <a class="prev" href="/infra/2022/10/22/rolling-update.html">&laquo; [Infra] Kubernetes Rolling Update ë°°í¬ ì „ëµ ì‹¤ìŠµ</a> <a class="next" href="/infra/2022/10/24/canary.html">[Infra] Kubernetes Canary ë°°í¬ ì „ëµ ì‹¤ìŠµ &raquo;</a> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ /* var disqus_config = function () { this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { var d = document, s = d.createElement('script'); s.src = '//son.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93473370-3', 'auto'); ga('require', ''); ga('send', 'pageview'); </script> <!-- GrowingIO --> <script id="dsq-count-scr" src="https://son.disqus.com/count.js" async></script> </body> </html>
