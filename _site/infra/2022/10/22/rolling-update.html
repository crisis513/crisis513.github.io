<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1; minimum-scale=1; user-scalable=no;"> <meta content="[Infra] Kubernetes Rolling Update ë°°í¬ ì „ëµ ì‹¤ìŠµ" name="description"> <meta name="keywords" content="son,blog,infra,docker,minikube,kubernetes,grafana,rolling update"> <meta name="author" content="son"> <meta name="baseurl" content=""> <title> son | [Infra] Kubernetes Rolling Update ë°°í¬ ì „ëµ ì‹¤ìŠµ </title> <!-- favicon --> <link rel="shortcut icon" href="/static/assets/img/favicon.ico"> <!-- Main CSS --> <link href="/static/assets/app-20200311.min.css" rel="stylesheet"> <link href="/static/css/custom.css" rel="stylesheet"> <!-- Main Scripts --> <script src="/static/assets/app-20200311.min.js"></script> <script src="/static/assets/blog-20200311.min.js"></script> <!-- Google AdSense --> <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script> (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: "ca-pub-6196184620200311", enable_page_level_ads: true }); </script> </head> <body id="page-top" class="landing-page"> <div class="search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right: 0px; opacity: 0.95; background-color: #111111; z-index: 9999; display: none;"> <input type="text" class="form-control search-content" id="search-content" style="position: fixed; top: 60px" placeholder="Search Blog"> <div style="position: fixed; top: 16px; right: 16px; z-index: 9999;"> <img src="/static/assets/img/search/cb-close.png" id="close-btn"/> </div> </div> <div style="position: fixed; right: 16px; bottom: 20px; z-index: 9999;"> <img src="/static/assets/img/search/cb-search.png" id="search-btn" title="Double click Ctrl"/> </div> <div class="navbar-wrapper"> <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> <div class="container"> <div class="navbar-header page-scroll"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">son</a> </div> <div id="navbar" class="navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li><a class="page-scroll" href="blog/"></a></li> <li> <a class="page-scroll" href="/blog/">All</a></li> <li> <a class="page-scroll" href="/project/">Project</a></li> <li> <a class="page-scroll" href="/research/">Research</a></li> <li> <a class="page-scroll" href="/troubleshooting/">Troubleshooting</a></li> <li> <a class="page-scroll" href="/infra/">Infra</a></li> <li> <a class="page-scroll" href="/data/">Data</a></li> <li> <a class="page-scroll" href="/anything/">Anything</a></li> </ul> </div> </div> </nav> </div> <div id="inSlider" class="carousel carousel-fade" data-ride="carousel"> <ol class="carousel-indicators"> <li data-target="#inSlider" data-slide-to="0" class="active"></li> <li data-target="#inSlider" data-slide-to="1"></li> <li data-target="#inSlider" data-slide-to="2"></li> </ol> <div class="carousel-inner" role="listbox"> <div class="item active"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_one.jpg);" title="han-gi's blog"> </div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_two.jpg);" title="han-gi's blog"></div> </div> <div class="item"> <div class="container"> <div class="carousel-caption"> </div> <div class="carousel-image wow zoomIn"> <!-- <img src="static/img/landing/laptop.png" alt="laptop"/> --> </div> </div> <!-- Set background for slide in css --> <div class="header-back" style="background-image: url(/static/assets/img/landing/header_three.jpg);" title="han-gi's blog"></div> </div> </div> <a class="left carousel-control" href="#inSlider" role="button" data-slide="prev"> <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> <span class="sr-only">Previous</span> </a> <a class="right carousel-control" href="#inSlider" role="button" data-slide="next"> <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> <span class="sr-only">Next</span> </a> </div> <div class="wrapper wrapper-content animated fadeInRight article"> <div class="row"> <div class="col-lg-10 col-lg-offset-1"> <div class="ibox"> <div class="ibox-content"> <div class="pull-right"> <a class="btn btn-white btn-xs" href="/infra">Infra</a> </div> <div class="text-center article-title"> <span class="text-muted"><i class="fa fa-clock-o"></i> 22 Oct 2022</span> <h1> [Infra] Kubernetes Rolling Update ë°°í¬ ì „ëµ ì‹¤ìŠµ </h1> </div> <div class="ksJIXb"> <div class="ikVqUi"> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#ê°œìš”">ê°œìš”</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#1-ë‚´-ì§ˆë¬¸ì—ëŠ”-ì™œ-ë‹µë³€ì—-ë‹¬ë¦¬ì§€-ì•Šì„ê¹Œ---ê°œë°œìê°€-ì§ˆë¬¸í•˜ëŠ”-ë²•">1. ë‚´ ì§ˆë¬¸ì—ëŠ” ì™œ ë‹µë³€ì— ë‹¬ë¦¬ì§€ ì•Šì„ê¹Œ? - ê°œë°œìê°€ ì§ˆë¬¸í•˜ëŠ” ë²•</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#1-ì§ˆë¬¸ì„-í•˜ê¸°-ì „ì—-í•´ì•¼-í• -ê²ƒë“¤">1) ì§ˆë¬¸ì„ í•˜ê¸° ì „ì— í•´ì•¼ í•  ê²ƒë“¤</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#2-ì´ì œ-ê²€ìƒ‰í•´ë³´ì">2) ì´ì œ ê²€ìƒ‰í•´ë³´ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#3-ê·¸ë˜ë„-í•´ê²°ì´-ì•ˆ-ë˜ì—ˆìœ¼ë©´-ì§ˆë¬¸ì„-í•˜ì">3) ê·¸ë˜ë„ í•´ê²°ì´ ì•ˆ ë˜ì—ˆìœ¼ë©´ ì§ˆë¬¸ì„ í•˜ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#2-ì§ˆë¬¸ì„-ì˜í•˜ëŠ”-ê°œë°œì">2. ì§ˆë¬¸ì„ ì˜í•˜ëŠ” ê°œë°œì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#1-ì¶©ë¶„í•œ-êµ¬ê¸€ë§ì„-ìš°ì„ -ì„ í–‰í•˜ì">1) ì¶©ë¶„í•œ êµ¬ê¸€ë§ì„ ìš°ì„  ì„ í–‰í•˜ì</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#2-ë™ë£Œì˜-ì‹œê°„ì„-ë‚­ë¹„í•˜ì§€-ë§ìì§ˆë¬¸-ì •ë¦¬í•´ì•¼-í•˜ëŠ”-ì´ìœ ">2) ë™ë£Œì˜ ì‹œê°„ì„ ë‚­ë¹„í•˜ì§€ ë§ì(ì§ˆë¬¸ ì •ë¦¬í•´ì•¼ í•˜ëŠ” ì´ìœ )</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#3-ì§ˆë¬¸-ì •ë¦¬í•˜ê¸°">3) ì§ˆë¬¸ ì •ë¦¬í•˜ê¸°</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 24px;"><a href="#4-í•œ-ê±¸ìŒ-ë”-ë‚˜ì•„ê°€ì„œ">4) í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ì„œ!</a></div> <div class="sc-fXEqDS bXGcfF" style="margin-left: 0px;"><a href="#-íšŒê³ ">ğŸ¹ íšŒê³ </a></div> </div> </div> <p>ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” Kubernetesì˜ ì—¬ëŸ¬ ë°°í¬ ì „ëµ ì¤‘ Rolloing Updateì— ëŒ€í•´ ì•Œì•„ë³´ê³  ì‹¤ìŠµí•´ë³¼ ê²ƒì´ë‹¤. ì‹¤ìŠµ ì§„í–‰ì€ <a href="&quot;https://github.com/ContainerSolutions/k8s-deployment-strategies&quot;">í•´ë‹¹ ê¹ƒí—ˆë¸Œ ë‚´ìš©</a>ì„ ì°¸ê³ í•˜ì˜€ë‹¤.</p> <hr /> <h2 id="ëª©ì°¨">ëª©ì°¨</h2> <p><a href="#list1">1. ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµ</a></p> <p><a href="#list2">2. Rolling Update ë°°í¬</a></p> <p><a href="#list2_1">Â Â  2.1. Rolling Updateë€?</a></p> <p><a href="list2_2">Â Â  2.2. Rolling Update ì‹¤ìŠµ</a></p> <p><a href="#list2_3">Â Â  2.3. Grafana dashboard í™•ì¸</a></p> <hr /> <h2 id="1-ë¬´ì¤‘ë‹¨-ë°°í¬-ì „ëµ-"><span style="color:purple"><strong>1. ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµ</strong></span> <a name="list1"></a></h2> <p>ë¬´ì¤‘ë‹¨ ë°°í¬ëŠ” ì‹¤ì œë¡œ <strong>ì„œë²„ë¥¼ ìš´ì˜í•  ë•Œ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ì§€ ì•Šê³ , ì„œë¹„ìŠ¤ì ì¸ ì¥ì• ë¥¼ ìµœì†Œí™”ì‹œí‚¬ ìˆ˜ ìˆë„ë¡ ë°°í¬</strong>í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì–¼ë§ˆ ì „ 2022ë…„ 10ì›” 15ì¼ì— C&amp;C ë°ì´í„°ì„¼í„°ì— í™”ì¬ê°€ ë°œìƒí•˜ì—¬ ì—­ëŒ€ ìµœì•…ì˜ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ì‚¬íƒœë¥¼ ë§ì•˜ì—ˆë‹¤. 10ì‹œê°„ì´ ì§€ë‚˜ì„œì•¼ ì¼ë¶€ ê¸°ëŠ¥ì´ ë³µêµ¬ë˜ê¸° ì‹œì‘ë˜ì—ˆê³  ê³µì‹ì ìœ¼ë¡œëŠ” 127ì‹œê°„ 30ë¶„ë§Œì— ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ì •ìƒí™” ë˜ì—ˆë‹¤ê³  ì•Œë ¤ì ¸ìˆëŠ”ë°, ì´ë²ˆ ì‚¬íƒœë¡œ ìœ ë£Œì„œë¹„ìŠ¤ ì‚¬ìš©ìì— ëŒ€í•œ ë³´ìƒì•¡ê³¼ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì— ëŒ€í•œ ë§¤ì¶œì•¡ í”¼í•´ ë“±ì„ í•©í•˜ë©´ ìˆ˜ë°± ìˆ˜ì²œì–µì˜ ì†ì‹¤ì„ ì…ì—ˆì„ ê²ƒì´ë‹¤. ì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ í´ ìˆ˜ë¡ ì •ìƒì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ìš´ì˜í•  ìˆ˜ ìˆëŠ” ì¸í”„ë¼ ë° í™˜ê²½ì„ ê°–ì¶”ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤. ë°ì´í„°ì„¼í„°ê°€ ì´ì›í™”ê°€ ì¬ëŒ€ë¡œ ë˜ì§€ ì•Šì•„ ë°œìƒí•œ ë¬¸ì œì—¬ì„œ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£° ì¿ ë²„ë„¤í‹°ìŠ¤ ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµê³¼ëŠ” ì•½ê°„ ë‹¤ë¥¸ ë¬¸ì œì´ê¸´ í•˜ì§€ë§Œ ê·¸ë§Œí¼ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ì§€ ì•Šê³  ì •ìƒ ì„œë¹„ìŠ¤í•˜ëŠ” ê²ƒì´ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ê°•ì¡°í•˜ê³  ì‹¶ì—ˆë‹¤.</p> <p>ì¿ ë²„ë„¤í‹°ìŠ¤ ì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ë¡¤ì•„ì›ƒ í•˜ë©´ì„œ ìŠ¤í…Œì´ì§€ì—ì„œ ì—†ë˜ ë¬¸ì œê°€ ìš´ì˜ì—ì„œ ìƒê²¨ë‚˜ë©´ì„œ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ëŠ” ìƒí™©ë„ ìˆê¸° ë•Œë¬¸ì— ì¼ê´€ëœ í™˜ê²½ì„ ì œê³µí•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•œ ì´ìŠˆì´ë‹¤. ë‹¤ì‹œ ëŒì•„ì™€ì„œ, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” Rolling Updateì™€ Blue/Green, Canary ë“± ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ë¡¤ì•„ì›ƒí•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ ê°€ì§€ ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµì´ ì¡´ì¬í•œë‹¤. ë³¸ í¬ìŠ¤íŒ…ì—ì„œëŠ” ëŒ€í‘œì ì¸ 3ê°€ì§€ ë°©ë²• ì¤‘ Rolling Updateì— ëŒ€í•´ ì•Œì•„ë³´ê³  ì‹¤ìŠµí•´ë³¼ ê²ƒì´ë‹¤.</p> <p><br /></p> <h2 id="2-rolling-update-ë°°í¬-"><span style="color:purple"><strong>2. Rolling Update ë°°í¬</strong></span> <a name="list2"></a></h2> <p><br /></p> <h3 id="21-rolling-updateë€-">2.1. Rolling Updateë€? <a name="list2_1"></a></h3> <p>Rolling Updateë€ ìƒˆë¡œìš´ ë²„ì „ì„ ë°°í¬í•˜ë©´ì„œ ìƒˆë¡œìš´ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ì”© ì˜¬ë¦¬ê³  ê¸°ì¡´ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ì”© ì¤„ì—¬ë‚˜ê°€ëŠ” ë°©ì‹ì´ë‹¤. ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë°°í¬í•˜ë©´ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ì§€ ì•Šìœ¼ë©° ë°°í¬í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ìƒˆë¡œìš´ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ íŠ¸ë˜í”½ì´ ì´ì „ë˜ê¸° ì „ê¹Œì§€ ì´ì „ ë²„ì „ê³¼ ìƒˆë¡œìš´ ë²„ì „ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ë™ì‹œì— ì¡´ì¬í•  ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. ë°°í¬í•˜ëŠ” ê¸°ê°„ ë™ì•ˆ ì–´ë–¤ ì‚¬ìš©ìëŠ” ì´ì „ ë²„ì „ì„ ì‚¬ìš©í•˜ê²Œ ë˜ê³ , ë˜ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” ìƒˆë¡œìš´ ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë¦¼ìœ¼ë¡œ í‘œí˜„í•˜ìë©´ ë‹¤ìŒ [ê·¸ë¦¼ 1]ê³¼ ê°™ë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate1.png" alt="rolling_update" width="100%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 1] Rolling Update ë°°í¬ ê³¼ì •</td> </tr> </tbody> </table> <p><br /></p> <p>ê·¸ë¦¼ì˜ ì˜ˆì‹œì—ì„œëŠ” Deploymentê°€ replicasë¥¼ 3ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ 3ê°œì˜ podê°€ ë°°í¬ë˜ì—ˆë‹¤ê³  ê°€ì •í•œë‹¤. ìš°ì¸¡ì˜ Running, Terminating, Container CreatingëŠ” Podì˜ Statusë¥¼ ì–´ë– í•œ ê³¼ì •ìœ¼ë¡œ ë³€í™”í•˜ëŠ”ì§€ë¥¼ ì˜ë¯¸í•˜ë©°, XëŠ” podê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. ì„¤ëª…ì„ ë³´íƒœìë©´, <strong>ê¸°ì¡´ ë²„ì „ì˜ pod ì§‘í•©ì—ì„œ podë¥¼ í•˜ë‚˜ì”© ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë²„ì „ì˜ podë¥¼ í•˜ë‚˜ì”© ì¶”ê°€í•˜ëŠ” ê³¼ì •ì´ ë°˜ë³µ</strong>ë˜ëŠ” ê²ƒì´ë‹¤. ìœ„ì—ì„œë„ ì–¸ê¸‰í•˜ì˜€ë“¯ Deploymentì˜ ë°°í¬ ì „ëµì— ì•„ë¬´ëŸ° ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ Rolling Updateë¡œ ì„¤ì •ëœë‹¤.</p> <p><br /></p> <h3 id="22-rolling-update-ì‹¤ìŠµ-">2.2. Rolling Update ì‹¤ìŠµ <a name="list2_2"></a></h3> <p>ë¨¼ì € Rolling Update ì‹¤ìŠµì— í•„ìš”í•œ ìë£Œë¥¼ ë‹¤ìš´ë°›ì•„ ì˜¤ê² ë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~ <span class="nv">$ </span>git clone https://github.com/ContainerSolutions/k8s-deployment-strategies.git
  Cloning into <span class="s1">'k8s-deployment-strategies'</span>...
  remote: Enumerating objects: 452, <span class="k">done</span><span class="nb">.</span>
  remote: Counting objects: 100% <span class="o">(</span>20/20<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
  remote: Compressing objects: 100% <span class="o">(</span>20/20<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
  remote: Total 452 <span class="o">(</span>delta 1<span class="o">)</span>, reused 8 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 432
  Receiving objects: 100% <span class="o">(</span>452/452<span class="o">)</span>, 3.70 MiB | 923.00 KiB/s, <span class="k">done</span><span class="nb">.</span>
  Resolving deltas: 100% <span class="o">(</span>236/236<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>

  son@son-localhost ~ <span class="nv">$ </span><span class="nb">cd </span>k8s-deployment-strategies/
  son@son-localhost ~/k8s-deployment-strategies <span class="nv">$ </span><span class="nb">ls
  </span>ab-testing  app  blue-green  canary  decision-diagram.png  grafana-dashboard.json  ramped  README.md  recreate  shadow
  son@son-localhost ~/k8s-deployment-strategies <span class="nv">$ </span><span class="nb">cd </span>app/
  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span><span class="nb">ls
  </span>Dockerfile  Gopkg.lock  Gopkg.toml  main.go  Makefile  README.md
</code></pre></div></div> <p>í•´ë‹¹ ê¹ƒ í´ë”ë¥¼ ì‚´í´ë³´ë©´ recreate, ramped, blue/green, canary, a/b testing ë°°í¬ ì „ëµì„ ì‹¤ìŠµí•´ë³¼ ìˆ˜ ìˆë„ë¡ í´ë”ê°€ ë‚˜ë‰˜ì–´ì ¸ìˆê³ , appì—ëŠ” ë°°í¬ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ì„ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë„ë¡ GO ì–¸ì–´ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„ë˜ì–´ ìˆë‹¤. ê·¸ë¦¬ê³  Dockerfileì„ í†µí•´ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë¹Œë“œí•˜ì—¬ Docker Hubì—ì„œ ìƒˆë¡œìš´ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë§Œë“  í›„ì— í•´ë‹¹ ë ˆí¬ì§€í† ë¦¬ë¡œ í‘¸ì‹œí•´ë³¼ ê²ƒì´ë‹¤. Docker Hubì—ì„œ ë¦¬í¬ì§€í† ë¦¬ëª…ì€ ë‹¤ìŒ [ê·¸ë¦¼ 2]ì™€ ê°™ì´ <code class="language-plaintext highlighter-rouge">strategies-test</code>ë¡œ ë§Œë“¤ì—ˆë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate2.png" alt="" width="60%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 2] Grafana ì ‘ì† í™”ë©´</td> </tr> </tbody> </table> <p><br /></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span>docker build <span class="nt">-t</span> crisis513/strategies-test <span class="nb">.</span>
  Sending build context to Docker daemon  15.36kB
  Step 1/9 : FROM golang:1.9-alpine AS build
  <span class="nt">---</span><span class="o">&gt;</span> b0260be938c6
  Step 2/9 : RUN apk <span class="nt">--no-cache</span> add git <span class="o">&amp;&amp;</span>   go get <span class="nt">-u</span> github.com/golang/dep/cmd/dep
  <span class="nt">---</span><span class="o">&gt;</span> Running <span class="k">in </span>fbf1fd7871e4
  fetch http://dl-cdn.alpinelinux.org/alpine/v3.8/main/x86_64/APKINDEX.tar.gz
  fetch http://dl-cdn.alpinelinux.org/alpine/v3.8/community/x86_64/APKINDEX.tar.gz
  <span class="o">(</span>1/6<span class="o">)</span> Installing nghttp2-libs <span class="o">(</span>1.39.2-r0<span class="o">)</span>
  <span class="o">(</span>2/6<span class="o">)</span> Installing libssh2 <span class="o">(</span>1.9.0-r1<span class="o">)</span>
  <span class="o">(</span>3/6<span class="o">)</span> Installing libcurl <span class="o">(</span>7.61.1-r3<span class="o">)</span>
  <span class="o">(</span>4/6<span class="o">)</span> Installing expat <span class="o">(</span>2.2.8-r0<span class="o">)</span>
  <span class="o">(</span>5/6<span class="o">)</span> Installing pcre2 <span class="o">(</span>10.31-r0<span class="o">)</span>
  <span class="o">(</span>6/6<span class="o">)</span> Installing git <span class="o">(</span>2.18.4-r0<span class="o">)</span>
  Executing busybox-1.28.4-r0.trigger
  OK: 19 MiB <span class="k">in </span>20 packages
  Removing intermediate container fbf1fd7871e4
  <span class="nt">---</span><span class="o">&gt;</span> af88bec1e59a
  Step 3/9 : COPY <span class="nb">.</span> <span class="nv">$GOPATH</span>/src/app
  <span class="nt">---</span><span class="o">&gt;</span> ea2deb243f50
  Step 4/9 : WORKDIR <span class="nv">$GOPATH</span>/src/app
  <span class="nt">---</span><span class="o">&gt;</span> Running <span class="k">in </span>3e98a321c375
  Removing intermediate container 3e98a321c375
  <span class="nt">---</span><span class="o">&gt;</span> 32abad570106
  Step 5/9 : RUN dep ensure <span class="o">&amp;&amp;</span>   <span class="nv">CGO_ENABLED</span><span class="o">=</span>0 <span class="nv">GOOS</span><span class="o">=</span>linux go build <span class="nt">-a</span> <span class="nt">-installsuffix</span> cgo <span class="nt">-o</span> app <span class="nb">.</span>
  <span class="nt">---</span><span class="o">&gt;</span> Running <span class="k">in </span>bd96701a0b9c
  Removing intermediate container bd96701a0b9c
  <span class="nt">---</span><span class="o">&gt;</span> e6584e1d6bd4
  Step 6/9 : FROM scratch
  <span class="nt">---</span><span class="o">&gt;</span>
  Step 7/9 : COPY <span class="nt">--from</span><span class="o">=</span>build /go/src/app/app /app
  <span class="nt">---</span><span class="o">&gt;</span> Using cache
  <span class="nt">---</span><span class="o">&gt;</span> a12284a9dd08
  Step 8/9 : EXPOSE 8080 8086 9101
  <span class="nt">---</span><span class="o">&gt;</span> Using cache
  <span class="nt">---</span><span class="o">&gt;</span> 5a912ba846b7
  Step 9/9 : CMD <span class="o">[</span><span class="s2">"/app"</span><span class="o">]</span>
  <span class="nt">---</span><span class="o">&gt;</span> Using cache
  <span class="nt">---</span><span class="o">&gt;</span> 9bdd1b95aae3
  Successfully built 9bdd1b95aae3
  Successfully tagged crisis513/strategies-test:latest

  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span>docker login
  Authenticating with existing credentials...
  WARNING! Your password will be stored unencrypted <span class="k">in</span> /home/son/.docker/config.json.
  Configure a credential helper to remove this warning. See
  https://docs.docker.com/engine/reference/commandline/login/#credentials-store

  Login Succeeded

  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span>docker push crisis513/strategies-test
  Using default tag: latest
  The push refers to repository <span class="o">[</span>docker.io/crisis513/strategies-test]
  a6412e70ba42: Pushed
  latest: digest: sha256:9f281584fa169d7a045d0fa17f3125871783b0dc5340eb0abe22ebc8f54c1c85 size: 528
</code></pre></div></div> <p>í‘¸ì‹œê°€ ì •ìƒì ìœ¼ë¡œ ë˜ì—ˆë‹¤ë©´ ì˜ˆì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì™€ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ Dockerfile, ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  Docker Hub ë ˆí¬ì§€í† ë¦¬ê¹Œì§€ ìƒê¸°ê²Œ ë˜ê³ , ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì—¬ ìƒˆë¡­ê²Œ ë°°í¬í•  ìˆ˜ ìˆëŠ” ëª¨ë“  í™˜ê²½ì´ ë§Œë“¤ì–´ ì§„ ê²ƒì´ë‹¤.</p> <p><br /></p> <p>ë‹¤ìŒìœ¼ë¡œ Prometheusì™€ Grafanaë¥¼ ë°°í¬í•´ì•¼ í•˜ëŠ”ë°, ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ Istioë¥¼ ì„¤ì¹˜í•˜ì—¬ addonsë¥¼ ë°°í¬í•˜ëŠ” ê³¼ì •ì—ì„œ Prometheusì™€ Grafanaê°€ ì´ë¯¸ Running ìƒíƒœì´ë‹¤. ë”°ë¼ì„œ í•„ìëŠ” Grafanaì— ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í¬íŠ¸í¬ì›Œë”©ë§Œ í•´ì¤„ ê²ƒì´ë‹¤.</p> <blockquote> <p>í˜¹ì‹œë‚˜ ë¸”ë¡œê·¸ ë‚´ìš©ì„ ë”°ë¼ì˜¤ê³  ìˆì§€ ì•Šì•„ Istioê°€ êµ¬ì„±ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ <a href="&quot;https://github.com/ContainerSolutions/k8s-deployment-strategies#readme&quot;">í•´ë‹¹ readme</a>ë¥¼ ì°¸ê³ í•˜ì—¬ Prometheusì™€ Grafana í™˜ê²½ì„ êµ¬ì„±í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.</p> <p>ê·¸ë¦¬ê³  Grafanaì— ì ‘ì†í•  ë•Œë§ˆë‹¤ í¬íŠ¸í¬ì›Œë”©ì„ í•´ì£¼ê¸° ê·€ì°®ë‹¤ë©´ NodePortë¥¼ ì˜¬ë ¤ë„ ìƒê´€ ì—†ë‹¤.</p> </blockquote> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span>k get all <span class="nt">-n</span> istio-system
  NAME                                        READY   STATUS    RESTARTS   AGE
  pod/grafana-56bdf8bf85-ff924                1/1     Running   0          3d
  pod/istio-egressgateway-fffc799cf-fw5cv     1/1     Running   0          3d
  pod/istio-ingressgateway-7d68764b55-8sq9l   1/1     Running   0          3d
  pod/istiod-5456fd558d-dpkvc                 1/1     Running   0          3d
  pod/jaeger-c4fdf6674-56w7h                  1/1     Running   0          3d
  pod/kiali-5ff49b9f69-c9fxt                  1/1     Running   0          3d
  pod/prometheus-85949fddb-csxkd              2/2     Running   0          3d

  NAME                           TYPE           CLUSTER-IP       EXTERNAL-IP      PORT<span class="o">(</span>S<span class="o">)</span>                                                                      AGE
  service/grafana                ClusterIP      10.96.226.7      &lt;none&gt;           3000/TCP                                                                     3d
  service/istio-egressgateway    ClusterIP      10.110.60.52     &lt;none&gt;           80/TCP,443/TCP                                                               3d
  service/istio-ingressgateway   LoadBalancer   10.111.160.6     192.168.49.100   15021:32528/TCP,80:30521/TCP,443:32312/TCP,31400:32156/TCP,15443:31761/TCP   3d
  service/istiod                 ClusterIP      10.102.30.48     &lt;none&gt;           15010/TCP,15012/TCP,443/TCP,15014/TCP                                        3d
  service/jaeger-collector       ClusterIP      10.102.207.195   &lt;none&gt;           14268/TCP,14250/TCP,9411/TCP                                                 3d
  service/kiali                  ClusterIP      10.109.43.201    &lt;none&gt;           20001/TCP,9090/TCP                                                           3d
  service/prometheus             ClusterIP      10.96.52.254     &lt;none&gt;           9090/TCP                                                                     3d
  service/tracing                ClusterIP      10.105.237.18    &lt;none&gt;           80/TCP,16685/TCP                                                             3d
  service/zipkin                 ClusterIP      10.96.209.177    &lt;none&gt;           9411/TCP                                                                     3d

  NAME                                   READY   UP-TO-DATE   AVAILABLE   AGE
  deployment.apps/grafana                1/1     1            1           3d
  deployment.apps/istio-egressgateway    1/1     1            1           3d
  deployment.apps/istio-ingressgateway   1/1     1            1           3d
  deployment.apps/istiod                 1/1     1            1           3d
  deployment.apps/jaeger                 1/1     1            1           3d
  deployment.apps/kiali                  1/1     1            1           3d
  deployment.apps/prometheus             1/1     1            1           3d

  NAME                                              DESIRED   CURRENT   READY   AGE
  replicaset.apps/grafana-56bdf8bf85                1         1         1       3d
  replicaset.apps/istio-egressgateway-fffc799cf     1         1         1       3d
  replicaset.apps/istio-ingressgateway-7d68764b55   1         1         1       3d
  replicaset.apps/istiod-5456fd558d                 1         1         1       3d
  replicaset.apps/jaeger-c4fdf6674                  1         1         1       3d
  replicaset.apps/kiali-5ff49b9f69                  1         1         1       3d
  replicaset.apps/prometheus-85949fddb              1         1         1       3d

  son@son-localhost ~ <span class="nv">$ </span>kubectl <span class="nt">-n</span> istio-system port-forward <span class="si">$(</span>kubectl <span class="nt">-n</span> istio-system get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>grafana <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span> 3000:3000 &amp;
  <span class="o">[</span>1] 15635
  Forwarding from 127.0.0.1:3000 -&gt; 3000
  Forwarding from <span class="o">[</span>::1]:3000 -&gt; 3000
</code></pre></div></div> <p>app í´ë”ì˜ main.go ì½”ë“œë¥¼ ì‚´í´ë³´ë©´ HTTP Requestê°€ ì˜¬ ë•Œë§ˆë‹¤ /metrics ê²½ë¡œì™€ 9101í¬íŠ¸ë¥¼ í†µí•´ Prometheus ì„œë²„ì—ì„œ ë§¤íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ë„ë¡ ì‘ì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í˜¹ì‹œë‚˜ ë§¤íŠ¸ë¦­ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ì§€ ì•Šì•„ Grafanaì—ì„œ ì¬ëŒ€ë¡œ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ë©´ Prometheusê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì–´ ìˆëŠ”ì§€, health check í–ˆì„ ë•Œ ì„œë¹„ìŠ¤ê°€ ì˜ ë™ì‘í•˜ê³  ìˆëŠ”ì§€, í¬íŠ¸ ë²ˆí˜¸ê°€ ë‹¤ë¥´ì§„ ì•ŠëŠ”ì§€, ë¡œê·¸ì—ì„œ ì—ëŸ¬ê°€ í™•ì¸ë˜ëŠ”ì§€ ë“±ì„ í™•ì¸í•´ë³´ë©´ ë  ê²ƒ ê°™ë‹¤.</p> <blockquote> <p>këŠ” ë³„ì¹­ì„ ì„¤ì •í•˜ì—¬ kubectlì„ ì˜ë¯¸í•œë‹¤.</p> <p>$ alias k=â€kubectlâ€</p> </blockquote> <p>Grafana í¬íŠ¸í¬ì›Œë”©ì„ í•˜ê³  <strong>localhost:3000</strong>ìœ¼ë¡œ ì ‘ì†í–ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ì ‘ì†ë˜ë©´ ë‹¤ìŒ [ê·¸ë¦¼ 2]ì™€ ê°™ì€ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate3.png" alt="grafana_home" width="80%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 3] Grafana ì ‘ì† í™”ë©´</td> </tr> </tbody> </table> <p><br /></p> <p>Grafanaì— ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼ì´ ëœë‹¤ë©´ ì¤€ë¹„ê°€ ë‹¤ ë˜ì—ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ Rolling Update ì‹¤ìŠµì„ ì§„í–‰í•´ë³´ì. Rolling Update ì‹¤ìŠµì— ì‚¬ìš©ë˜ëŠ” ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” ramped í´ë”ì— ìˆë‹¤. ramped í´ë” ì•ˆì— ìˆëŠ” app-v1.yaml íŒŒì¼ê³¼ app-v2.yamlì˜ ë‚´ìš©ì„ ë¹„êµí•´ë³´ê² ë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/app <span class="nv">$ </span><span class="nb">cd</span> ../ramped/
  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span><span class="nb">cat </span>app-v1.yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-app
    labels:
      app: my-app
  spec:
    <span class="nb">type</span>: NodePort
    ports:
    - name: http
      port: 80
      targetPort: http
    selector:
      app: my-app
  <span class="nt">---</span>
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: my-app
    labels:
      app: my-app
  spec:
    replicas: 10
    selector:
      matchLabels:
        app: my-app
    template:
      metadata:
        labels:
          app: my-app
          version: v1.0.0
        annotations:
          prometheus.io/scrape: <span class="s2">"true"</span>
          prometheus.io/port: <span class="s2">"9101"</span>
      spec:
        containers:
        - name: my-app
          image: crisis513/strategies-test
          ports:
          - name: http
            containerPort: 8080
          - name: probe
            containerPort: 8086
          <span class="nb">env</span>:
          - name: VERSION
            value: v1.0.0
          livenessProbe:
            httpGet:
              path: /live
              port: probe
            initialDelaySeconds: 5
            periodSeconds: 5
          readinessProbe:
            httpGet:
              path: /ready
              port: probe
            periodSeconds: 5
  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span><span class="nb">cat </span>app-v2.yaml
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: my-app
    labels:
      app: my-app
  spec:
    replicas: 10
    strategy:
      <span class="nb">type</span>: RollingUpdate
      rollingUpdate:
        maxSurge: 1
        maxUnavailable: 0
    selector:
      matchLabels:
        app: my-app
    template:
      metadata:
        labels:
          app: my-app
          version: v2.0.0
        annotations:
          prometheus.io/scrape: <span class="s2">"true"</span>
          prometheus.io/port: <span class="s2">"9101"</span>
      spec:
        containers:
        - name: my-app
          image: crisis513/strategies-test
          ports:
          - name: http
            containerPort: 8080
          - name: probe
            containerPort: 8086
          <span class="nb">env</span>:
          - name: VERSION
            value: v2.0.0
          livenessProbe:
            httpGet:
              path: /live
              port: probe
            initialDelaySeconds: 5
            periodSeconds: 5
          readinessProbe:
            httpGet:
              path: /ready
              port: probe
            initialDelaySeconds: 15
            periodSeconds: 5
</code></pre></div></div> <p>ìš°ì„ , ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¶€ë¶„ì„ ìœ„ì—ì„œ ë¹Œë“œ ë° í‘¸ì‹œí•´ì„œ Docker Hubì— ì €ì¥í•œ <strong>crisis513/strategies-test</strong>ë¡œ ë°”ê¾¸ì—ˆë‹¤. app-v1.yaml íŒŒì¼ê³¼ ë‹¤ë¥´ê²Œ app-v2.yamlì—ì„œëŠ” ë²„ì „ì„ ì˜ë¯¸í•˜ëŠ” ë¶€ë¶„ë“¤ì´ v1.0.0ì—ì„œ v2.0.0ìœ¼ë¡œ ë²„ì „ì—… ë˜ì—ˆê³ , spec &gt; strategy ë¶€ë¶„ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. typeì„ RollingUpdateë¡œ ì„¤ì •í•˜ê³  maxSurge, maxUnavailable ë‘ íŒŒë¼ë¯¸í„°ë¥¼ ì„¤ì •í•´ì•¼ í•œë‹¤. <strong>maxSurgeëŠ” ì˜ë„í•œ pod ìˆ˜ì— ëŒ€í•´ ìƒì„±í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ pod ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆê³ , maxUnavailableëŠ” Rolling Update ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ìµœëŒ€ íŒŒë“œì˜ ìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</strong> [ê·¸ë¦¼ 1]ì—ì„œëŠ” pod ì§‘í•©ì„ í•˜ë‚˜ì”© ì œê±°í•œë‹¤ê³  ì„¤ëª…í–ˆì§€ë§Œ ì‹¤ì œë¡œëŠ” maxUnavailableì—ì„œ ì„¤ì •ëœ ê°’ë§Œí¼ ê¸°ì¡´ ë²„ì „ì˜ podë“¤ì„ ì œê±°í•˜ê³  ìƒˆë¡œìš´ ë²„ì „ì˜ podë“¤ì„ ìƒì„±í•˜ê²Œ ëœë‹¤. maxSurge, maxUnavailable ë‘ íŒŒë¼ë¯¸í„°ì˜ ê°’ì€ ì§ì ‘ì ì¸ <strong>ìˆ˜ì¹˜(ex: 1)</strong>ë¥¼ ì§€ì •í•˜ê±°ë‚˜ <strong>ë¹„ìœ¨(ex: 10%)</strong>ë¡œë„ ì§€ì •ì´ ê°€ëŠ¥í•˜ë‹¤.</p> <p>app-v1.yamlë¶€í„° ë°°í¬í•˜ì—¬ ì„œë¹„ìŠ¤ì™€ ë””í”Œë¡œì´ë¨¼íŠ¸, íŒŒë“œë“¤ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span>k apply <span class="nt">-f</span> app-v1.yaml
  service/my-app created
  deployment.apps/my-app created
  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span>k get all
  NAME                         READY   STATUS    RESTARTS   AGE
  pod/my-app-9b99b584b-7m8mw   1/1     Running   0          46s
  pod/my-app-9b99b584b-b9q6d   1/1     Running   0          46s
  pod/my-app-9b99b584b-gjd2p   1/1     Running   0          46s
  pod/my-app-9b99b584b-hzqcf   1/1     Running   0          46s
  pod/my-app-9b99b584b-jbjq8   1/1     Running   0          46s
  pod/my-app-9b99b584b-pldbh   1/1     Running   0          46s
  pod/my-app-9b99b584b-s8ts9   1/1     Running   0          46s
  pod/my-app-9b99b584b-sdn9q   1/1     Running   0          46s
  pod/my-app-9b99b584b-smg9k   1/1     Running   0          46s
  pod/my-app-9b99b584b-zkf7s   1/1     Running   0          46s

  NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>        AGE
  service/kubernetes   ClusterIP   10.96.0.1        &lt;none&gt;        443/TCP        15d
  service/my-app       NodePort    10.103.204.108   &lt;none&gt;        80:30738/TCP   46s

  NAME                     READY   UP-TO-DATE   AVAILABLE   AGE
  deployment.apps/my-app   10/10   10           10          46s

  NAME                               DESIRED   CURRENT   READY   AGE
  replicaset.apps/my-app-9b99b584b   10        10        10      46s

  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span>curl http://192.168.49.2:30738
  Host: my-app-744d48b664-d5qqn, Version: v1.0.0
</code></pre></div></div> <p>ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì–´ curl ìš”ì²­ì— ëŒ€í•´ 1.0.0 ë²„ì „ì„ ì‚¬ìš©í•˜ê³  ìˆë‹¤ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. curlì„ í†µí•´ requestë¥¼ ë³´ë‚¼ ë•Œ 192.168.49.2ëŠ” í•„ìê°€ êµ¬ì„±í•œ Kubernetes í´ëŸ¬ìŠ¤í„° ë…¸ë“œì˜ IPì´ë‹¤. ì´ ì£¼ì†ŒëŠ” í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ìƒí™©ì— ë§ê²Œ ìˆ˜ì •í•˜ë©´ ëœë‹¤. 30738 í¬íŠ¸ë²ˆí˜¸ëŠ” app-v1.yamlì—ì„œ NodePortë¥¼ ìƒì„±í•˜ë©´ì„œ ì„ì˜ë¡œ ì„¤ì •ëœ í¬íŠ¸ë²ˆí˜¸ì´ë‹¤. ì„œë¹„ìŠ¤ë¥¼ ì§€ì› ë‹¤ê°€ ë‹¤ì‹œ ìƒì„±í•˜ë©´ í•´ë‹¹ í¬íŠ¸ë²ˆí˜¸ëŠ” ë‹¬ë¼ì§ˆ ê²ƒì´ë‹ˆ ì°¸ê³  ë°”ë€ë‹¤.</p> <p>ê·¸ë¦¬ê³  ë‹¤ìŒê³¼ ê°™ì´ <strong>while ëª…ë ¹ì–´ë¥¼ í†µí•´ Ctrl + Cë¥¼ ëˆ„ë¥´ê¸° ì „ê¹Œì§€ ê³„ì†í•´ì„œ í•´ë‹¹ ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ê²ƒ</strong>ì´ë‹¤. ê·¸ë˜ì•¼ ì§€ì†ì ì¸ ìš”ì²­ì— ëŒ€í•œ ë©”íŠ¸ë¦­ì´ ìŒ“ì´ê²Œ ë˜ê³ , v2.0.0ìœ¼ë¡œ ë°”ë€ŒëŠ” ê³¼ì •ì˜ ë©”íŠ¸ë¦­ì„ ë³¼ ìˆ˜ ìˆê²Œ ëœë‹¤.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do </span>curl <span class="nt">-s</span> <span class="nt">-o</span> /dev/null <span class="s2">"http://192.168.49.2:30738"</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div> <p>í•„ìëŠ” ì•½ 6ë¶„ì •ë„ ìš”ì²­ì„ ê³„ì† ë³´ë‚´ë„ë¡ ë‘ì—ˆê³ , ê·¸ë™ì•ˆ Grafanaì—ì„œ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ëœ ë‚´ìš©ì„ ì‹œê°í™”í•˜ì—¬ ë³¼ ìˆ˜ ìˆë„ë¡ ëŒ€ì‹œë³´ë“œë¥¼ ì¶”ê°€í•˜ì˜€ë‹¤. k8s-deployment-strategies í´ë” ë‚´ì˜ grafana-dashboard.json íŒŒì¼ì—ì„œ ëŒ€ì‹œë³´ë“œë¥¼ ì–´ë–»ê²Œ ë§Œë“¤ì—ˆëŠ”ì§€ì— ëŒ€í•œ ì„¤ì • ë‚´ìš©ì´ ë“¤ì–´ìˆì–´ ì‰½ê²Œ ì‹œê°í™” ì‹œí‚¬ ìˆ˜ ìˆë‹¤. <strong>New Dashboard</strong>ë¥¼ í†µí•´ ëŒ€ì‹œë³´ë“œë¥¼ ìƒì„±í•˜ê³ , ìš°ì¸¡ ìƒë‹¨ì˜ í†±ë‹ˆë°”í€´ ëª¨ì–‘ì˜ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ì„¤ì • ì°½ì— ë“¤ì–´ê°€ë©´ ë‹¤ìŒ [ê·¸ë¦¼ 4]ì™€ ê°™ì´ ì¢Œì¸¡ì˜ <strong>JSON Model</strong> íƒ­ì„ ëˆŒëŸ¬ ëŒ€ì‹œë³´ë“œ ì„¤ì •ì„ json í˜•íƒœë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì°½ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate4.png" alt="dashboard_settings" width="100%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 4] Grafana dashboard ì„¤ì •</td> </tr> </tbody> </table> <p><br /></p> <p>ëŒ€ì‹œë³´ë“œ ëª…ì€ ì˜ˆì‹œì™€ ê°™ì´ <strong>k8s-deployment-strategies dashboard</strong>ë¡œ í•˜ì˜€ê³ , panel ë¶€ë¶„ë§Œ grafana-dashboard.json íŒŒì¼ì˜ 30~130ë¼ì¸ì— í•´ë‹¹í•˜ëŠ” panelë¶€ë¶„ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì €ì¥í•˜ì˜€ë‹¤.</p> <p><br /></p> <p>ë‹¤ì‹œ í„°ë¯¸ë„ë¡œ ëŒì•„ì™€ curl ìš”ì²­ ì¤‘ì¸ í„°ë¯¸ë„ ë§ê³  ìƒˆë¡œìš´ í„°ë¯¸ë„ì„ ì—´ì–´ app-v2.yaml íŒŒì¼ì„ ë°°í¬í•˜ê³ ë‚˜ì„œ ë°°í¬í–ˆë˜ app-v1.yamlì„ ì œê±°í•´ë³´ì.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span>k apply <span class="nt">-f</span> app-v2.yaml
  deployment.apps/my-app configured

  son@son-localhost ~/k8s-deployment-strategies/ramped <span class="nv">$ </span>k delete <span class="nt">-f</span> app-v1.yaml
  service <span class="s2">"my-app"</span> deleted
  deployment.apps <span class="s2">"my-app"</span> deleted
</code></pre></div></div> <p>ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ê¸°ì¡´ì— ë°°í¬í–ˆë˜ v1.0.0 ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ëª¨ë‘ ì œê±°ë˜ê³  v2.0.0ì— í•´ë‹¹í•˜ëŠ” ìƒˆë¡œìš´ ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë²„ì „ì—… ë˜ì–´ ìˆì„ ê²ƒì´ë‹¤.</p> <p><br /></p> <h3 id="23-grafana-dashboard-í™•ì¸-">2.3. Grafana dashboard í™•ì¸ <a name="list2_3"></a></h3> <p><strong>í˜„ì¬ Rolling Updateë¥¼ í†µí•´ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ ë²„ì „ì—…ì‹œí‚¤ëŠ” ê³¼ì •ì„ curlì„ í†µí•´ ê³„ì†í•´ì„œ ìš”ì²­ì„ ë³´ë‚´ëŠ” ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•˜ê³  ìˆëŠ” ìƒí™©</strong>ì´ê³ , ì¼ì • ì‹œê°„ì´ ì§€ë‚œ í›„ì— ìœ„ì—ì„œ ë§Œë“¤ì–´ë‘” Grafana íŒ¨ë„ì„ í™•ì¸í•´ë³´ë©´ [ê·¸ë¦¼ 5]ì™€ ê°™ì´ ë³´ì¼ ê²ƒì´ë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate5.png" alt="request_total_panel1" width="80%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 5] Request Total íŒ¨ë„ í™•ì¸</td> </tr> </tbody> </table> <p><br /></p> <p>pod ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¨ë¡€ë¡œ êµì²´í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ì„ ì²œì²œíˆ ë¡¤ì•„ì›ƒí•˜ëŠ” ê³¼ì •ì„ ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì„ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤. íŒ¨ë„ì„ ëˆ„ë¥´ê³  <strong>e</strong>í‚¤ë¥¼ ëˆ„ë¥´ë©´ edit í™”ë©´ìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆëŠ”ë° [ê·¸ë¦¼ 6]ê³¼ ê°™ì´ <strong>Full Opacity ì˜µì…˜ì„ 100</strong>ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ë°” ì•ˆìª½ì˜ ìƒ‰ì„ ì±„ìš¸ ìˆ˜ ìˆê³ , <strong>Stack series ì˜µì…˜ì„ 100%</strong>ë¡œ ì„¤ì •í•˜ë©´ ëª¨ë“  series í•©ì´ 100%ê°€ ë˜ë„ë¡ ë°±ë¶„ìœ¨ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.</p> <table> <thead> <tr> <th style="text-align: center"><img src="/static/assets/img/landing/infra/rollingupdate6.png" alt="request_total_panel2" width="100%" /></th> </tr> </thead> <tbody> <tr> <td style="text-align: center">[ê·¸ë¦¼ 6] Request Total íŒ¨ë„ ì„¤ì •</td> </tr> </tbody> </table> <p><br /></p> <p>ì‹œê°í™”ëœ ë°ì´í„°ë¥¼ ë³´ë©´ ê¸°ì¡´ ë²„ì „ì´ ì‚¬ë¼ì§€ê³  ìƒˆë¡œìš´ ë²„ì „ì´ ì˜¬ë¼ì˜¤ëŠ” ê³¼ì •ì´ ì ì§„ì ìœ¼ë¡œ ë¡¤ì•„ì›ƒ ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p> <hr> <div class="row"> <div class="col-md-6"> <h5 style="display: inline;">Tags:</h5> <button class="btn btn-white btn-xs" type="button">son</button> <button class="btn btn-white btn-xs" type="button">blog</button> <button class="btn btn-white btn-xs" type="button">infra</button> <button class="btn btn-white btn-xs" type="button">docker</button> <button class="btn btn-white btn-xs" type="button">minikube</button> <button class="btn btn-white btn-xs" type="button">kubernetes</button> <button class="btn btn-white btn-xs" type="button">grafana</button> <button class="btn btn-white btn-xs" type="button">rolling update</button> </div> <div class="col-md-6"> <div class="small text-right"> <div> <i class="fa fa-comments-o"> </i> <span class="disqus-comment-count" data-disqus-url="http://192.168.116.128:4000/infra/2022/10/22/rolling-update.html">0</span> comments </div> </div> </div> </div> <div class="PageNavigation"> <a class="prev" href="/infra/2022/10/14/use_istio.html">&laquo; [Infra] Minikubeì—ì„œ Istio ì‚¬ìš©ê¸°</a> <a class="next" href="/infra/2022/10/23/blue-green.html">[Infra] Kubernetes Blue/Green ë°°í¬ ì „ëµ ì‹¤ìŠµ &raquo;</a> </div> <br> <div class="row"> <div class="col-lg-12"> <!-- donate --> <br> <!-- share --> <div class="a2a_kit a2a_kit_size_32 a2a_default_style"> <a class="a2a_dd" href="https://www.addtoany.com/share"></a> <a class="a2a_button_facebook"></a> <a class="a2a_button_twitter"></a> <a class="a2a_button_google_plus"></a> <a class="a2a_button_linkedin"></a> <a class="a2a_button_email"></a> <a class="a2a_button_wechat"></a> <a class="a2a_button_sina_weibo"></a> <a class="a2a_button_pocket"></a> </div> <script> var a2a_config = a2a_config || {}; a2a_config.color_main = "D7E5ED"; a2a_config.color_border = "AECADB"; a2a_config.color_link_text = "333333"; a2a_config.color_link_text_hover = "333333"; </script> <script async src="https://static.addtoany.com/menu/page.js"></script> <br> <!-- comment --> <div id="disqus_thread"></div> <script> /** * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS. * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables */ /* var disqus_config = function () { this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable }; */ (function() { var d = document, s = d.createElement('script'); s.src = '//son.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> </div> </div> </div> </div> </div> </div> </div> <!-- Google analytics --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93473370-3', 'auto'); ga('require', ''); ga('send', 'pageview'); </script> <!-- GrowingIO --> <script id="dsq-count-scr" src="https://son.disqus.com/count.js" async></script> </body> </html>
